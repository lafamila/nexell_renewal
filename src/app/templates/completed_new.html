{% extends 'common/main_base.html' %}
{% block content %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.14.3/xlsx.full.min.js"></script>
<link rel="stylesheet" type="text/css" href="/static/nexell/css/smartadmin-nexell-report.css">

<!--########################################################################-->
<!--# page layer start                                                     #-->
<!--########################################################################-->
<!-- 레포트1 레이어 팝업 시작 -->
<style>
    .input-available{
        cursor:pointer;
    }
    .input-available:hover{
        background-color:rgba(0,112,192, 0.5)!important;
    }
</style>
<div id="popReport">
    <div>
        <div class="modal-content">
			<div class="modal-header">
				<div class="pull-right" style="margin-right:10px;">
					<button class="btn btn-primary" id="btnDownload"><i class="fa fa-download">&nbsp;다운로드</i></button>
					<button class="btn btn-primary" id="btnPrint2"><i class="fa fa-print">&nbsp;출력</i></button>
				</div>
				<div class="pull-right" style="margin-right:10px;width:150px;">
					<div class="input-group">
						<input class="form-control datepicker" type="text" style="" data-dateformat="yy-mm-dd" data-mask="9999-99-99" data-mask-placeholder="_" id="s_pxcond_mt" name="s_pxcond_mt">
						<span class="input-group-addon"><i class="fa fa-calendar"></i></span>
					</div>
				</div>
			</div>
			<div class="modal-body report">

                <style>
                    div.report.report-completed1 table th,
                    div.report.report-completed1 table td {
                        font-size: 12px!important;
                    }

                    div.report.report-completed1 #rptCompletedArea table th,
                    div.report.report-completed1 #rptCompletedArea table td {
                        font-size: 12px!important;
                        padding: 7px 5px!important;
                    }
                    div.report table tbody[role=header] tr:last-child th {
                        border-bottom: black 1px solid !important;
                    }

                    div.report *{
                        font-size:12px !important;
                    }
                    #popReport{
                        font-size: 9px !important;
                        line-height: 1.0 !important;
                    }
                    tr.etc{
                        display:none;
                    }
                    tr.myETC, #eETC{
                        cursor:pointer;
                    }
                    .color-red{
                        color: red!important;
                    }
                </style>
                <div class="title"><h2 class="colorLS"><span id="rptTitle" style="font-size:28px!important;"></span> 기성현황서</h2></div>
                <h5 class="sub-title underline">공조사업부 영업 실적현황</h5>
                <table id="rptContractStatus">
                    <colgroup>
                        <col width="100">
                        <col width="150">
                        <col width="*">
                    </colgroup>
                    <tbody role="header">
                        <tr>
                            <th class="colorZ" rowspan="2" style="border-bottom: black 1px solid !important">구분</th>
                            <th class="colorZ" rowspan="2" style="border-bottom: black 1px solid !important;border-right:2px solid black!important;">팀</th>
                            <th class="colorZ" colspan="3" id="rptContractStatus_m" style="border-right:2px solid black!important;">월</th>
                            <th class="colorZ" colspan="3" style="border-right:2px solid black!important;">누계</th>
                            <th class="colorZ" colspan="2">연간</th>
                        </tr>
                        <tr>
                            <th class="colorZ">목표</th>
                            <th class="colorZ">실적</th>
                            <th class="colorZ" style="border-right:2px solid black!important;">%</th>
                            <th class="colorZ">목표</th>
                            <th class="colorZ">실적</th>
                            <th class="colorZ" style="border-right:2px solid black!important;">%</th>
                            <th class="colorZ">목표</th>
                            <th class="colorZ">%</th>
                        </tr>
                    </tbody>
                    <tbody role="body">
                    </tbody>
                </table>
                <!------------------------------------------------------------------------------------------->
                <br>
                <h5 class="sub-title underline">공조사업부 현장 집행현황</h5>
                <table id="rptExecutStatus">
                    <colgroup>
                        <col width="100">
                        <col width="150">
                        <col width="*">
                    </colgroup>
                    <tbody role="header">
                        <tr>
                            <th class="colorZ" rowspan="2">구분</th>
                            <th class="colorZ" rowspan="2" style="border-right:2px solid black!important;">담당</th>
                            <th class="colorZ" colspan="3"id="rptExecutStatus_m" style="border-right:2px solid black!important;">월</th>
                            <th class="colorZ" colspan="3" style="border-right:2px solid black!important;">누계</th>
                            <th class="colorZ" rowspan="2">총 진행 현장수</th>
                        </tr>
                        <tr>
                            <th class="colorZ">매출</th>
                            <th class="colorZ">집행</th>
                            <th class="colorZ" style="border-right:2px solid black!important;">%</th>
                            <th class="colorZ">매출</th>
                            <th class="colorZ">집행</th>
                            <th class="colorZ" style="border-right:2px solid black!important;">%</th>
                        </tr>
                    </tbody>
                    <tbody role="body">
                    </tbody>
                </table>
                <!------------------------------------------------------------------------------------------->
                <br>
                <div style="position:relative">
                <h5 class="sub-title underline">거래처 현장별 기성현황</h5>
<!--                <div class="" style="position: absolute; right: 0; top: -8px;margin-right:10px;" data-toggle="buttons">-->
<!--                    <label class="btn btn-default">-->
<!--                        <input type="checkbox" name="progrs_sttus_code">마감-->
<!--                    </label>-->
<!--                    <label class="btn btn-default">-->
<!--                        <input type="checkbox" name="progrs_sttus_code_n">유보-->
<!--                    </label>-->
<!--                </div>-->
                </div>
                <div id="rptCompletedArea"></div>
                <br>
                <div id="rptCompletedTotal"></div>
                <!------------------------------------------------------------------------------------------->
                <!------------------------------------------------------------------------------------------->


			</div><!--modal-body-->
        </div><!--modal-content-->
    </div><!--modal-dialog-->
</div>
<!-- 레포트1 레이어 팝업 끝 -->
<script type="text/javascript">
/**************************************************************************
 *
 */
getReportNR = function(s_pxcond_mt)
{
	var params = '';
	params += '&s_pxcond_mt=' + s_pxcond_mt;
	console.log('getReportNR', params);

	$.ajax({
		url: '/api/completed/ajax_get_completed_reportNR',
		type: 'GET',
		data: params,
		dataType: 'json',
		contentType: false,
		processData: false,
		success: function(pResult) {
			console.log('getReportNR', pResult); //rptCompletedArea
			if (pResult.status) {
                var loginSN = $("#loginSN").val();

                var DELIMITER=1;
				var pxcond_mt = $('#popReport').find('#s_pxcond_mt').val();
				var pxcond_mt_arr = pxcond_mt.split('-');
				var year = parseInt(pxcond_mt_arr[0]);
				var month = parseInt(pxcond_mt_arr[1]);
				var day = parseInt(pxcond_mt_arr[2]);
				$('#popReport').find('#rptTitle').html(year+'년&nbsp;'+month+'월분');
				// ============================================================
				// 공조사업부 영업 실적현황
				var html = '';
				var rt1 = 0, rt2 = 0, rt3 = 0;
				var b_amt1 = 0, b_amt2 = 0, b_amt3 = 0, b_amt4 = 0, b_amt5 = 0;
				var j_amt1 = 0, j_amt2 = 0, j_amt3 = 0, j_amt4 = 0, j_amt5 = 0;
				var total1 = 0, total2 = 0, total3 = 0, total4 = 0, total5 = 0;
				$('#popReport').find('#rptContractStatus_m').html(month+'월');
                $.each(pResult.contractStatusList, function(pIndex, pValue){
                    if (pValue.amt_ty_code == '2') { // 수주
                        b_amt1 = parseInt(pValue.m_contract_amount); if(isNaN(b_amt1)) b_amt1 = 0;
                        b_amt2 = parseInt(pValue['m'+parseInt(pxcond_mt_arr[1])]); if(isNaN(b_amt2)) b_amt2 = 0;
                        b_amt3 = parseInt(pValue.y_contract_amount); if(isNaN(b_amt3)) b_amt3 = 0;
                        b_amt4 = 0; for(i=1; i<=month; i++) { b_amt4 += isNaN(parseInt(pValue['m'+i]))?0:parseInt(pValue['m'+i]); } if(isNaN(b_amt4)) b_amt4 = 0;
                        b_amt5 = 0; for(i=1; i<=12; i++) { b_amt5 += isNaN(parseInt(pValue['m'+i]))?0:parseInt(pValue['m'+i]); } if(isNaN(b_amt5)) b_amt5 = 0;

                        b_amt1 = Math.round(b_amt1/DELIMITER);
                        b_amt2 = Math.round(b_amt2/DELIMITER);
                        b_amt3 = Math.round(b_amt3/DELIMITER);
                        b_amt4 = Math.round(b_amt4/DELIMITER);
                        b_amt5 = Math.round(b_amt5/DELIMITER);
                        rt1 = (b_amt2 < 0) ? 100.0 + (b_amt2 - b_amt1)*100/b_amt2 : (b_amt1/b_amt2)*100; if (isNaN(rt1)) rt1 = 0.0;
                        rt2 = (b_amt4 < 0) ? 100.0 + (b_amt4 - b_amt3)*100/b_amt4 : (b_amt3/b_amt4)*100; if (isNaN(rt2)) rt2 = 0.0;
                        rt3 = (b_amt3/b_amt5)*100; if (isNaN(rt3)) rt3 = 0.0;
                        html += '<tr data-amt="'+pValue.amt_ty_code+'">';
                        html += '    <td class="text-center colorSky" style="vertical-align:middle;border-right:2px solid black!important;border-bottom:1px solid black!important;"><a data-toggle="modal" href="#popReport2" style="color:inherit;">'+pValue.amt_ty_nm+'</a></td>';
                        html += '    <td class="text-center" style="border-right:2px solid black!important;">'+pValue.dept_nm+'</td>';
                        html += '    <td class="text-number">'+b_amt2.toString().toFormat('NUMBER')+'</td>';
                        html += '    <td class="text-number">'+b_amt1.toString().toFormat('NUMBER')+'</td>';
                        html += '    <td class="text-number" style="border-right:2px solid black!important;">'+((rt1 == Infinity || rt1 < 0)? '-' : (rt1.toFixed(1)+'%'))+'</td>';
                        html += '    <td class="text-number">'+b_amt4.toString().toFormat('NUMBER')+'</td>';
                        html += '    <td class="text-number">'+b_amt3.toString().toFormat('NUMBER')+'</td>';
                        html += '    <td class="text-number" style="border-right:2px solid black!important;">'+((rt2 == Infinity || rt2 < 0)? '-' : (rt2.toFixed(1)+'%'))+'</td>';
                        html += '    <td class="text-number">'+b_amt5.toString().toFormat('NUMBER')+'</td>';
                        html += '    <td class="text-number" style="border-right:2px solid black!important;">'+((rt3 == Infinity || rt3 < 0)? '-' : (rt3.toFixed(1)+'%'))+'</td>';
                        html += '</tr>';
                        // 합계처리
                        total1 += parseInt(b_amt1);
                        total2 += parseInt(b_amt2);
                        total3 += parseInt(b_amt3);
                        total4 += parseInt(b_amt4);
                        total5 += parseInt(b_amt5);
                        if ((pIndex+1)%pValue.dept_count == 0) {
                            rt1 =  (total2 < 0) ? 100.0 + (total2 - total1)*100/total2 : (total1/total2)*100; if (isNaN(rt1)) rt1 = 0.0;
                            rt2 =  (total4 < 0) ? 100.0 + (total4 - total3)*100/total4 : (total3/total4)*100; if (isNaN(rt2)) rt2 = 0.0;
                            rt3 = (total3/total5)*100; if (isNaN(rt3)) rt3 = 0.0;
                            html += '<tr data-amt="'+pValue.amt_ty_code+'">';
                            html += '    <td class="text-center" style="border-right:2px solid black!important;"><a data-toggle="modal" href="#popReport2" style="color:inherit;">'+pValue.amt_ty_nm+'</a></td>';
                            html += '    <td class="text-center colorSky" style="border-right:2px solid black!important;">계</td>';
                            html += '    <td class="text-number colorSky">'+total2.toString().toFormat('NUMBER')+'</td>';
                            html += '    <td class="text-number colorSky">'+total1.toString().toFormat('NUMBER')+'</td>';
                            html += '    <td class="text-number colorSky" style="border-right:2px solid black!important;">'+((rt1 == Infinity || rt1 < 0)? '-' : (rt1.toFixed(1)+'%'))+'</td>';
                            html += '    <td class="text-number colorSky">'+total4.toString().toFormat('NUMBER')+'</td>';
                            html += '    <td class="text-number colorSky">'+total3.toString().toFormat('NUMBER')+'</td>';
                            html += '    <td class="text-number colorSky" style="border-right:2px solid black!important;">'+((rt2 == Infinity || rt2 < 0)? '-' : (rt2.toFixed(1)+'%'))+'</td>';
                            html += '    <td class="text-number colorSky" id="suju_rates'+pValue.amt_ty_code+'">'+total5.toString().toFormat('NUMBER')+'</td>';
                            html += '    <td class="text-number colorSky" style="border-right:2px solid black!important;">'+((rt3 == Infinity || rt3 < 0)? '-' : (rt3.toFixed(1)+'%'))+'</td>';
                            html += '</tr>';
                            total1 = 0, total2 = 0, total3 = 0, total4 = 0, total5 = 0;
                        }
                    } else if (pValue.amt_ty_code == '3' || pValue.amt_ty_code == '5') { // 매출, VA
                        b_amt1 = parseInt(pValue.m_contract_amount); if(isNaN(b_amt1)) b_amt1 = 0;
                        b_amt2 = parseInt(pValue['m'+parseInt(pxcond_mt_arr[1])]); if(isNaN(b_amt2)) b_amt2 = 0;
                        b_amt3 = parseInt(pValue.y_contract_amount); if(isNaN(b_amt3)) b_amt3 = 0;
                        b_amt4 = 0; for(i=1; i<=month; i++) { b_amt4 += isNaN(parseInt(pValue['m'+i]))?0:parseInt(pValue['m'+i]); } if(isNaN(b_amt4)) b_amt4 = 0;
                        b_amt5 = 0; for(i=1; i<=12; i++) { b_amt5 += isNaN(parseInt(pValue['m'+i]))?0:parseInt(pValue['m'+i]); } if(isNaN(b_amt5)) b_amt5 = 0;
                        var link_start = '<a data-toggle="modal" href="#popReport'+pValue.amt_ty_code+'" style="color:inherit;">';
                        var link_end = '</a>';

                        //장려금 합산
                        var j_amt1 = parseInt(pValue.ty9_goal_amount); if(isNaN(j_amt1)) j_amt1 = 0;
                        var j_amt2 = parseInt(pValue.ty8_goal_amount); if(isNaN(j_amt2)) j_amt2 = 0;
                        var j_amt3 = parseInt(pValue.ty9_goal_amount_sum); if(isNaN(j_amt3)) j_amt3 = 0;
                        var j_amt4 = parseInt(pValue.ty8_goal_amount_sum); if(isNaN(j_amt4)) j_amt4 = 0;
                        var j_amt5 = parseInt(pValue.ty8_goal_amount_total); if(isNaN(j_amt5)) j_amt5 = 0;

                        var k_amt1 = Math.round((b_amt1 + j_amt1)/DELIMITER);
                        var k_amt2 = Math.round((b_amt2 + j_amt2)/DELIMITER);
                        var k_amt3 = Math.round((b_amt3 + j_amt3)/DELIMITER);
                        var k_amt4 = Math.round((b_amt4 + j_amt4)/DELIMITER);
                        var k_amt5 = Math.round((b_amt5 + j_amt5)/DELIMITER);
                        rt1 = (k_amt2 < 0) ? 100.0 + (k_amt2 - k_amt1)*100/k_amt2 : (k_amt1/k_amt2)*100; if (isNaN(rt1)) rt1 = 0.0;
                        rt2 = (k_amt4 < 0) ? 100.0 + (k_amt4 - k_amt3)*100/k_amt4 : (k_amt3/k_amt4)*100; if (isNaN(rt2)) rt2 = 0.0;
                        rt3 = (k_amt3/k_amt5)*100; if (isNaN(rt3)) rt3 = 0.0;

                        html += '<tr class="'+pValue.dept_code+'" data-amt="'+pValue.amt_ty_code+'">';
                        html += '    <td class="text-center colorSky" style="vertical-align:middle;border-right:2px solid black!important;">'+link_start+pValue.amt_ty_nm+link_end+'</td>';
                        html += '    <td class="text-center" style="border-right:2px solid black!important;">'+pValue.dept_nm+'</td>';
                        html += '    <td class="text-number">'+k_amt2.toString().toFormat('NUMBER')+'</td>';
                        html += '    <td class="text-number">'+k_amt1.toString().toFormat('NUMBER')+'</td>';
                        html += '    <td class="text-number" style="border-right:2px solid black!important;">'+((rt1 == Infinity || rt1 < 0)? '-' : (rt1.toFixed(1)+'%'))+'</td>';
                        html += '    <td class="text-number">'+k_amt4.toString().toFormat('NUMBER')+'</td>';
                        html += '    <td class="text-number">'+k_amt3.toString().toFormat('NUMBER')+'</td>';
                        html += '    <td class="text-number" style="border-right:2px solid black!important;">'+((rt2 == Infinity || rt2 < 0)? '-' : (rt2.toFixed(1)+'%'))+'</td>';
                        html += '    <td class="text-number">'+k_amt5.toString().toFormat('NUMBER')+'</td>';
                        html += '    <td class="text-number" style="border-right:2px solid black!important;">'+((rt3 == Infinity || rt3 < 0)? '-' : (rt3.toFixed(1)+'%'))+'</td>';
                        html += '</tr>';
                        // 장려금금
                        // html += '<tr>';
                        // html += '    <td class="text-center" style="border-right:2px solid black!important;">'+link_start+pValue.amt_ty_nm+link_end+'</td>';
                        // html += '    <td class="text-center" style="border-right:2px solid black!important;">장려금</td>';
                        // html += '    <td class="text-number">'+j_amt2.toString().toFormat('NUMBER')+'</td>';
                        // html += '    <td class="text-number">'+j_amt1.toString().toFormat('NUMBER')+'</td>';
                        // html += '    <td class="text-number" style="border-right:2px solid black!important;"></td>';
                        // html += '    <td class="text-number">'+j_amt4.toString().toFormat('NUMBER')+'</td>';
                        // html += '    <td class="text-number">'+j_amt3.toString().toFormat('NUMBER')+'</td>';
                        // html += '    <td class="text-number" style="border-right:2px solid black!important;"></td>';
                        // html += '    <td class="text-number">'+j_amt5.toString().toFormat('NUMBER')+'</td>';
                        // html += '    <td class="text-number" style="border-right:2px solid black!important;"></td>';
                        // html += '    <td class="text-number '+pValue.dept_code+'"></td>';
                        // html += '</tr>';
                        // 소계

                        // 합계처리
                        if(pValue.dept_code !== 'ST' ) {
                            total1 += parseInt(k_amt1);
                            total2 += parseInt(k_amt2);
                            total3 += parseInt(k_amt3);
                            total4 += parseInt(k_amt4);
                            total5 += parseInt(k_amt5);
                        }
                        if ((pIndex+1)%pValue.dept_count == 0) {
                            rt1 =  (total2 < 0) ? 100.0 + (total2 - total1)*100/total2 : (total1/total2)*100; if (isNaN(rt1)) rt1 = 0.0;
                            rt2 =  (total4 < 0) ? 100.0 + (total4 - total3)*100/total4 : (total3/total4)*100; if (isNaN(rt2)) rt2 = 0.0;
                            rt3 = (total3/total5)*100; if (isNaN(rt3)) rt3 = 0.0;
                            html += '<tr data-amt="'+pValue.amt_ty_code+'">';
                            html += '    <td class="text-center" style="border-right:2px solid black!important;">'+link_start+pValue.amt_ty_nm+link_end+'</td>';
                            html += '    <td class="text-center colorSky" style="border-right:2px solid black!important;">계</td>';
                            html += '    <td class="text-number colorSky">'+total2.toString().toFormat('NUMBER')+'</td>';
                            html += '    <td class="text-number colorSky">'+total1.toString().toFormat('NUMBER')+'</td>';
                            html += '    <td class="text-number colorSky" style="border-right:2px solid black!important;">'+((rt1 == Infinity || rt1 < 0)? '-' : (rt1.toFixed(1) + '%'))+'</td>';
                            html += '    <td class="text-number colorSky">'+total4.toString().toFormat('NUMBER')+'</td>';
                            html += '    <td class="text-number colorSky">'+total3.toString().toFormat('NUMBER')+'</td>';
                            html += '    <td class="text-number colorSky" style="border-right:2px solid black!important;">'+((rt2 == Infinity || rt2 < 0)? '-' : (rt2.toFixed(1) + '%'))+'</td>';
                            html += '    <td class="text-number colorSky" id="suju_rates'+pValue.amt_ty_code+'">'+total5.toString().toFormat('NUMBER')+'</td>';
                            html += '    <td class="text-number colorSky" style="border-right:2px solid black!important;">'+((rt3 == Infinity || rt3 < 0)? '-' : (rt3.toFixed(1)+'%'))+'</td>';
                            html += '</tr>';
                            total1 = 0, total2 = 0, total3 = 0, total4 = 0, total5 = 0;
                        }
                    }
                });
				$('#popReport').find('#rptContractStatus tbody[role=body]').html(html);
				$('#popReport').find('#rptContractStatus tbody[role=body]').yRowspan(0);
                var cells = $('#popReport').find('#rptContractStatus tbody[role=body] td, #rptContractStatus tbody[role=body] th');
                $.each(cells, function(pIndex, pValue){
                    let value = $(pValue).html();
                    if(value == '0' || value == '0.0%' || value=='-Infinity%' || value=='Infinity%'){

                        $(pValue).html('');
                    }
                });
                var cells = $('#popReport').find('#rptContractStatus tbody[role=body] tr[data-amt="5"] td, #rptContractStatus tbody[role=body] tr[data-amt="5"] th');
                $.each(cells, function(pIndex, pValue){
                    let value = $(pValue).html();
                    if(!isNaN(parseInt(value.replaceAll(",", "")))){
                        if(parseInt(value.replaceAll(",", "")) < 0){
                            $(pValue).addClass("color-red")
                        }
                    }
                });

				// ============================================================
				// 공조사업부 공무 집행현황
				var html = '';
				var e_amt1 = 0, e_amt2 = 0, e_amt3 = 0, e_amt4 = 0;
				var total1 = 0, total2 = 0, total3 = 0, total4 = 0;
                var total_cnt = 0;
                var member = {}; //공조사업부 현장 집행현황 인원별 값

				$('#popReport').find('#rptExecutStatus_m').html(month+'월');
				$.each(pResult.executStatusList, function(pIndex, pValue){
                    if(!member.hasOwnProperty(pValue.mber_sn)){
                        member[pValue.mber_sn] = {"C" : 0, "E" : 0};
                    }
					e_amt1 = parseInt(pValue.m_contract_amount);
					e_amt2 = parseInt(pValue.m_excut_amount);
					e_amt3 = parseInt(pValue.y_contract_amount);
					e_amt4 = parseInt(pValue.y_excut_amount);
					var rt1 = (e_amt2/e_amt1)*100; if (isNaN(rt1)) rt1 = 0.0;
					var rt2 = (e_amt4/e_amt3)*100; if (isNaN(rt2)) rt2 = 0.0;
					html += '<tr>';
					html += '    <td class="text-center colorSky">집행</td>';
					html += '    <td class="text-center" style="border-right:2px solid black!important;" '+(pValue.mber_nm.endsWith("(공1)") ? 'title="공조1"': '')+'>'+pValue.mber_nm.replaceAll("(공1)", "")+'</td>';
					html += '    <td class="text-number">'+e_amt1.toString().toFormat('NUMBER')+'</td>';
					html += '    <td class="text-number">'+e_amt2.toString().toFormat('NUMBER')+'</td>';
					html += '    <td class="text-number" style="border-right:2px solid black!important;">'+((rt1 == Infinity)? '' : (rt1.toFixed(1)+'%'))+'</td>';
					html += '    <td class="text-number">'+e_amt3.toString().toFormat('NUMBER')+'</td>';
					html += '    <td class="text-number">'+e_amt4.toString().toFormat('NUMBER')+'</td>';
					html += '    <td class="text-number" style="border-right:2px solid black!important;">'+((rt2 == Infinity)? '' : (rt2.toFixed(1)+'%'))+'</td>';
					html += '    <td class="text-center">'+pValue.spt_cnt.toString().toFormat('NUMBER')+'개</td>';
					html += '</tr>';
					// 합계처리
					total1 += parseInt(e_amt1);
					total2 += parseInt(e_amt2);
					total3 += parseInt(e_amt3);
					total4 += parseInt(e_amt4);
                    total_cnt += parseInt(pValue.spt_cnt);
					if ((pIndex+1) == pResult.executStatusList.length) {
						var rt1 = (total2/total1)*100; if (isNaN(rt1)) rt1 = 0.0;
						var rt2 = (total4/total3)*100; if (isNaN(rt2)) rt2 = 0.0;
						html += '<tr>';
						html += '    <td class="text-center">집행</td>';
						html += '    <td class="text-center colorSky" style="border-right:2px solid black!important;">계</td>';
						html += '    <td class="text-number colorSky">'+total1.toString().toFormat('NUMBER')+'</td>';
						html += '    <td class="text-number colorSky">'+total2.toString().toFormat('NUMBER')+'</td>';
						html += '    <td class="text-number colorSky" style="border-right:2px solid black!important;">'+((rt1 == Infinity)? '' : (rt1.toFixed(1)+'%'))+'</td>';
						html += '    <td class="text-number colorSky">'+total3.toString().toFormat('NUMBER')+'</td>';
						html += '    <td class="text-number colorSky">'+total4.toString().toFormat('NUMBER')+'</td>';
						html += '    <td class="text-number colorSky" style="border-right:2px solid black!important;">'+((rt2 == Infinity)? '' : (rt2.toFixed(1)+'%'))+'</td>';
						html += '    <td class="text-center colorSky">'+total_cnt+'개</td>';
						html += '</tr>';
						total1 = 0, total2 = 0, total3 = 0, total4 = 0;
					}
				});
				$('#popReport').find('#rptExecutStatus tbody[role=body]').html(html);
				$('#popReport').find('#rptExecutStatus tbody[role=body]').yRowspan(0);
                var cells = $('#popReport').find('#rptExecutStatus tbody[role=body] td, #rptExecutStatus tbody[role=body] th');
                $.each(cells, function(pIndex, pValue){
                    let value = $(pValue).clone().children().remove().end().text();
                    if(value == '0' || value == '0.0%' || value=='-Infinity%' || value=='Infinity%'){
                        $(pValue).html('');
                    }
                });
				// ============================================================
				// 거래처 현장별 기성현황
                // 이전달 현장 목록, 이전달 도급사 목록, 이전달 계약금액
                var LAST_SPT_NMS = {}, LAST_PURCHSOFC_NMS = {}, LAST_AMOUNTS = {};
                $.each(pResult.lastDate, function(pIndex, pValue){
                    let dpt_code = pValue.bsn_dept_code;
                    if(!LAST_SPT_NMS.hasOwnProperty(dpt_code)){
                        LAST_SPT_NMS[dpt_code] = [];
                    }
                    LAST_SPT_NMS[dpt_code].push(pValue.spt_nm);

                    if(!LAST_PURCHSOFC_NMS.hasOwnProperty(dpt_code)){
                        LAST_PURCHSOFC_NMS[dpt_code] = {};
                    }
                    if(!LAST_PURCHSOFC_NMS[dpt_code].hasOwnProperty(pValue.spt_nm)){
                        LAST_PURCHSOFC_NMS[dpt_code][pValue.spt_nm] = [];
                    }
                    LAST_PURCHSOFC_NMS[dpt_code][pValue.spt_nm].push(pValue.purchsofc_nm);


                    if(!LAST_AMOUNTS.hasOwnProperty(dpt_code)){
                        LAST_AMOUNTS[dpt_code] = {};
                    }
                    if(!LAST_AMOUNTS[dpt_code].hasOwnProperty(pValue.spt_nm)){
                        LAST_AMOUNTS[dpt_code][pValue.spt_nm] = {};
                    }
                    if(!LAST_AMOUNTS[dpt_code][pValue.spt_nm].hasOwnProperty(pValue.purchsofc_sn)){
                        LAST_AMOUNTS[dpt_code][pValue.spt_nm][pValue.purchsofc_sn] = pValue.cntrct_amount;
                    }

                });


                var amt = {}; //현장별 C/E 누계 총합
                var rm = {};
                $.each(pResult.completedList, function(pIndex, pValue){
                    var sum = parseInt(pValue.complete_amount)+(
                    parseInt(pValue.tax_amount) == 0?parseInt(pValue.excut_amount):parseInt(pValue.tax_amount));
                    if(!amt.hasOwnProperty(pValue.cntrct_sn)){

                        amt[pValue.cntrct_sn] = {};
                        amt[pValue.cntrct_sn]['C'] = 0;
                        amt[pValue.cntrct_sn]['E'] = 0;

                    }
                    amt[pValue.cntrct_sn][pValue.cntrct_execut_code] += sum;

                    if(!rm.hasOwnProperty(pValue.cntrct_sn)){
                        rm[pValue.cntrct_sn] = "";
                    }
                    if(pValue.rm != rm[pValue.cntrct_sn] && pValue.rm != ""){
                        rm[pValue.cntrct_sn] = pValue.rm;
                    }
                });


                var data = {}; //팀별 C/E 금월 청구 총합

				var html = '';
				var before = '', before_bsn_dept_code = '';
				var c_cntrct_amount = 0, c_complete_amount = 0, c_excut_amount = 0, c_sum_amount = 0;
				var e_cntrct_amount = 0, e_complete_amount = 0, e_excut_amount = 0, e_sum_amount = 0;

				$.each(pResult.completedList, function(pIndex, pValue){
                    if(pValue.cntrct_execut_code == 'E' && pValue.ct_se_code == 8){
                        return true;
                    }
					if (before != '' && before != pValue.bsn_dept_nm) {



                        var c_sum = parseInt(c_complete_amount)+parseInt(c_excut_amount);
						var c_rt1 = (c_complete_amount/c_cntrct_amount)*100;
						var c_rt2 = (c_excut_amount/c_cntrct_amount)*100;
						var c_rt3 = (c_sum/c_cntrct_amount)*100;
						var p_sub_amt = parseInt(c_excut_amount) - parseInt(e_excut_amount)

                        html += '</tbody>';
						html += '<tbody role="footer">';
						html += '	<tr>';
						html += '		<th class="colorZ" colspan="5" rowspan="2" style="border-right:2px solid black!important;">'+before+' 계</th>';
						html += '		<th class="colorZ">당사분</th>';
						html += '       <td class="text-number" style="border-right:2px solid black!important;">'+c_cntrct_amount.toString().toFormat('NUMBER')+'</td>';
						html += '       <td class="text-number">'+c_complete_amount.toString().toFormat('NUMBER')+'</td>';
						html += '       <td class="text-number" style="border-right:2px solid black!important;">'+c_rt1.toFixed(1)+'%</td>';
						html += '       <td class="text-number">'+c_excut_amount.toString().toFormat('NUMBER')+'</td>';
						html += '       <td class="text-number" style="border-right:2px solid black!important;">'+c_rt2.toFixed(1)+'%</td>';
						html += '       <td class="text-number">'+c_sum_amount.toString().toFormat('NUMBER')+'</td>';
						html += '       <td class="text-number" style="border-right:2px solid black!important;">'+c_rt3.toFixed(1)+'%</td>';
						html += '       <th class="colorZ" colspan="2" rowspan="1">매출차액</th>';
						html += '       <td class="text-number" colspan="1" rowspan="1">'+p_sub_amt.toString().toFormat('NUMBER')+'</td>';
						html += '	</tr>';

						var e_sum = parseInt(e_complete_amount)+parseInt(e_excut_amount);
						var e_rt1 = (e_complete_amount/e_cntrct_amount)*100;
						var e_rt2 = (e_excut_amount/e_cntrct_amount)*100;
						var e_rt3 = (e_sum/e_cntrct_amount)*100;
						var p_sub_amt = parseInt(c_cntrct_amount) - parseInt(c_sum_amount)
						html += '	<tr>';
						html += '		<th class="colorZ">업체분</th>';
						html += '       <td class="text-number" style="border-right:2px solid black!important;">'+e_cntrct_amount.toString().toFormat('NUMBER')+'</td>';
						html += '       <td class="text-number">'+e_complete_amount.toString().toFormat('NUMBER')+'</td>';
						html += '       <td class="text-number" style="border-right:2px solid black!important;">'+e_rt1.toFixed(1)+'%</td>';
						html += '       <td class="text-number">'+e_excut_amount.toString().toFormat('NUMBER')+'</td>';
						html += '       <td class="text-number" style="border-right:2px solid black!important;">'+e_rt2.toFixed(1)+'%</td>';
						html += '       <td class="text-number">'+e_sum_amount.toString().toFormat('NUMBER')+'</td>';
						html += '       <td class="text-number" style="border-right:2px solid black!important;">'+e_rt3.toFixed(1)+'%</td>';
						html += '       <th class="colorZ" colspan="2" rowspan="1">수주잔고</th>';
						html += '       <td class="text-number" colspan="1" rowspan="1">'+p_sub_amt.toString().toFormat('NUMBER')+'</td>';
						html += '	</tr>';
						html += '</tbody>';
						html += '</table>';

                        data[before] = {};
                        data[before]['C'] = parseInt(c_excut_amount);
                        data[before]['E'] = parseInt(e_excut_amount);

						c_cntrct_amount = 0, c_complete_amount = 0, c_excut_amount = 0, c_sum_amount = 0;
						e_cntrct_amount = 0, e_complete_amount = 0, e_excut_amount = 0, e_sum_amount = 0;
					}

					// header
					if (before != pValue.bsn_dept_nm) {
						html += '<table id="rptCompletedList'+pValue.bsn_dept_code+'">';
						html += '<colgroup>';
						html += '    <col width="50">';
						html += '    <col width="70">';
						html += '    <col width="180">';
						html += '    <col width="220">';
						html += '    <col width="82">';
						html += '    <col width="160">';
						html += '    <col width="110">';
						html += '    <col width="110">';
						html += '    <col width="65">';
						html += '    <col width="110">';
						html += '    <col width="65">';
						html += '    <col width="110">';
						html += '    <col width="65">';
						html += '    <col width="110">';
						html += '    <col width="58">';
						html += '    <col width="*">';
						html += '</colgroup>';
						html += '<tbody role="header">';
						html += '	<tr>';
						html += '		<th class="colorZ">팀</th>';
						html += '		<th class="colorZ">현장<br>관리</th>';
						html += '		<th class="colorZ">건설사</th>';
						html += '		<th class="colorZ">현장명</th>';
						html += '		<th class="colorZ" style="border-right:2px solid black!important;">공사<br>기간</th>';
						html += '		<th class="colorZ" colspan="2" style="border-right:2px solid black!important;">계약금액</th>';
						html += '		<th class="colorZ">전회까지</th>';
						html += '		<th class="colorZ" style="border-right:2px solid black!important;">기성율</th>';
						html += '		<th class="colorZ">금회</th>';
						html += '		<th class="colorZ" style="border-right:2px solid black!important;">기성율</th>';
						html += '		<th class="colorZ">누계</th>';
						html += '		<th class="colorZ" style="border-right:2px solid black!important;">기성율</th>';
						html += '		<th class="colorZ" colspan="2">기성누계</th>';
						html += '		<th class="colorZ">비고</th>';
						html += '	</tr>';
						html += '</tbody>';
						html += '<tbody role="body">';
					}
					// body
                    var amount = parseInt(pValue.tax_amount) == 0?parseInt(pValue.excut_amount):parseInt(pValue.tax_amount);
					var sum = parseInt(pValue.complete_amount) + amount;

					var rt1 = (pValue.complete_amount/pValue.cntrct_amount)*100.0; if (isNaN(rt1)) { rt1 = 0.0; } if(rt1 == Infinity) rt1 = 0.0;
					var rt2 = (amount/pValue.cntrct_amount)*100.0; if (isNaN(rt2)) { rt2 = 0.0; } if(rt2 == Infinity) rt2 = 0.0;
					var rt3 = (sum/pValue.cntrct_amount)*100.0; if (isNaN(rt3)) { rt3 = 0.0; } if(rt3 == Infinity) rt3 = 0.0;

                    //배경색 조건
					var cbg = pValue.cntrct_execut_code == 'C' ? ' colorSky' : '';
					var isFailedExpect = parseInt(pValue.tax_amount) == 0? cbg : (parseInt(pValue.excut_amount)==parseInt(pValue.tax_amount)? cbg : ' colorP');
                    var isNewContract = LAST_SPT_NMS.hasOwnProperty(pValue.bsn_dept_code) && LAST_SPT_NMS[pValue.bsn_dept_code].includes(pValue.spt_nm) ? '' : ' colorY';
                    var isNewConstruct = LAST_PURCHSOFC_NMS.hasOwnProperty(pValue.bsn_dept_code) && LAST_PURCHSOFC_NMS[pValue.bsn_dept_code].hasOwnProperty(pValue.spt_nm) && LAST_PURCHSOFC_NMS[pValue.bsn_dept_code][pValue.spt_nm].includes(pValue.purchsofc_nm) ? '' : ' colorY';
                    var isChangedContractAmount = LAST_AMOUNTS.hasOwnProperty(pValue.bsn_dept_code) && LAST_AMOUNTS[pValue.bsn_dept_code].hasOwnProperty(pValue.spt_nm) && LAST_AMOUNTS[pValue.bsn_dept_code][pValue.spt_nm].hasOwnProperty(pValue.purchsofc_sn) && LAST_AMOUNTS[pValue.bsn_dept_code][pValue.spt_nm][pValue.purchsofc_sn] == pValue.cntrct_amount ? '' : ' colorY';
                    var isNoProject = pValue.prjct_creat_at == 'N' ? ' style="background:#eee!important;"' : '';
                    var isOverpay = rt3>100.0 ? ' colorP' : '';
                    var isEmuchC = (pValue.cntrct_execut_code == 'E' && amt[pValue.cntrct_sn]['C'] < amt[pValue.cntrct_sn]['E']) ? ' colorP' : '';


                    if(parseInt(pValue.cntrct_amount) == 0 && parseInt(pValue.tax_amount) == 0 && parseInt(pValue.excut_amount) == 0 && parseInt(pValue.complete_amount) == 0){}
                    else{
                        var cntrwk_bgnde = pValue.cntrwk_bgnde.substring(2,pValue.cntrwk_bgnde.length);
                        var cntrwk_endde = pValue.cntrwk_endde.substring(2,pValue.cntrwk_endde.length);
                        var p_amt_sum_rt = (parseInt(amt[pValue.cntrct_sn][pValue.cntrct_execut_code])/parseInt(pValue.c_amt_sum))*100;
                        html += '<tr>';
                        html += '    <td class="text-center">'+pValue.bsn_dept_nm+'</td>';
                        html += '    <td class="text-center" style="color:#333;"><span data-sn="'+pValue.bsn_dept_nm+'"></span>'+pValue.spt_chrg_nm.replaceAll(' ', '<br>')+'</td>';
                        html += '    <td class="text-center"><span data-sn="'+pValue.bsn_dept_nm+pValue.spt_chrg_nm+'"></span>'+pValue.cntrct_bcnc_nm+'</td>';
                        html += '    <td class="text-left font13'+isNewContract+'" title="'+pValue.cntrct_de+'" '+isNoProject+'>'+pValue.spt_nm+'</td>';
                        html += '    <td class="text-center'+isNewContract+'" style="line-height:14px;padding:7px 1px!important;border-right:2px solid black!important;">'+cntrwk_bgnde+'<br>~<br>'+cntrwk_endde+'<div style="display:none;">'+pValue.cntrct_sn+'</div></td>';
                        html += '    <td class="text-center'+cbg+isNewContract+isNewConstruct+'">'+pValue.purchsofc_nm+'</td>';
                        html += '    <td class="text-number'+cbg+isNewContract+isNewConstruct+isChangedContractAmount+'" style="border-right:2px solid black!important;">'+pValue.cntrct_amount.toString().toFormat('NUMBER')+'</td>';
                        html += '    <td class="text-number'+cbg+'">'+(parseInt(pValue.complete_amount) == 0 ? '' : pValue.complete_amount).toString().toFormat('NUMBER')+'</td>';
                        html += '    <td class="text-number'+cbg+'" style="border-right:2px solid black!important;">'+(rt1==0.0?'-' : (rt1.toFixed(1)+'%'))+'</td>';


                        if(pValue.CNTRCT_EXECUT_CODE == 'E' && (['1','2','3','4'].includes(pValue.ct_se_code))){
                            html += '    <td class="text-number'+isFailedExpect+'" style="'+(parseInt(pValue.tax_amount) == 0? 'color:red;' : '')+'">'+(amount == 0 ? '' : amount.toString().toFormat('NUMBER'))+'</td>';
                        }
                        else if((pValue.spt_chrg_sn != parseInt(loginSN)) && "{{session['member']['auth_cd']}}" != "1"){
                            html += '    <td class="text-number'+isFailedExpect+'" style="'+(parseInt(pValue.tax_amount) == 0? 'color:red;' : '')+'">'+(amount == 0 ? '' : amount.toString().toFormat('NUMBER'))+'</td>';
                        }
                        else{

                            html += `    <td class="text-number ${isFailedExpect} input-available" data-amount="${pValue.cntrct_amount}" data-cntrct_sn="${pValue.cntrct_sn}" data-prjct_sn="${pValue.prjct_sn}" data-bcnc_sn="${pValue.purchsofc_sn}" data-cntrct_execut_code="${pValue.cntrct_execut_code}" data-ct_se_code="${pValue.ct_se_code}" style="${(parseInt(pValue.tax_amount) == 0? 'color:red;' : '')}">${(amount == 0 ? '' : amount.toString().toFormat('NUMBER'))}</td>`;
                        }


                        html += '    <td class="text-number'+isFailedExpect+'" style="'+(parseInt(pValue.tax_amount) == 0? 'color:red;' : '')+'border-right:2px solid black!important;">'+(rt2==0.0?'':(rt2.toFixed(1)+'%'))+'</td>';
                        html += '    <td class="text-number'+cbg+'">'+(sum==0?'':sum).toString().toFormat('NUMBER')+'</td>';
                        html += '    <td class="text-number'+cbg+isOverpay+'" style="border-right:2px solid black!important;">'+(rt3==0.0?'-':(rt3.toFixed(1)+'%'))+'</td>';
                        html += '    <td class="text-number'+cbg+isEmuchC+'">'+amt[pValue.cntrct_sn][pValue.cntrct_execut_code].toString().toFormat('NUMBER')+'<div style="display:none;">'+pValue.cntrct_sn+':'+pValue.cntrct_execut_code+'</div></td>';
                        html += '    <td class="text-number'+cbg+'">'+p_amt_sum_rt.toFixed(1)+'%<div style="display:none;">'+pValue.cntrct_sn+':'+pValue.cntrct_execut_code+'</div></td>';
                        html += '    <td class="text-left"><span data-sn="'+pValue.cntrct_sn+'"></span>'+rm[pValue.cntrct_sn]+'</td>';
                        html += '</tr>';
                    }
					if (pValue.cntrct_execut_code == 'C') {
						c_cntrct_amount += parseInt(pValue.cntrct_amount);
						c_complete_amount += parseInt(pValue.complete_amount);
						c_excut_amount += (parseInt(pValue.tax_amount) == 0?parseInt(pValue.excut_amount):parseInt(pValue.tax_amount));
						c_sum_amount += parseInt(sum);
                        if(member.hasOwnProperty(pValue.spt_chrg_sn)){
                            member[pValue.spt_chrg_sn]['C'] += (parseInt(pValue.tax_amount) == 0?parseInt(pValue.excut_amount):parseInt(pValue.tax_amount));
                        }
					}
					if (pValue.cntrct_execut_code == 'E') {
						e_cntrct_amount += parseInt(pValue.cntrct_amount);
						e_complete_amount += parseInt(pValue.complete_amount);
						e_excut_amount += (parseInt(pValue.tax_amount) == 0?parseInt(pValue.excut_amount):parseInt(pValue.tax_amount));
						e_sum_amount += parseInt(sum);
                        if(member.hasOwnProperty(pValue.spt_chrg_nm)){
                            member[pValue.spt_chrg_nm]['E'] += (parseInt(pValue.tax_amount) == 0?parseInt(pValue.excut_amount):parseInt(pValue.tax_amount));
                        }
					}

					if (pIndex == (pResult.completedList.length-1)) {
                        var c_sum = parseInt(c_complete_amount)+parseInt(c_excut_amount);
						var c_rt1 = (c_complete_amount/c_cntrct_amount)*100;
						var c_rt2 = (c_excut_amount/c_cntrct_amount)*100;
						var c_rt3 = (c_sum/c_cntrct_amount)*100;
						var p_sub_amt = parseInt(c_excut_amount) - parseInt(e_excut_amount)

						html += '</tbody>';
						html += '<tbody role="footer" style="border-bottom:3px solid #000!important;">';
						html += '	<tr>';
						html += '		<th class="colorZ" colspan="5" rowspan="2" style="border-right:2px solid black!important;">'+pValue.bsn_dept_nm+' 계</th>';
						html += '		<th class="colorZ">당사분</th>';
						html += '       <td class="text-number" style="border-right:2px solid black!important;" >'+c_cntrct_amount.toString().toFormat('NUMBER')+'</td>';
						html += '       <td class="text-number">'+c_complete_amount.toString().toFormat('NUMBER')+'</td>';
						html += '       <td class="text-number" style="border-right:2px solid black!important;">'+c_rt1.toFixed(1)+'%</td>';
						html += '       <td class="text-number">'+c_excut_amount.toString().toFormat('NUMBER')+'</td>';
						html += '       <td class="text-number" style="border-right:2px solid black!important;">'+c_rt2.toFixed(1)+'%</td>';
						html += '       <td class="text-number">'+c_sum_amount.toString().toFormat('NUMBER')+'</td>';
						html += '       <td class="text-number" style="border-right:2px solid black!important;">'+c_rt3.toFixed(1)+'%</td>';
						html += '       <th class="colorZ" colspan="2" rowspan="1">매출차액</th>';
						html += '       <td class="text-number" colspan="1" rowspan="1">'+p_sub_amt.toString().toFormat('NUMBER')+'</td>';
						html += '	</tr>';

						var e_sum = parseInt(e_complete_amount)+parseInt(e_excut_amount);
						var e_rt1 = (e_complete_amount/e_cntrct_amount)*100;
						var e_rt2 = (e_excut_amount/e_cntrct_amount)*100;
						var e_rt3 = (e_sum/e_cntrct_amount)*100;
						var p_sub_amt = parseInt(c_cntrct_amount) - parseInt(c_sum_amount);

						html += '	<tr style="border-bottom:3px solid #000!important;">';
						html += '		<th class="colorZ">업체분</th>';
						html += '       <td class="text-number" style="border-right:2px solid black!important;">'+e_cntrct_amount.toString().toFormat('NUMBER')+'</td>';
						html += '       <td class="text-number">'+e_complete_amount.toString().toFormat('NUMBER')+'</td>';
						html += '       <td class="text-number" style="border-right:2px solid black!important;">'+e_rt1.toFixed(1)+'%</td>';
						html += '       <td class="text-number">'+e_excut_amount.toString().toFormat('NUMBER')+'</td>';
						html += '       <td class="text-number" style="border-right:2px solid black!important;">'+e_rt2.toFixed(1)+'%</td>';
						html += '       <td class="text-number">'+e_sum_amount.toString().toFormat('NUMBER')+'</td>';
						html += '       <td class="text-number" style="border-right:2px solid black!important;">'+e_rt3.toFixed(1)+'%</td>';
						html += '       <th class="colorZ" colspan="2" rowspan="1">수주잔고</th>';
						html += '       <td class="text-number" colspan="1" rowspan="1">'+p_sub_amt.toString().toFormat('NUMBER')+'</td>';
						html += '	</tr>';
						html += '</tbody>';
						html += '</table>';
                        data[before] = {};
                        data[before]['C'] = parseInt(c_excut_amount);
                        data[before]['E'] = parseInt(e_excut_amount);
                        c_cntrct_amount = 0, c_complete_amount = 0, c_excut_amount = 0, c_sum_amount = 0;
						e_cntrct_amount = 0, e_complete_amount = 0, e_excut_amount = 0, e_sum_amount = 0;
					}

					// 테이블 행 처리용
					before = pValue.bsn_dept_nm;
                    before_bsn_dept_code = pValue.bsn_dept_code;
				});
				$('#popReport').find('#rptCompletedArea').html(html);
				$('#popReport').find('#rptCompletedListTS1 tbody[role=body]').yRowspan(0);
				$('#popReport').find('#rptCompletedListTS1 tbody[role=body]').yRowspan(1);
				$('#popReport').find('#rptCompletedListTS1 tbody[role=body]').yRowspan(2);
				$('#popReport').find('#rptCompletedListTS1 tbody[role=body]').yRowspan(3);
				$('#popReport').find('#rptCompletedListTS1 tbody[role=body]').yRowspan(4);
				$('#popReport').find('#rptCompletedListTS1 tbody[role=body]').yRowspan(13);
				$('#popReport').find('#rptCompletedListTS1 tbody[role=body]').yRowspan(14);
				$('#popReport').find('#rptCompletedListTS1 tbody[role=body]').yRowspan(15);
				$('#popReport').find('#rptCompletedListTS2 tbody[role=body]').yRowspan(0);
				$('#popReport').find('#rptCompletedListTS2 tbody[role=body]').yRowspan(1);
				$('#popReport').find('#rptCompletedListTS2 tbody[role=body]').yRowspan(2);
				$('#popReport').find('#rptCompletedListTS2 tbody[role=body]').yRowspan(3);
				$('#popReport').find('#rptCompletedListTS2 tbody[role=body]').yRowspan(4);
				$('#popReport').find('#rptCompletedListTS2 tbody[role=body]').yRowspan(13);
				$('#popReport').find('#rptCompletedListTS2 tbody[role=body]').yRowspan(14);
				$('#popReport').find('#rptCompletedListTS2 tbody[role=body]').yRowspan(15);





				// ============================================================
				// 거래처 현장별 기성현황 총계
				var c_cntrct_amount_total = 0, c_complete_amount_total = 0, c_excut_amount_total = 0, c_sum_amount_total = 0;
				c_cntrct_amount_total += parseInt($('#popReport').find('#rptCompletedListTS1 tbody[role=footer] tr:eq(0) td').eq(0).html().replaceAll(',',''));
				c_cntrct_amount_total += parseInt($('#popReport').find('#rptCompletedListTS2 tbody[role=footer] tr:eq(0) td').eq(0).html().replaceAll(',',''));
				// c_cntrct_amount_total += parseInt($('#popReport').find('#rptCompletedListTS3 tbody[role=footer] tr:eq(0) td').eq(0).html().replaceAll(',',''));
				c_complete_amount_total += parseInt($('#popReport').find('#rptCompletedListTS1 tbody[role=footer] tr:eq(0) td').eq(1).html().replaceAll(',',''));
				c_complete_amount_total += parseInt($('#popReport').find('#rptCompletedListTS2 tbody[role=footer] tr:eq(0) td').eq(1).html().replaceAll(',',''));
				// c_complete_amount_total += parseInt($('#popReport').find('#rptCompletedListTS3 tbody[role=footer] tr:eq(0) td').eq(1).html().replaceAll(',',''));
				c_excut_amount_total += parseInt($('#popReport').find('#rptCompletedListTS1 tbody[role=footer] tr:eq(0) td').eq(3).html().replaceAll(',',''));
				c_excut_amount_total += parseInt($('#popReport').find('#rptCompletedListTS2 tbody[role=footer] tr:eq(0) td').eq(3).html().replaceAll(',',''));
				// c_excut_amount_total += parseInt($('#popReport').find('#rptCompletedListTS3 tbody[role=footer] tr:eq(0) td').eq(3).html().replaceAll(',',''));
				c_sum_amount_total += parseInt($('#popReport').find('#rptCompletedListTS1 tbody[role=footer] tr:eq(0) td').eq(5).html().replaceAll(',',''));
				c_sum_amount_total += parseInt($('#popReport').find('#rptCompletedListTS2 tbody[role=footer] tr:eq(0) td').eq(5).html().replaceAll(',',''));
				// c_sum_amount_total += parseInt($('#popReport').find('#rptCompletedListTS3 tbody[role=footer] tr:eq(0) td').eq(5).html().replaceAll(',',''));
				var e_cntrct_amount_total = 0, e_complete_amount_total = 0, e_excut_amount_total = 0, e_sum_amount_total = 0;
				e_cntrct_amount_total += parseInt($('#popReport').find('#rptCompletedListTS1 tbody[role=footer] tr:eq(1) td').eq(0).html().replaceAll(',',''));
				e_cntrct_amount_total += parseInt($('#popReport').find('#rptCompletedListTS2 tbody[role=footer] tr:eq(1) td').eq(0).html().replaceAll(',',''));
				// e_cntrct_amount_total += parseInt($('#popReport').find('#rptCompletedListTS3 tbody[role=footer] tr:eq(1) td').eq(0).html().replaceAll(',',''));
				e_complete_amount_total += parseInt($('#popReport').find('#rptCompletedListTS1 tbody[role=footer] tr:eq(1) td').eq(1).html().replaceAll(',',''));
				e_complete_amount_total += parseInt($('#popReport').find('#rptCompletedListTS2 tbody[role=footer] tr:eq(1) td').eq(1).html().replaceAll(',',''));
				// e_complete_amount_total += parseInt($('#popReport').find('#rptCompletedListTS3 tbody[role=footer] tr:eq(1) td').eq(1).html().replaceAll(',',''));
				e_excut_amount_total += parseInt($('#popReport').find('#rptCompletedListTS1 tbody[role=footer] tr:eq(1) td').eq(3).html().replaceAll(',',''));
				e_excut_amount_total += parseInt($('#popReport').find('#rptCompletedListTS2 tbody[role=footer] tr:eq(1) td').eq(3).html().replaceAll(',',''));
				// e_excut_amount_total += parseInt($('#popReport').find('#rptCompletedListTS3 tbody[role=footer] tr:eq(1) td').eq(3).html().replaceAll(',',''));
				e_sum_amount_total += parseInt($('#popReport').find('#rptCompletedListTS1 tbody[role=footer] tr:eq(1) td').eq(5).html().replaceAll(',',''));
				e_sum_amount_total += parseInt($('#popReport').find('#rptCompletedListTS2 tbody[role=footer] tr:eq(1) td').eq(5).html().replaceAll(',',''));
				// e_sum_amount_total += parseInt($('#popReport').find('#rptCompletedListTS3 tbody[role=footer] tr:eq(1) td').eq(5).html().replaceAll(',',''));

				var c_sum = parseInt(c_complete_amount_total)+parseInt(c_excut_amount_total);
				var c_rt1 = (c_complete_amount_total/c_cntrct_amount_total)*100;
				var c_rt2 = (c_excut_amount_total/c_cntrct_amount_total)*100;
				var c_rt3 = (c_sum/c_cntrct_amount_total)*100;

//
//                						html += '    <col width="50">';
//						html += '    <col width="130">';
//						html += '    <col width="180">';
//						html += '    <col width="82">';
//						html += '    <col width="130">';
//						html += '    <col width="110">';
//						html += '    <col width="110">';
//						html += '    <col width="58">';
//						html += '    <col width="110">';
//						html += '    <col width="58">';
//						html += '    <col width="110">';
//						html += '    <col width="58">';
//						html += '    <col width="70">';
//						html += '    <col width="110">';
//						html += '    <col width="58">';
//						html += '    <col width="360">';
                html = '';
//				html += '<table>';
//				html += '<colgroup>';
//						html += '    <col width="50">';
//						html += '    <col width="180">';
//						html += '    <col width="220">';
//						html += '    <col width="82">';
//						html += '    <col width="160">';
//						html += '    <col width="110">';
//						html += '    <col width="110">';
//						html += '    <col width="65">';
//						html += '    <col width="110">';
//						html += '    <col width="65">';
//						html += '    <col width="110">';
//						html += '    <col width="65">';
//						html += '    <col width="70">';
//						html += '    <col width="110">';
//						html += '    <col width="58">';
//						html += '    <col width="*">';
//                html += '</colgroup>';
				html += '<tbody role="footer_tot" style="border:3px solid #fff!important;">';
                html += '   <tr>';
                html += '       <td style="border:none!important;">&nbsp;</td>';
                html += '   </tr>';
                html += '</tbody>';
                html += '<tbody role="footer_tot" style="border-top:3px solid #000!important;">';
				html += '	<tr style="border-top:3px solid #000!important;">';
				html += '		<th class="colorZ" rowspan="2" colspan="5"  style="border-right:2px solid black!important;">총&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;계</th>';
				html += '		<th class="colorZ">당사분</th>';
				html += '       <td class="text-number" style="border-right:2px solid black!important;">'+c_cntrct_amount_total.toString().toFormat('NUMBER')+'</td>';
				html += '       <td class="text-number">'+c_complete_amount_total.toString().toFormat('NUMBER')+'</td>';
				html += '       <td class="text-number" style="border-right:2px solid black!important;">'+c_rt1.toFixed(1)+'%</td>';
				html += '       <td class="text-number">'+c_excut_amount_total.toString().toFormat('NUMBER')+'</td>';
				html += '       <td class="text-number" style="border-right:2px solid black!important;">'+c_rt2.toFixed(1)+'%</td>';
				html += '       <td class="text-number">'+c_sum_amount_total.toString().toFormat('NUMBER')+'</td>';
				html += '       <td class="text-number" style="border-right:2px solid black!important;">'+c_rt3.toFixed(1)+'%</td>';
				html += '       <th class="colorZ" rowspan="1" colspan="2">매출차액</th>';
				var p_sub_amt = parseInt(c_excut_amount_total) - parseInt(e_excut_amount_total)
				html += '       <td class="text-number" rowspan="1">'+p_sub_amt.toString().toFormat('NUMBER')+'</td>';
				html += '	</tr>';

				var e_sum = parseInt(e_complete_amount_total)+parseInt(e_excut_amount_total);
				var e_rt1 = (e_complete_amount_total/e_cntrct_amount_total)*100;
				var e_rt2 = (e_excut_amount_total/e_cntrct_amount_total)*100;
				var e_rt3 = (e_sum/e_cntrct_amount_total)*100;
				html += '	<tr>';
				html += '		<th class="colorZ">업체분</th>';
				html += '       <td class="text-number" style="border-right:2px solid black!important;">'+e_cntrct_amount_total.toString().toFormat('NUMBER')+'</td>';
				html += '       <td class="text-number">'+e_complete_amount_total.toString().toFormat('NUMBER')+'</td>';
				html += '       <td class="text-number" style="border-right:2px solid black!important;">'+e_rt1.toFixed(1)+'%</td>';
				html += '       <td class="text-number">'+e_excut_amount_total.toString().toFormat('NUMBER')+'</td>';
				html += '       <td class="text-number" style="border-right:2px solid black!important;">'+e_rt2.toFixed(1)+'%</td>';
				html += '       <td class="text-number">'+e_sum_amount_total.toString().toFormat('NUMBER')+'</td>';
				html += '       <td class="text-number" style="border-right:2px solid black!important;">'+e_rt3.toFixed(1)+'%</td>';
                html += '       <th class="colorZ" rowspan="1" colspan="2">수주잔고</th>';
				var p_sub_amt = parseInt(c_cntrct_amount_total) - parseInt(c_sum_amount_total)
				html += '       <td class="text-number" rowspan="1">'+p_sub_amt.toString().toFormat('NUMBER')+'</td>';

				html += '	</tr>';
				html += '</tbody>';
//				html += '</table>';
//                $('#popReport').find('#rptCompletedArea').find('table:last-child').find('tbody:last-child').find('tr:last-child').css('border-bottom-style', '3px solid #000!important');
                $('#popReport').find('#rptCompletedArea').find('table:last-child').append(html);
//				$('#popReport').find('#rptCompletedArea').append(html);
//				$('#popReport').find('#rptCompletedTotal').html(html);


                $.each(data, function(idx, val){
                    var trs = $('#popReport').find('#rptContractStatus tbody[role=body]').find('tr[class=amt'+idx+']');

                    $.each(trs, function(i, tr){
                        var goal_tr = $(tr).next();
                        var tot_tr = $(goal_tr).next();

                        var before_b_amt1 = $(tr).find('td').eq(3).html().replaceAll(',', '');
                        before_b_amt1 = before_b_amt1 == '' ? 0 : parseInt(before_b_amt1);
                        var before_b_amt3 = $(tr).find('td').eq(6).html().replaceAll(',', '');
                        before_b_amt3 = before_b_amt3 == '' ? 0 : parseInt(before_b_amt3);

                        var b_amt1 = 0;
                        if($(tr).data('ty') == '3'){
                            b_amt1 = val['C'];
                        }
                        else{
                            b_amt1 = val['C']-val['E'];
                        }

                        var b_amt3 = before_b_amt3 - before_b_amt1 + b_amt1;


                        $(tr).find('td').eq(3).html(b_amt1.toString().toFormat('NUMBER'));
                        $(tr).find('td').eq(6).html(b_amt3.toString().toFormat('NUMBER'));



                        var before_t_amt1 = $(goal_tr).find('td').eq(3).html().replaceAll(',', '');
                        before_t_amt1 = before_t_amt1 == '' ? 0 : parseInt(before_t_amt1);
                        var before_t_amt3 = $(goal_tr).find('td').eq(6).html().replaceAll(',', '');
                        before_t_amt3 = before_t_amt3 == '' ? 0 : parseInt(before_t_amt3);
                        var t_amt1 = (b_amt1 + before_t_amt1);
                        var t_amt2 = parseInt($(tot_tr).find('td').eq(2).html().replaceAll(',', ''));
                        var t_amt3 = (b_amt3 + before_t_amt3);
                        var t_amt4 = parseInt($(tot_tr).find('td').eq(5).html().replaceAll(',', ''));
                        var t_amt5 = parseInt($(tot_tr).find('td').eq(8).html().replaceAll(',', ''));

                        var rt1 = (t_amt2 < 0) ? 100.0 + (t_amt2 - t_amt1)*100/t_amt2 : (t_amt1/t_amt2)*100; if (isNaN(rt1)) rt1 = 0.0;
                        rt1 = (rt1 == Infinity)? '' : (rt1.toFixed(1)+'%');
                        var rt2 = (t_amt4 < 0) ? 100.0 + (t_amt4 - t_amt3)*100/t_amt4 : (t_amt3/t_amt4)*100; if (isNaN(rt2)) rt2 = 0.0;
                        rt2 = (rt2 == Infinity)? '' : (rt2.toFixed(1)+'%');
                        var rt3 = (t_amt3/t_amt5)*100; if (isNaN(rt3)) rt3 = 0.0;
                        rt3 = (rt3 == Infinity)? '' : (rt3.toFixed(1)+'%');
                        $(tot_tr).find('td').eq(3).html(t_amt1.toString().toFormat('NUMBER'));
                        $(tot_tr).find('td').eq(4).html(rt1);
                        $(tot_tr).find('td').eq(6).html(t_amt3.toString().toFormat('NUMBER'));
                        $(tot_tr).find('td').eq(7).html(rt2);
                        $(tot_tr).find('td').eq(9).html(rt3);
                        //$(tr).find('td').eq(4).html(val['C']);
                    });
                });
                var trs = $('#popReport').find('#rptContractStatus tbody[role=body]').find('tr[class=dept_total]');
                $.each(trs, function(i, tr){
                    var tr1 = $(tr).prev();
                    var tr2 = $(tr1).prev().prev().prev();
                    var tr3 = $(tr2).prev().prev().prev();

                    var amt1_1 = $(tr1).find('td').eq(3).html().replaceAll(',', '');
                    amt1_1 = amt1_1 == '' ? 0 : parseInt(amt1_1);
                    var amt1_2 = $(tr2).find('td').eq(3).html().replaceAll(',', '');
                    amt1_2 = amt1_2 == '' ? 0 : parseInt(amt1_2);
                    var amt1_3 = $(tr3).find('td').eq(3).html().replaceAll(',', '');
                    amt1_3 = amt1_3 == '' ? 0 : parseInt(amt1_3);

                    var amt3_1 = $(tr1).find('td').eq(6).html().replaceAll(',', '');
                    amt3_1 = amt3_1 == '' ? 0 : parseInt(amt3_1);
                    var amt3_2 = $(tr2).find('td').eq(6).html().replaceAll(',', '');
                    amt3_2 = amt3_2 == '' ? 0 : parseInt(amt3_2);
                    var amt3_3 = $(tr3).find('td').eq(6).html().replaceAll(',', '');
                    amt3_3 = amt3_3 == '' ? 0 : parseInt(amt3_3);

                    var amt2 = $(tr).find('td').eq(2).html().replaceAll(',', '');
                    amt2 = amt2 == '' ? 0 : parseInt(amt2);
                    var amt1 = (amt1_1 + amt1_2 + amt1_3);
                    var amt4 = $(tr).find('td').eq(5).html().replaceAll(',', '');
                    amt4 = amt4 == '' ? 0 : parseInt(amt4);
                    var amt3 = (amt3_1 + amt3_2 + amt3_3);
                    var amt5 = $(tr).find('td').eq(8).html().replaceAll(',', '');
                    amt5 = amt5 == '' ? 0 : parseInt(amt5);


                    var rt1 = (amt2 < 0) ? 100.0 + (amt2 - amt1)*100/amt2 : (amt1/amt2)*100; if (isNaN(rt1)) rt1 = 0.0;
                    rt1 = (rt1 == Infinity)? '' : (rt1.toFixed(1)+'%');
                    var rt2 = (amt4 < 0) ? 100.0 + (amt4 - amt3)*100/amt4 : (amt3/amt4)*100; if (isNaN(rt2)) rt2 = 0.0;
                    rt2 = (rt2 == Infinity)? '' : (rt2.toFixed(1)+'%');
                    var rt3 = (amt3/amt5)*100; if (isNaN(rt3)) rt3 = 0.0;
                    rt3 = (rt3 == Infinity)? '' : (rt3.toFixed(1)+'%');

                    $(tr).find('td').eq(3).html( amt1.toString().toFormat('NUMBER') );
                    $(tr).find('td').eq(4).html( rt1 );
                    $(tr).find('td').eq(6).html( amt3.toString().toFormat('NUMBER') );
                    $(tr).find('td').eq(7).html( rt2 );
                    $(tr).find('td').eq(9).html( rt3 );

                });
                var cells = $('#popReport').find('#rptContractStatus tbody[role=body] td, #rptContractStatus tbody[role=body] th');
                $.each(cells, function(pIndex, pValue){
                    let value = $(pValue).html();
                    if(value == '0' || value == '0.0%' || value=='-Infinity%' || value=='Infinity%'){

                        $(pValue).html('');
                    }
                });

                var trs = $('#popReport').find('#rptExecutStatus tbody[role=body]').find('tr');
                var t_total1 = 0, t_total2 = 0, t_total3 = 0, t_total4 = 0;
                $.each(trs, function(i, tr){
                    var mber_nm = $(tr).find('td').eq(1).html();
                    if(mber_nm != '계'){
                        var total3 = $(tr).find('td').eq(5).html().replaceAll(',', '');
                        total3 = total3 == '' ? 0 : parseInt(total3);
                        var total4 = $(tr).find('td').eq(6).html().replaceAll(',', '');
                        total4 = total4 == '' ? 0 : parseInt(total4);
                        var before_total1 = $(tr).find('td').eq(2).html().replaceAll(',', '');
                        before_total1 = before_total1 == '' ? 0 : parseInt(before_total1);
                        var before_total2 = $(tr).find('td').eq(3).html().replaceAll(',', '');
                        before_total2 = before_total2 == '' ? 0 : parseInt(before_total2);

                        var total1 = before_total1;
                        var total2 = before_total2;
                        if(member.hasOwnProperty(mber_nm)){
                            total1 = member[mber_nm]['C'];
                            total2 = member[mber_nm]['E'];
                        }

                        total3 = total3 - before_total1 + total1;
                        total4 = total4 - before_total2 + total2;
                        var rt1 = (total1 < 0) ? 100.0 + (total1 - total2)*100/total1 :  (total2/total1)*100; if (isNaN(rt1)) rt1 = 0.0;
                        rt1 = (rt1 == Infinity)? '' : (rt1.toFixed(1)+'%');
						var rt2 = (total3 < 0) ? 100.0 + (total3 - total4)*100/total3 :  (total4/total3)*100; if (isNaN(rt2)) rt2 = 0.0;
                        rt2 = (rt2 == Infinity)? '' : (rt2.toFixed(1)+'%');
                        $(tr).find('td').eq(2).html(total1.toString().toFormat('NUMBER'));
                        $(tr).find('td').eq(3).html(total2.toString().toFormat('NUMBER'));
                        $(tr).find('td').eq(4).html(rt1);
                        $(tr).find('td').eq(5).html(total3.toString().toFormat('NUMBER'));
                        $(tr).find('td').eq(6).html(total4.toString().toFormat('NUMBER'));
                        $(tr).find('td').eq(7).html(rt2);


                        t_total1 += total1;
                        t_total2 += total2;
                        t_total3 += total3;
                        t_total4 += total4;
                    }
                    else{
                        var rt1 =  (t_total1 < 0) ? 100.0 + (t_total1 - t_total2)*100/t_total1 : (t_total2/t_total1)*100; if (isNaN(rt1)) rt1 = 0.0;
                        rt1 = (rt1 == Infinity)? '' : (rt1.toFixed(1)+'%');
						var rt2 =  (t_total3 < 0) ? 100.0 + (t_total3 - t_total4)*100/t_total3 : (t_total4/t_total3)*100; if (isNaN(rt2)) rt2 = 0.0;
                        rt2 = (rt2 == Infinity)? '' : (rt2.toFixed(1)+'%');
                        $(tr).find('td').eq(2).html(t_total1.toString().toFormat('NUMBER'));
                        $(tr).find('td').eq(3).html(t_total2.toString().toFormat('NUMBER'));
                        $(tr).find('td').eq(4).html(rt1);
                        $(tr).find('td').eq(5).html(t_total3.toString().toFormat('NUMBER'));
                        $(tr).find('td').eq(6).html(t_total4.toString().toFormat('NUMBER'));
                        $(tr).find('td').eq(7).html(rt2);

                    }
                });
                var cells = $('#popReport').find('#rptExecutStatus tbody[role=body] td, #rptExecutStatus tbody[role=body] th');
                $.each(cells, function(pIndex, pValue){
                    let value = $(pValue).clone().children().remove().end().text();
                    if(value == '0' || value == '0.0%' || value=='-Infinity%' || value=='Infinity%'){
                        $(pValue).html('');
                    }
                });
			}
		}
	});
}

</script>

<script>
    $(document).on("dblclick", ".input-available", function(){
        /*
         * 8/31 기능해제
        var cntrct_sn = $(this).data("cntrct_sn");
        var prjct_sn = $(this).data("prjct_sn");
        var bcnc_sn = $(this).data("bcnc_sn");
        var cntrct_execut_code = $(this).data("cntrct_execut_code");
        var ct_se_code = $(this).data("ct_se_code");
        var pxcond_mt = $(document).find('#s_pxcond_mt').val();
        var data = prompt("값을 입력하세요.");
        var target = $(this);
        var cntrct_amount = $(this).data("amount");
        try{
            if(/^-?\d+$/.test(data)){
                data = parseInt(data);
            }
            else{
                throw new Error(`Parameter is not a number : ${data}`);
            }
        }catch(e){
            alert("숫자 형식이 아닙니다. 올바른 형식으로 입력해주세요.");
            return false;
        }
        var params = {"cntrct_sn" : cntrct_sn, "prjct_sn" : prjct_sn, "bcnc_sn" : bcnc_sn, "cntrct_execut_code" : cntrct_execut_code, "ct_se_code" : ct_se_code, "pxcond_mt" : pxcond_mt, "excut_amount" : data};
        $.ajax({
            url : '/api/completed/ajax_insert_completed',
            method : 'POST',
            data : params,
            success: function(pResult){
                $(target).html(data.toFormat('NUMBER'));
                var rt2 = (data/cntrct_amount)*100.0; if (isNaN(rt2)) { rt2 = 0.0; } if(rt2 == Infinity) rt2 = 0.0;
                $(target).next().html(rt2.toFixed(1)+"%");

            }

        });
        */

    });
	$('#popReport').find('#s_pxcond_mt').on('change', function(pEvent) {
		getReportNR($(this).val());
	});
    $(document).ready(function(){
		if ($(document).find('#s_pxcond_mt').val() == '') {
			$(document).find('#s_pxcond_mt').datepicker('setDate', 'today');
		}
        getReportNR($(document).find('#s_pxcond_mt').val());

    });


	$(function() {
		/**************************************************************************
		 * 인쇄 버튼 클릭 처리
		 */

        var excelHandler = {
            getExcelFileName : function(){
                return 'test.xlsx';	//파일명
            },
            getSheetName : function(){
                return 'Sheet1';	//시트명
            },
            getExcelData : function(){
                return document.getElementById('rptCompletedListTS1'); 	//TABLE id
            },
            getWorksheet : function(){
                return XLSX.utils.table_to_sheet(this.getExcelData());
            }
        }

        function s2ab(s) {
          var buf = new ArrayBuffer(s.length); //convert s to arrayBuffer
          var view = new Uint8Array(buf);  //create uint8array as viewer
          for (var i=0; i<s.length; i++) view[i] = s.charCodeAt(i) & 0xFF; //convert to octet
          return buf;
        }
		$('#btnPrint2').on('click', function(pEvent) {
			var html = $('#popReport').find('.modal-body').html();
			$('#_print').contents().find('body>div.report').html('');
			$('#_print').contents().find('body>div.report').html(html);
			parent.frames['_print'].focus();
			parent.frames['_print'].print();
		});
        $('#btnDownload').on("click", function(pEvent){
            $("#rptCompletedListTS1").find("td, th").each(function(pIndex, pTag){
                if($(pTag).css('display') == 'none'){
                    $(pTag).remove();
                }
                else{
                    $(pTag).find("div").each(function(pIndex, pT){
                        if($(pT).css('display') == 'none'){
                            $(pT).remove();
                        }

                    })
                }
            });
              var wb = XLSX.utils.book_new();
              var newWorksheet = excelHandler.getWorksheet();

              // step 3. workbook에 새로만든 워크시트에 이름을 주고 붙인다.
              XLSX.utils.book_append_sheet(wb, newWorksheet, excelHandler.getSheetName());

              // step 4. 엑셀 파일 만들기
              var wbout = XLSX.write(wb, {bookType:'xlsx',  type: 'binary'});

              // step 5. 엑셀 파일 내보내기
              saveAs(new Blob([s2ab(wbout)],{type:"application/octet-stream"}), excelHandler.getExcelFileName());
        });
	});

</script>
{% endblock %}
