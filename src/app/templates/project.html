{% extends 'common/main_base.html' %}
{% block content %}
<!--########################################################################-->
<!--# contents style start                                                 #-->
<!--########################################################################-->
<style type="text/css">
tbody .btnUpdate, tbody .btnPrint{
    line-height: 0.3!important;
    padding: 3px 7px!important;
}
    tbody{
        font-size:12px!important;
    }
</style>

<style>
    #summery{
        top:63px;
        left:720px;
        width:400px;
    }
    #temp{
        display:none;
    }
@media (min-width: 100px) and (max-width: 1024px) {

    #summery{
        top:150px;
        left:13px;
        width:400px;
    }
    #temp{
        display:block;
    }
}
</style>
<!--########################################################################-->
<!--# contents style end                                                   #-->
<!--########################################################################-->


<!--########################################################################-->
<!--# RIBBON area start                                                    #-->
<!--########################################################################-->
<div id="ribbon" style="background:#B3E5FC!important;">
	<span class="ribbon-button-alignment">
		<span class="btn btn-ribbon"><i class="fa fa-refresh"></i></span>
	</span>
	<ol class="breadcrumb" style="font-size:14px !important;">
<!--		<li>홈</li><li>계약 및 프로젝트</li><li>계약 및 프로젝트 등록</li>-->
        <style>
            .breadcrumb>li+li:before {
                content: ">";
                color : #374850!important;
            }
        </style>
        <li style="font-size:17px !important;color:#1565C0!important;">계약 / 프로젝트 관리 </li><li><span> 계약 / 프로젝트</span></li>
	</ol>
</div>
<!--########################################################################-->
<!--# RIBBON area end                                                      #-->
<!--########################################################################-->


<!--########################################################################-->
<!--# contents area start                                                  #-->
<!--########################################################################-->
<div id="content">

	<!-- 화면 제목 -->
	<div class="row">
		<div class="col-xs-12 col-sm-7 col-md-7 col-lg-4">
<!--
			<h1 class="page-title txt-color-blueDark">
				<i class="fa-fw fa fa-list-alt"></i>
					계약 및 프로젝트 등록 <span>> 계약 및 프로젝트</span>
			</h1>
-->
		</div>
		<!-- right side of the page with the sparkline graphs -->
		<div class="col-xs-12 col-sm-5 col-md-5 col-lg-8">
		</div>
	</div>

	<!-- 화면 설명 -->
	<div class="alert alert-block alert-info" style="background:#e6faff!important;">
		<p><i class="fa-fw fa fa-info"></i>
			총 수주금액이 <span style="font-weight:bold!important;">1천만원</span> 이상이고 <span style="font-weight:bold!important;">공사성 계약</span>의 경우에 한해 프로젝트를 생성합니다.
		</p>
	</div>

    <!-- 집계표 -->
	<table class="table table-bordered table-summery" id="summery">
		<thead>
			<tr><th colspan="4">
					<!-- 집&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;계&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;표 -->
					계&nbsp;약&nbsp;/&nbsp;프&nbsp;로&nbsp;젝&nbsp;트&nbsp;&nbsp;&nbsp;&nbsp;집&nbsp;계&nbsp;표
				</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<th style="background:#fff;width:60px;text-align:center;">건수</th>
				<td style="background:#fff;text-align:center;">0</td>
<!--				<th style="background:#fff;width:80px;text-align:center;">수주금액</th>-->
<!--				<td style="background:#fff;width:121px;text-align:right;">0</td>-->
				<th style="background:#fff;width:140px;text-align:center;">총 수주금액 계</th>
				<td style="background:#fff;width:121px;text-align:right;">0</td>
			</tr>
		</tbody>
	</table>

    <div id="temp">
        <br/>
        <br/>
        <br/>
        <br/>
    </div>

	<!-- 화면 내용 -->
	<section id="widget-grid">

		<div class="row">
			<article class="col-xs-12 col-sm-12 col-md-12 col-lg-12">

				<!-- Widget ID (each widget will need unique ID)-->
				<div class="jarviswidget jarviswidget-color-darken">
					<header>
						<span class="widget-icon"> <i class="fa fa-list"></i> </span>
						<h2>계약 / 프로젝트 목록</h2>
						<div class="widget-toolbar">
<!--                            <button class="btn btn-info" data-toggle="modal" href="#popReport7"><i class="fa fa-print"> 업무일지</i></button>-->
							<button class="btn btn-success" id="btnExcel"><i class="fa fa-file-excel-o"> 엑셀 다운로드</i></button>
							<button class="btn btn-warning" id="btnBiss" data-toggle="modal" href="#popBoxBiss">BISS 입력</i></button>
						</div>
					</header>
					<!-- widget body div-->
					<div>
						<!-- widget edit box -->
						<div class="jarviswidget-editbox">
						</div>
						<!-- end widget edit box -->

						<!-- widget content -->
						<div class="widget-body no-padding">
							<!-- <table class="table table-bordered" style="">
								<colgroup>
									<col width="667">
									<col width="60">
									<col width="60">
									<col width="60">
									<col width="60">
									<col width="120">
									<col width="*">
								</colgroup>
								<thead>
									<tr>
										<th class="text-center"></th>
										<th class="text-center" style="background:#ccc;">집계표</th>
										<th class="text-center">건수</td>
										<td class="text-center" style="background:#fff;">0</td>
										<th class="text-center">합계</td>
										<td class="text-number" style="background:#fff;">0</td>
										<th class="text-center"></th>
									</tr>
								</thead>
							</table> -->
							<table class="datatable table table-bordered table-hover" id="dtList1">
								<colgroup>
									<col width="50">
									<col width="150">
									<col width="170">
									<col width="*">
									<col width="120">
									<col width="136">
									<col width="130">
									<col width="130">
									<col width="130">
									<col width="202">
									<col width="100">
									<col width="80">
									<col width="1">
								</colgroup>
								<thead>
									<tr>
										<th class="search">검색</th>
										<th class="hasinput">
											<input type="text" class="form-control" placeholder="[전체]" id="s_cntrct_no" name="s_cntrct_no">
										</th>
										<th class="hasinput">
											<select class="form-control select2 w100p" id="s_bcnc_sn" name="s_bcnc_sn">
												<option value="">[전체]</option>
												{% for code in bcnc_list %}
												<option value="{{code.value}}">{{code.value}}.{{code.label}}</option>
												{% endfor %}
											</select>
										</th>
										<th class="hasinput">
											<input type="text" class="form-control" placeholder="[전체]" id="s_cntrct_nm" name="s_cntrct_nm">
										</th>
										<th class="hasinput">
										</th>
                                        <th class="hasinput">
											<select class="form-control select2 w100p" id="s_prjct_ty_code" name="s_prjct_ty_code">
												<option value="">[전체]</option>
												{% for code in prjct_ty_code_list %}
												<option value="{{code.value}}">{{code.label}}</option>
												{% endfor %}
											</select>
										</th>
										<th class="hasinput">
											<select class="form-control select2 w100p" id="s_dept_code" name="s_dept_code">
												<option value="">[전체]</option>
												<option value="TS">공조전체</option>
												{% for code in dept_code_list %}
												<option value="{{code.value}}">{{code.label}}</option>
												{% endfor %}
											</select>
										</th>
										<th class="hasinput">
											<select class="form-control select2 w100p" id="s_bsn_chrg_sn" name="s_bsn_chrg_sn">
												<option value="">[전체]</option>
												{% for code in member_list %}
												<option value="{{code.value}}">{{code.label}} {{code.etc1}}</option>
												{% endfor %}
											</select>
										</th>
										<th class="hasinput">
											<select class="form-control select2 w100p" id="s_spt_chrg_sn" name="s_spt_chrg_sn">
												<option value="">[전체]</option>
												{% for code in member_list %}
												<option value="{{code.value}}">{{code.label}} {{code.etc1}}</option>
												{% endfor %}
											</select>
										</th>
										<th class="hasinput">
											<input type="text" class="form-control datepicker-s" style="display:inline-block;width:89px!important;" readonly data-dateformat="yy-mm-dd" data-mask="9999-99-99" data-mask-placeholder="_" id="s_cntrct_de_start" name="s_cntrct_de_start" placeholder="[시작일자]">
											<span class="input-group-addon" style="display:inline-block;width:10px!important;padding:0;border:0;">~</span>
											<input type="text" class="form-control datepicker-e" style="display:inline-block;width:89px!important;" readonly data-dateformat="yy-mm-dd" data-mask="9999-99-99" data-mask-placeholder="_" id="s_cntrct_de_end" name="s_cntrct_de_end" placeholder="[종료일자]">
											<!-- <div class="input-group">
												<input type="text" class="form-control datepicker" data-dateformat="yy-mm-dd" data-mask="9999-99-99" data-mask-placeholder="_" id="s_cntrct_de_start" name="s_cntrct_de_start" placeholder="[전체]">
												<span class="input-group-addon"><i class="fa fa-calendar"></i></span>
												<span class="input-group-addon">~</span>
												<input type="text" class="form-control datepicker" data-dateformat="yy-mm-dd" data-mask="9999-99-99" data-mask-placeholder="_" id="s_cntrct_de_end" name="s_cntrct_de_end" placeholder="[전체]">
											</div> -->
										</th>
										<th class="hasinput">
											<select class="form-control select2 w100p" id="s_prjct_creat_at" name="s_prjct_creat_at">
												<option value="">[전체]</option>
												<option value="Y" selected>Y.생성</option>
												<option value="N">N.미생성</option>
											</select>
										</th>
										<th class="hasinput">
											<select class="form-control select2 w100p" id="s_progrs_sttus_code" name="s_progrs_sttus_code">
												<option value="">[전체]</option>
												{% for code in progrs_sttus_code_list %}
												<option value="{{code.value}}">{{code.value}}.{{code.label}}</option>
												{% endfor %}
												<option value="BP" selected>BP.사전입찰/진행</option>
												<option value="BPN">BPN.마감/목표제외</option>
											</select>
										</th>
										<th class="hasinput text-right">
											<div class="btn-group">
												<button type="button" class="btn btn-table btn-primary" title="검색" id="btnSearch"><i class="fa fa-search"></i></button>
											</div>
										</th>
									</tr>
									<!-- 헤더 -->
									<tr>
										<th>No.</th>
										<th>프로젝트번호</th>
										<th>거래처명</th>
										<th>계약명(현장명)</th>
										<th style="text-align:left!important;">총 수주금액 계</th>
                                        <th style="padding:9px 10px!important">보고서</th>
										<th>영업부서</th>
										<th>영업담당</th>
										<th>현장담당</th>
										<th>계약일자/수주일자</th>
										<th>프로젝트</th>
										<th>진행상태</th>
										<th class="text-right">
										</th>
									</tr>
								</thead>
							</table>
						</div>
						<!-- end widget content -->
					</div>
					<!-- end widget body div -->
				</div>
				<!-- end widget -->

			</article>
		</div>

	</section>

</div>
<!--########################################################################-->
<!--# contents area end                                                    #-->
<!--########################################################################-->


<!--########################################################################-->
<!--# commom script start                                                  #-->
<!--########################################################################-->
<!--########################################################################-->
<!--# common script end                                                    #-->
<!--########################################################################-->


<!--########################################################################-->
<!--# page script start                                                    #-->
<!--########################################################################-->
<script type="text/javascript">
/******************************************************************************
 * 계약 목록을 조회한다.
 */
getProjectList = function()
{
    $.datatable1 = $('#dtList1').DataTable({
		serverSide: true,
		pageLength: 15,
		buttons: ['excelHtml5'],
        ajax: {
            url: '/api/project/ajax_get_project_datatable',
            type: 'POST',
            data: function(params) {
				return $.extend({}, params, {
					's_cntrct_no': $('#dtList1').find('#s_cntrct_no').val(),
					's_bcnc_sn': $('#dtList1').find('#s_bcnc_sn').val(),
					's_cntrct_nm': $('#dtList1').find('#s_cntrct_nm').val(),
					's_spt_nm': $('#dtList1').find('#s_spt_nm').val(),
					's_prjct_ty_code': $('#dtList1').find('#s_prjct_ty_code').val(),
                    's_dept_code': $('#dtList1').find('#s_dept_code').val(),
					's_bsn_chrg_sn': $('#dtList1').find('#s_bsn_chrg_sn').val(),
					's_spt_chrg_sn': $('#dtList1').find('#s_spt_chrg_sn').val(),
					's_cntrct_de': $('#dtList1').find('#s_cntrct_de').val(),
					's_cntrct_de_start': $('#dtList1').find('#s_cntrct_de_start').val(),
					's_cntrct_de_end': $('#dtList1').find('#s_cntrct_de_end').val(),
					's_progrs_sttus_code': $('#dtList1').find('#s_progrs_sttus_code').val(),
					's_prjct_creat_at': $('#dtList1').find('#s_prjct_creat_at').val(),
				});
            },
            error: function(pJqXHR, pTextStatus, pErrorThrown) {
                toastrError(pJqXHR);
            }
        },
		order: [1, 'desc'],
		// columnDefs: [
        //     { targets: 4, visible: false }
        // ],
        columns: [
            { data: 'ctmmny_sn', className: 'text-center', orderable: false,
                render: function(data, type, row, meta) {
                    return meta.settings._iDisplayStart + meta.row + 1;
                }
            },
            { data: 'cntrct_no', className: 'text-center' },
            { data: 'bcnc_nm', className: 'text-center' },
            { data: 'spt_nm', className: 'text-left' },
            { data: 'cntrct_amount', className: 'text-number', //계약금액
                render: function(data, type, row, meta) {
                    return data.toString().toFormat('NUMBER');
                }
            },
            { data: 'prjct_ty_nm', className: 'hasinput text-center',
				render: function(pData, pType, pRow, pMeta) {
					var html = '';
					// html += '<button class="btn btn-table btn-info text-left w100p btnPrint" title="보고서" data-toggle="modal" href="#popReport'+row.prjct_ty_code+'" data-cntrct_sn="'+row.cntrct_sn+'" data-prjct_sn="'+row.prjct_sn+'">';
                    if(pRow.prjct_ty_code){
                        var dept_code = "";
                        if(pRow.dept_nm == "공조1팀"){
                            dept_code = "TS1";
                        }
                        else if(pRow.dept_nm == "공조2팀"){
                            dept_code = "TS2";
                        }
                        else if(pRow.dept_nm == "공조3팀"){
                            dept_code = "TS3";
                        }
                        else if(pRow.dept_nm == "빌트인팀"){
                            dept_code = "BI";
                        }
						if(pRow.prjct_ty_code=='RD')
							pRow.prjct_ty_code = 'NR'

						dept_code += ","+pRow.spt_dept_code;
                        html += '<button class="btn btn-table btn-info text-left w100p btnPrint" title="보고서" data-dept_code="'+dept_code+'" data-prjct_ty_code="'+pRow.prjct_ty_code+'" data-cntrct_sn="'+pRow.cntrct_sn+'" data-prjct_sn="'+pRow.prjct_sn+'">';
                        html += '	<i class="fa fa-print"></i>'+pData;
                        html += '</button>';

                    }
                    return html;
                }
			},
            { data: 'dept_nm', className: 'text-center' },
            { data: 'bsn_chrg_nm', className: 'text-center' },
            { data: 'spt_chrg_nm', className: 'text-center' },
            { data: 'cntrct_de', className: 'text-center' },
            { data: 'prjct_creat_at', className: 'text-center',
				render: function(data, type, row, meta) {
					var result = '';
					if (data == 'Y') { result = '생성'; }
					else if (data == 'N') { result = '미생성'; }
					else { result = data; }
					return result;
				}
			},
            { data: 'progrs_sttus_nm' , className: 'text-center'},
            { data: 'ctmmny_sn', className: 'hasinput text-right', orderable: false,
			    render: function(data, type, row, meta) {
					var html = '';
                        var dept_code = "";
                        if(row.dept_nm == "공조1팀"){
                            dept_code = "TS1";
                        }
                        else if(row.dept_nm == "공조2팀"){
                            dept_code = "TS2";
                        }
                        else if(row.dept_nm == "공조3팀"){
                            dept_code = "TS3";
                        }
                        else if(row.dept_nm == "빌트인팀"){
                            dept_code = "BI";
                        }


//                    if(row.progrs_sttus_code !== 'C'){
					{% if session['member']['auth_cd'] == 1 %}
					html += '<div class="btn-group">';
					html += '	<button class="btn btn-table btn-info btnUpdate" title="수정" data-dept_code="'+dept_code+'" data-cntrct_sn="'+row.cntrct_sn+'" data-prjct_sn="'+row.prjct_sn+'" data-prjct_ty_code="'+row.prjct_ty_code+'">';
					html += '		<i class="fa fa-edit"></i>';
					html += '	</button>';
					html += '</div>';
					{% elif session['member']['member_id'] == 'ma_keunmi' %}
						if(row.progrs_sttus_code != 'C'){
							html += '<div class="btn-group">';
							html += '	<button class="btn btn-table btn-info btnEnd" title="마감" data-dept_code="'+dept_code+'" data-cntrct_sn="'+row.cntrct_sn+'" data-prjct_sn="'+row.prjct_sn+'" data-prjct_ty_code="'+row.prjct_ty_code+'">';
							html += '		<i class="fa fa-edit"></i>';
							html += '	</button>';
							html += '</div>';
						}
					{% else %}
					if(row.prjct_creat_at == 'N'){
						html += '<div class="btn-group">';
						html += '	<button class="btn btn-table btn-info btnUpdate" title="수정" data-dept_code="'+dept_code+'" data-cntrct_sn="'+row.cntrct_sn+'" data-prjct_sn="'+row.prjct_sn+'" data-prjct_ty_code="'+row.prjct_ty_code+'">';
						html += '		<i class="fa fa-edit"></i>';
						html += '	</button>';
						html += '</div>';

					}
					{% endif %}

//                    }

					return html;
				}
			},
		],
		drawCallback: function(pSettings) { console.log('drawCallback', pSettings.json);
			var contract = pSettings.json.contract;
			var count = pSettings.json.count;
            $('#summery').find('tbody td').eq(0).html(count.total_count.toString().toFormat('NUMBER'));
			$('#summery').find('tbody td').eq(1).html(contract.total_amount.toString().toFormat('NUMBER'));
            // $('#summery').find('tbody td').eq(1).html(contract.amount.toString().toFormat('NUMBER'));
        },
		initComplete: function(pSettings, pJson) { //console.log('initComplete', pJson);
			var myList = this;
            var myDeptCode = pJson.member.dept_code;
            var show = true;
            if(myDeptCode == "TS1" || myDeptCode == "TS2" || myDeptCode == "TS3" || myDeptCode == "BI"){
                show = false;
            }

			$(myList).on('click', 'tbody tr', function(pEvent) {
				if ($(this).parent().find('td.dataTables_empty').length > 0) {
					return;
				} else {
					$(this).parent().find('tr.selected').removeClass('selected');
					$(this).addClass('selected');
				}
			});

			$(myList).on('click', '#btnSearch', function(pEvent) {
				$.datatable1.ajax.reload();
			});

			$(myList).on('click', '.btnUpdate', function(pEvent) {
				var dept_code = $(this).data('dept_code');
				var cntrct_sn = $(this).data('cntrct_sn');
				var prjct_sn = $(this).data('prjct_sn');
                if(prjct_sn){
                    $('#popBox1').data('action', 'show');
                    $('#popBox1').data('actioncontract', 'show');
                }
				else{
                    $('#popBox1').data('action', 'show');
                    $('#popBox1').data('actioncontract', 'show');
                }
                if(show || dept_code.split(",").includes(myDeptCode)){
                    getProject(cntrct_sn, prjct_sn);
                }
                else{
                    alert("해당 부서만 수정 가능합니다.");
                }

			});
			$(myList).on('click', '.btnEnd', function(pEvent) {
				var dept_code = $(this).data('dept_code');
				var cntrct_sn = $(this).data('cntrct_sn');
				var prjct_sn = $(this).data('prjct_sn');
				if(confirm("프로젝트 마감 후에는 수정할 수 없습니다. 마감하시겠습니까?")){
					$.ajax({
						url : '/api/project/ajax_end_project',
						method : 'GET',
						data : {"cntrct_sn" : cntrct_sn},
						success: function(pResult){
							alert("처리가 완료되었습니다.");
							$.datatable1.ajax.reload();

						},
						error: function(pResult){
							alert("마감처리에 실패하였습니다. 다시 시도해주세요.");
						}
					})

				}

			});

            $(myList).on('click', '.btnPrint', function(pEvent) {
				var dept_code = $(this).data('dept_code');
				var prjct_ty_code = $(this).data('prjct_ty_code');
				var cntrct_sn = $(this).data('cntrct_sn');
				var prjct_sn = $(this).data('prjct_sn');
                if(show || dept_code.split(",").includes(myDeptCode)){
                    if (prjct_ty_code == 'NR') { //일반공무
                        getReportNR(cntrct_sn, prjct_sn);
                    } else if (prjct_ty_code == 'BD') { //빌트인직계약
                        getReportBD(cntrct_sn, prjct_sn);
                    } else if (prjct_ty_code == 'BF') { //빌트인수수료
                        getReportBF(cntrct_sn, prjct_sn);
                    }
                }
                else{
                    alert("해당 부서만 열람 가능합니다.");
                }
			});
			$(myList).on('change', 'thead input.form-control', function(pEvent){
				if ($(this).data('before')) {
					if ($(this).data('before') != $(this).val()) {
						$.datatable1.ajax.reload();
					}
				} else {
					$.datatable1.ajax.reload();
				}
			});

			$(myList).on('change', 'thead select', function(pEvent){
				$.datatable1.ajax.reload();
			});

			$('#btnExcel').on('click', function(pEvent) {
				$.datatable1.context[0]._iDisplayLength=0;
				$.datatable1.ajax.reload(function(){
					$('.dt-button.buttons-excel.buttons-html5').trigger('click');
				});
			});
		},
    });
}
</script>
<script type="text/javascript">
$(function(){

	/**************************************************************************
	* 계약일자 캘린더 셋팅
	*/
	var maxYears = 5;
	$('.datepicker-e').datepicker({
		beforeShow: function(dateText) {
			$(this).data('before', $(this).val());
		},
		onSelect: function(dateText) {
			$(this).change();
		},
		onClose: function(dateText) {
			var minDate = new Date($(this).val());
			minDate.setDate(minDate.getDate() - (365*maxYears));
			$(".datepicker-s").datepicker( "option", "minDate", minDate );
		},
	});

	var end = $('.datepicker-e').val();
	if (end == '') {
		$('.datepicker-e').datepicker('setDate', 'today');
	}

	$('.datepicker-s').datepicker({
		beforeShow: function(dateText) {
			$(this).data('before', $(this).val());

			var minDate = new Date($('.datepicker-e').val());
			minDate.setDate(minDate.getDate() - (365*maxYears));
			$(".datepicker-s").datepicker( "option", "minDate", minDate );
		},
		onSelect: function(dateText) {
			$(this).change();
		},
		onClose: function(dateText) {
		},
	});

	var start = $('.datepicker-s').val();
	if (start == '') {
		var end = $('.datepicker-e').val();
		var endDate = new Date(end);
		endDate.setDate(endDate.getDate() - (365*maxYears));

//		endDate.setDate(endDate.getDate() - (365*maxYears));
		$('.datepicker-s').datepicker('setDate', endDate);
	}


	/******************************************************************************
	*
	*/
	// var selected_count = 0;
	// $('.select2-multiple').select2({
    // 	// templateSelection: function(selected, total) {
	// 	templateResult: function(state) {
	// 		return '';
	// 	},
    // 	// templateSelection: function(state) {
	// 	// 	var selected = $('#s_progrs_sttus_code option:selected').length;
	// 	// 	console.log($(this).parent());
    //   	// 	return selected+'개 선택';
    // 	// }
  	// });
	/**************************************************************************
     *
     */
	getProjectList();
});

$(document).keyup(function(e) {
    if (e.keyCode == 27) { // escape key maps to keycode `27`
        $("button[data-dismiss=modal]").trigger('click');
    }
});
</script>
<!--########################################################################-->
<!--# page script end                                                      #-->
<!--########################################################################-->


<script type="text/javascript">
/******************************************************************************
 *
 */
biss2text = function(val)
{
    if(val == '0')
        return 'X';
    else if(val == '1')
        return 'O';
    else
        return '해당사항없음';
}

getReportNR = function(s_cntrct_sn, s_prjct_sn)
{
	var params = '';
	params += '&s_cntrct_sn=' + s_cntrct_sn;
	params += '&s_prjct_sn=' + s_prjct_sn;
	window.open("/project/report/NR?"+params, "_blank");

}
getReportBD = function(s_cntrct_sn, s_prjct_sn)
{
	var params = '';
	params += '&s_cntrct_sn=' + s_cntrct_sn;
	params += '&s_prjct_sn=' + s_prjct_sn;
	window.open("/project/report/BD?"+params, "_blank");

}
getReportBF = function(s_cntrct_sn, s_prjct_sn)
{
	var params = '';
	params += '&s_cntrct_sn=' + s_cntrct_sn;
	params += '&s_prjct_sn=' + s_prjct_sn;
	window.open("/project/report/BF?"+params, "_blank");

}
</script>

<div class="modal fade" data-backdrop="static" id="popBox1">
    <style type="text/css">
#popBox1 tbody .btnUpdate, #popBox1 tbody .btnPrint{
    line-height: 1.42857143 !important;
    padding: 5px 7px!important;
    margin:  0px !important;
}
#popBox1 tbody{
    font-size:12px!important;
}

    </style>
    <div class="modal-dialog modal-w1200" style="width:1720px!important">
        <div class="modal-content">
			<div class="jarviswidget jarviswidget-color-greenDark">
				<header>
					<ul class="nav nav-tabs" id="popEditTabs">
						<li class="active" data-action="1">
							<a data-toggle="tab" href="#tabBox1" data-action="tab1"><i class="fa fa-lg fa-edit"></i>&nbsp;<span>계약 & 프로젝트</span></a>
						</li>
						<li data-action="2">
							<a data-toggle="tab" href="#tabBox2" data-action="tab2"><i class="fa fa-lg fa-list"></i>&nbsp;<span>도급사</span></a>
						</li>
						<li data-action="3">
							<a data-toggle="tab" href="#tabBox3" data-action="tab3"><i class="fa fa-lg fa-list"></i>&nbsp;<span>예정 공사비</span></a>
						</li>
						<li data-action="4">
							<a data-toggle="tab" href="#tabBox4" data-action="tab4"><i class="fa fa-lg fa-list"></i>&nbsp;<span>공사비 산출</span></a>
						</li>
					</ul>
					<div class="jarviswidget-ctrls" role="menu">
						<a class="button-icon jarviswidget-delete-btn" aria-hidden="true" data-dismiss="modal"><i class="fa fa-times"></i></a>
					</div>

				</header>
				<div role="content" style="min-height:620px;">
					<!-- widget edit box -->
					<div class="jarviswidget-editbox no-padding" style="display:block;">
<!--
						<div class="alert alert-block alert-info" style="margin:0px;">
							<p style="margin-bottom:7px;">
								<i class="fa-fw fa fa-info"></i>
								프로젝트(도급사, 예정공사비) 정보 등록을 위한 계약을 선택하세요.
							</p>
							<select class="form-control select2" style="width:100%;" id="s_cntrct_sn" name="s_cntrct_sn">
								<option value="">[계약을 선택하세요]</option>
								{contract_list}
								<option value="{value}" data-project_yn="{prjct_creat_at}" data-project_cnt="{prjct_cnt}">{etc1}.{bcnc_nm} {label}</option>
								{/contract_list}
							</select>
						</div>
-->
                        <div class="tab-pane fade active in" id="tabBoxContract1">
                        <form id="frmBoxContract1">
                            <input type="hidden" id="s_cntrct_sn" name="s_cntrct_sn">
                            <input type="hidden" id="author" value="0">
						<table class="table table-bordered table-form">
							<colgroup>
								<col width="175">
								<col width="150">
								<col width="175">
								<col width="150">
								<col width="175">
								<col width="150">
								<col width="175">
								<col width="150">
							</colgroup>
							<tbody>
								<tr><th class="" style="background:#0070C0;border-color:#0070C0;color:white;border-right:none;" colspan="1">계약</th>
                                    <th class="" style="background:#0070C0;border-color:#0070C0;color:white;border-left:none;padding:0;" colspan="7">
                                    <span class="widget-toolbar" id="popEditToolbarContract">
					{% if session['member']['auth_cd'] == 1 %}

                                        <button type="button" class="btn btn-primary" id="btnSaveKeepContract" title="저장 후 입력값을 유지합니다."><i class="fa fa-save"> 저장</i></button>
                                        <button type="button" class="btn btn-primary" id="btnEdit" title="값을 수정합니다."><i class="fa fa-edit"> 수정</i></button>
                                        <button type="button" class="btn btn-danger" id="btnDelete"><i class="fa fa-trash-o"> 삭제</i></button>
					{% endif %}

                                    </span>
                                    </th>
                                </tr>

                                <tr class="required"><th class="color-contract">프로젝트 번호</th>
                                    <td class="hasinput" colspan="3">
                                        <input type="text" class="form-control" placeholder="" id="cntrct_no" name="cntrct_no">
                                    </td>

                                    <th class="color-contract">계약일</th>
                                    <td class="hasinput" colspan="3">
                                        <div class="input-group">
                                            <input type="text" class="form-control datepicker" style="z-index:1050!important;" data-dateformat="yy-mm-dd" data-mask="9999-99-99" data-mask-placeholder="_" id="cntrct_de" name="cntrct_de">
                                            <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                        </div>
                                    </td>

                                </tr>
                                <tr class="required"><th class="color-contract">거래처명</th>
                                    <td class="hasinput" colspan="3">
                                        <select class="form-control select2" id="bcnc_sn" name="bcnc_sn">
                                            <option value=""></option>
                                            {% for code in bcnc_list %}
                                            <option value="{{code.value}}">{{code.value}}.{{code.label}}</option>
                                            {% endfor %}
                                        </select>
                                    </td>
                                    <th class="color-contract">공사기간</th>
                                    <td class="hasinput" colspan="3">
                                        <div class="input-group">
                                            <input class="form-control datepicker" type="text" style="z-index:1050!important;" data-dateformat="yy-mm-dd" data-mask="9999-99-99" data-mask-placeholder="_" id="cntrwk_bgnde" name="cntrwk_bgnde">
                                            <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                            <input class="form-control datepicker" type="text" style="z-index:1050!important;" data-dateformat="yy-mm-dd" data-mask="9999-99-99" data-mask-placeholder="_" id="cntrwk_endde" name="cntrwk_endde">
                                            <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                        </div>
                                    </td>
                                </tr>
                                <tr class="required"><th class="color-contract">현장명</th>
                                    <td class="hasinput" colspan="3">
                                        <input type="text" class="form-control" id="cntrct_nm" name="cntrct_nm">
                                    </td>
                                    <th class="color-contract">현장주소</th>
                                    <td class="hasinput" colspan="3">
                                        <input type="text" class="form-control" id="spt_adres" name="spt_adres">
                                    </td>
                                </tr>
                                <tr class="required">
									<th class="color-contract">세대수</th>
									<td class="hasinput" colspan="1">
										<input type="number" class="form-control" id="home_count" name="home_count">
									</td>
									<th class="color-contract">지역</th>
									<td class="hasinput" colspan="1">
										<select class="form-control select2" id="home_region" name="home_region" style="width:100%;">
											<option value=""></option>
											<option value="서울권">서울권</option>
											<option value="수도권">수도권</option>
											<option value="지방권">지방권</option>
										</select>
									</td>
                                    <th class="color-contract">넥셀 현장담당</th>
                                    <td class="hasinput" colspan="3">
                                        <select class="form-control select2" id="spt_chrg_sn" name="spt_chrg_sn">
                                            <option value=""></option>
                                            {% for code in member_list %}
                                            <option value="{{code.value}}">{{code.label}} {{code.etc1}}</option>
                                            {% endfor %}
                                        </select>
                                    </td>
                                </tr>
                                <tr class="required">
									<th class="color-contract">프로젝트 유형</th>
                                    <td class="hasinput" colspan="3">
                                        <div class="btn-group btn-group-justified" data-toggle="buttons">
											{% for code in prjct_ty_code_list %}
                                            <label class="btn btn-default">
                                                <input type="radio" name="prjct_ty_code" value="{{code.value}}">{{code.label}}
                                            </label>
											{% endfor %}
                                        </div>
                                    </td>
									<th class="color-contract">넥셀 영업담당</th>
                                    <td class="hasinput" colspan="3">
                                        <select class="form-control select2" id="bsn_chrg_sn" name="bsn_chrg_sn">
                                            <option value=""></option>
                                            {% for code in member_list %}
                                            <option value="{{code.value}}">{{code.label}} {{code.etc1}}</option>
                                            {% endfor %}
                                        </select>
                                    </td>
                                </tr>

                                <tr class="required">
									<th class="color-contract">프로젝트 생성여부</th>
                                    <td class="hasinput" colspan="3">
                                        <div class="btn-group btn-group-justified" data-toggle="buttons">
                                            <label class="btn btn-default">
                                                <input type="radio" name="prjct_creat_at" value="Y">생성
                                            </label>
                                            <label class="btn btn-default">
                                                <input type="radio" name="prjct_creat_at" value="N">단납건
                                            </label>
                                        </div>
                                    </td>
									<th class="color-contract">진행상태</th>
                                    <td class="hasinput" colspan="3">
                                        <div class="btn-group btn-group-justified" data-toggle="buttons">
                                            {% for code in progrs_sttus_code_list %}
                                            <label class="btn btn-default">
                                                <input type="radio" name="progrs_sttus_code" value="{{code.value}}">{{code.label}}
                                            </label>
                                            {% endfor %}
                                        </div>
                                    </td>
                                </tr>


							</tbody>
						</table>
                        </form>
                        </div>
					</div>
					<!-- end widget edit box -->
					<div class="widget-body no-padding">
						<div class="tab-content">

							<!-- 프로젝트 -->
							<div class="tab-pane fade active in" id="tabBox1">
							<form id="frmBox1">
								<input type="hidden" name="s_prjct_sn" id="s_prjct_sn"/>
								<table class="table table-bordered table-form">
									<colgroup>
										<col width="175">
										<col width="150">
										<col width="175">
										<col width="150">
										<col width="175">
										<col width="150">
										<col width="175">
										<col width="150">
									</colgroup>
									<tbody>

                                        <tr><th rowspan="2">본사담당</th>
											<th>담당자명</th>
											<th colspan="2">휴대폰</th>
											<th rowspan="2">거래처담당</th>
											<th>담당자명</th>
											<th colspan="2">휴대폰</th>
										</tr>
										<tr>
											<td class="hasinput" colspan="1">
												<input type="text" class="form-control" id="charger_nm1" name="charger_nm1">
												<input type="hidden" id="charger_sn1" name="charger_sn1">
											</td>
											<td class="hasinput" colspan="2">
												<input type="text" class="form-control" id="charger_moblphon1" name="charger_moblphon1">
											</td>
											<td class="hasinput" colspan="1">
												<input type="text" class="form-control" id="charger_nm2" name="charger_nm2">
												<input type="hidden" id="charger_sn2" name="charger_sn2">
											</td>
											<td class="hasinput" colspan="2">
												<input type="text" class="form-control" id="charger_moblphon2" name="charger_moblphon2">
											</td>
										</tr>


										<tr>
											<th>장비/공사내역</th>
											<td class="hasinput" colspan="3">
                                                <input type="hidden" class="form-control" id="eqpmn_dtls" name="eqpmn_dtls">
												<input type="text" class="form-control" id="cntrwk_dtls" name="cntrwk_dtls">
											</td>

											<th>계약DC(%)</th>
											<td class="hasinput" colspan="1">
												<input type="number" class="form-control" id="cntrct_dscnt_rt" name="cntrct_dscnt_rt">
											</td>
											<th>품의DC(%)</th>
											<td class="hasinput" colspan="1">
												<input type="number" class="form-control" id="cnsul_dscnt_rt" name="cnsul_dscnt_rt">
											</td>
										</tr>
                                        <tr name="charger2">
											<th>도면작업자</th>
											<td class="hasinput" colspan="3">
												<select class="form-control select2 w100p" id="drw_opertor_sn" name="drw_opertor_sn">
													<option value=""></option>
													{% for code in member_list %}
													<option value="{{code.value}}">{{code.label}} {{code.etc1}}</option>
													{% endfor %}
												</select>
											</td>
											<th>실적신고</th>
											<td class="hasinput" colspan="1">
												<input type="text" class="form-control" id="acmslt_sttemnt_at" name="acmslt_sttemnt_at">
											</td>
											<th>건설공사대장</th>
											<td class="hasinput" colspan="1">
												<input type="text" class="form-control" id="cntwrk_regstr_ennc" name="cntwrk_regstr_ennc">
											</td>
										</tr>
										<tr>
											<th>설치팀장</th>
											<td class="hasinput" colspan="1">
												<input type="text" class="form-control" id="charger_nm6" name="charger_nm6">
												<input type="hidden" id="charger_sn6" name="charger_sn6">
											</td>
											<td class="hasinput" colspan="2">
												<input type="text" class="form-control" id="charger_moblphon6" name="charger_moblphon6">
											</td>
											<th colspan="4"></th>

										</tr>
										<tr>
											<th>결제방법(1)</th>
											<td class="hasinput" colspan="7">
												<input type="text" class="form-control" id="setle_mth" name="setle_mth">
											</td>
										</tr>
										<tr>
											<th>결제방법(2)</th>
											<th colspan="2">금액</th>
											<th colspan="1">일자</th>
											<th colspan="4">비고(특이사항)</th>
										</tr>
										<tr>
											<th>계약금</th>
											<td class="hasinput" colspan="2">
												<input type="number" class="form-control" id="enty" name="enty">
											</td>
											<td class="hasinput" colspan="1">
												<div class="input-group">
													<input class="form-control datepicker" type="text" style="z-index:1050!important;" data-dateformat="yy-mm-dd" data-mask="9999-99-99" data-mask-placeholder="_" id="enty_de" name="enty_de">
													<span class="input-group-addon"><i class="fa fa-calendar"></i></span>
												</div>
											</td>
											<td class="hasinput" colspan="4">
												<input type="text" class="form-control" id="enty_rm" name="enty_rm">
											</td>
										</tr>
										<tr>
											<th>중도금</th>
											<td class="hasinput" colspan="2">
												<input type="number" class="form-control" id="prtpay" name="prtpay">
											</td>
											<td class="hasinput" colspan="1">
												<div class="input-group">
													<input class="form-control datepicker" type="text" style="z-index:1050!important;" data-dateformat="yy-mm-dd" data-mask="9999-99-99" data-mask-placeholder="_" id="prtpay_de" name="prtpay_de">
													<span class="input-group-addon"><i class="fa fa-calendar"></i></span>
												</div>
											</td>
											<td class="hasinput" colspan="4">
												<input type="text" class="form-control" id="prtpay_rm" name="prtpay_rm">
											</td>
										</tr>
										<tr>
											<th>잔금</th>
											<td class="hasinput" colspan="2">
												<input type="number" class="form-control" id="surlus" name="surlus">
											</td>
											<td class="hasinput" colspan="1">
												<div class="input-group">
													<input class="form-control datepicker" type="text" style="z-index:1050!important;" data-dateformat="yy-mm-dd" data-mask="9999-99-99" data-mask-placeholder="_" id="surlus_de" name="surlus_de">
													<span class="input-group-addon"><i class="fa fa-calendar"></i></span>
												</div>
											</td>
											<td class="hasinput" colspan="4">
												<input type="text" class="form-control" id="surlus_rm" name="surlus_rm">
											</td>
										</tr>
										<tr><th class="" style="background:#0070C0;border-color:#0070C0;color:white;" colspan="8">특이사항</th></tr>
										<tr>
											<td class="hasinput" colspan="8">
												<textarea class="form-control" style="height:73px;resize:none;" id="partclr_matter" name="partclr_matter"></textarea>
											</td>
										</tr>

									</tbody>
								</table>
							</form>
							</div><!--tab-pane-->
							<!-- 도급사 -->
							<div class="tab-pane fade" id="tabBox2">
							<form id="frmBox2">
								<table class="table table-bordered table-hover" id="dtList2">
									<colgroup>
										<col width="50">
										<col width="150">
										<col width="126">
										<col width="500">
										<col width="*">
										<col width="100">
										<col width="110">
										<col width="100">
										<col width="110">
										<col width="78">
									</colgroup>
									<thead>
										<tr><th class="" style="background:#0070C0;border-color:#0070C0;color:white;" colspan="10">
												도급사
												<input type="hidden" id="cntrct_sn" name="cntrct_sn">
												<input type="hidden" id="prjct_sn" name="prjct_sn">
												<input type="hidden" id="s_outsrc_sn" name="s_outsrc_sn">
											</th>
										</tr>
										<!-- <tr><th class="hasinput" colspan="13">
												<div class="alert alert-block alert-warning-x" style="margin:0px;">
													<p><i class="fa-fw fa fa-info"></i>
														기성현황 기준으로 해당하는 항목만 작성하시기 바랍니다.
													</p>
												</div>
											</th>
										</tr> -->
										<tr>
											<td class="hasinput" style="text-align:center;font-weight:bold;color:#00f;" id="action">
												입력
											</td>
											<td class="hasinput">
												<select class="form-control select2 w100p" id="outsrc_fo_sn" name="outsrc_fo_sn">
													<option value="">[필수]</option>
													{% for code in bcnc_list %}
													<option value="{{code.value}}">{{code.value}}.{{code.label}}</option>
													{% endfor %}
												</select>
											</td>
											<td class="hasinput">
												<div class="input-group">
													<input type="text" class="form-control datepicker" style="z-index:1050!important;" placeholder="[선택]" data-dateformat="yy-mm-dd" data-mask="9999-99-99" data-mask-placeholder="_" id="out_cntrct_de" name="out_cntrct_de">
													<span class="input-group-addon"><i class="fa fa-calendar"></i></span>
												</div>
											</td>
											<td class="hasinput">
												<input type="text" class="form-control" placeHolder="[선택]" id="pymnt_mth" name="pymnt_mth">
											</td>
											<td class="hasinput">
												<input type="text" class="form-control" placeHolder="[선택]" id="outsrc_dtls" name="outsrc_dtls">
											</td>
											<td class="hasinput">
												<input type="text" class="form-control" placeHolder="[선택]" id="rspnber_nm" name="rspnber_nm">
											</td>
											<td class="hasinput">
												<input type="text" class="form-control" placeHolder="[선택]" id="rspnber_telno" name="rspnber_telno">
											</td>
											<td class="hasinput">
												<input type="text" class="form-control" placeHolder="[선택]" id="charger_nm" name="charger_nm">
											</td>
											<td class="hasinput">
												<input type="text" class="form-control" placeHolder="[선택]" id="charger_telno" name="charger_telno">
											</td>
											<td class="hasinput">
					{% if session['member']['auth_cd'] == 1 %}

												<div class="btn-group">
													<button type="button" class="btn btn-primary" id="btnSaveOutsrc"><i class="fa fa-save"></i></button>
													<button type="button" class="btn btn-primary" id="btnRefrushOutsrc" style="padding-left:11px;padding-right:11px;" id="btnRefreshOutsrc"><i class="fa fa-refresh"></i></button>
												</div>
					{% endif %}
											</td>
										</tr>
										<tr>
											<th class="text-center">No.</th>
											<th>도급사</th>
											<th>계약일</th>
											<th>도급업체선정근거</th>
											<th>이행증권내역</th>
											<th>업무책임자</th>
											<th>연락처</th>
											<th>담당자</th>
											<th>연락처</th>
											<th>-</th>
										</tr>
									</thead>
									<tbody>
									</tbody>
								</table>
							</form>
							</div><!--tab-pane-->

							<!-- 예정공사비 -->
							<div class="tab-pane fade" id="tabBox3">
							<form id="frmBox3">
								<table class="table table-bordered table-hover" id="dtList3">
									<colgroup>
										<col width="50">
										<col width="94">
										<col width="120">
										<col width="120">
										<col width="84">
										<col width="60">
										<col width="*">
										<col width="48">
										<col width="107">
										<col width="107">
										<col width="107">
										<col width="107">
										<col width="60">
                                        <col width="90">
										<col width="70">
										<col width="70">
										<col width="84">
										<col width="84">
										<col width="60">
										<col width="84">
										<col width="78">
									</colgroup>
									<thead>
										<tr><th class="" style="background:#0070C0;border-color:#0070C0;color:white;" colspan="21">
												예정 공사비
												<input type="hidden" id="cntrct_sn" name="cntrct_sn">
												<input type="hidden" id="prjct_sn" name="prjct_sn">
												<input type="hidden" id="s_cntrwk_ct_sn" name="s_cntrwk_ct_sn">
											</th>
										</tr>
										<tr><th class="hasinput" colspan="21">
												<div class="alert alert-block alert-warning-x" style="margin:0px;color:red!important;">
													<p><i class="fa-fw fa fa-info"></i>
														기성현황 기준으로 해당하는 항목만 작성하시기 바랍니다.
													</p>
													<p><i class="fa-fw fa fa-info"></i>
														매입/매출 금액은 VAT가 포함된 금액을 입력하셔야 합니다.
													</p>
													<p><i class="fa-fw fa fa-info"></i>
														장비비외의 비용(인건비등)에도 수량은 최소 1건이상으로 입력하셔야 합니다.
													</p>
												</div>
											</th>
										</tr>
										<tr style="background:#ffedaa;">
											<td class="hasinput" style="text-align:center;font-weight:bold;color:#00f;" id="action">
												입력
											</td>
											<td class="hasinput">
												<select class="form-control select2" id="cntrct_execut_code" name="cntrct_execut_code">
													<option value="">[필수]</option>
													{% for code in cntrct_execut_code_list %}
													<option value="{{code.value}}">{{code.label}}</option>
													{% endfor %}
												</select>
											</td>
											<td class="hasinput">
												<select class="form-control select2" id="ct_se_code" name="ct_se_code">
													<option value="">[필수]</option>
													{% for code in ct_se_code_list %}
													<option value="{{code.value}}">{{code.label}}</option>
													{% endfor %}
												</select>
											</td>
											<td class="hasinput">
												<select class="form-control select2 w100p" id="purchsofc_sn" name="purchsofc_sn">
													<option value="">[필수]</option>
													{% for code in bcnc_list %}
													<option value="{{code.value}}">{{code.label}}</option>
													{% endfor %}
												</select>
											</td>
											<td class="hasinput">
												<select class="form-control select2" id="prdlst_se_code" name="prdlst_se_code">
													<option value="">[선택]</option>
													{% for code in prdlst_se_code_list %}
													<option value="{{code.value}}">{{code.label}}</option>
													{% endfor %}
												</select>
											</td>
											<td class="hasinput">
												<select class="form-control select2" id="cost_type" name="cost_type">
													<option value="4">[선택]</option>
													<option value="0">주택</option>
													<option value="1">빌딩</option>
													<option value="2">기타</option>
													<option value="3">일용직</option>
												</select>
											</td>
											<td class="hasinput">
												<input type="text" class="form-control" placeholder="[선택]" id="model_no" name="model_no">
											</td>
											<td class="hasinput">
												<input type="number" class="form-control" placeholder="[필수]" id="qy" name="qy">
											</td>
											<td class="hasinput">
												<input type="number" class="form-control" placeholder="[선택]" id="puchas_amount" name="puchas_amount">
											</td>
											<td class="hasinput">
												<input type="number" class="form-control" placeholder="[선택]" id="puchas_amount_tot" name="puchas_amount_tot">
											</td>
											<td class="hasinput">
												<input type="number" class="form-control" placeholder="[선택]" id="salamt" name="salamt">
											</td>
											<td class="hasinput">
												<input type="number" class="form-control" placeholder="[선택]" id="salamt_tot" name="salamt_tot">
											</td>
											<td class="hasinput">
												<input type="number" class="form-control" placeholder="[선택]" id="dscnt_rt" name="dscnt_rt">
											</td>
                                            <td class="hasinput">
												<div class="input-group">
													<input type="text" class="form-control datepicker" style="z-index:1050!important;" placeholder="[필수]" data-dateformat="yy-mm-dd" data-mask="9999-99-99" data-mask-placeholder="_" id="cost_date" name="cost_date">
													<!-- <span class="input-group-addon"><i class="fa fa-calendar"></i></span> -->
												</div>
											</td>
											<td class="hasinput">
												<input type="number" class="form-control" placeholder="[선택]" id="add_dscnt_rt" name="add_dscnt_rt">
											</td>
											<td class="hasinput">
												<input type="number" class="form-control" placeholder="[선택]" id="fee_rt" name="fee_rt">
											</td>
											<td class="hasinput">
												<select class="form-control select2" id="dspy_se_code" name="dspy_se_code">
													<option value="">[선택]</option>
													{% for code in dspy_se_code_list %}
													<option value="{{code.value}}">{{code.label}}</option>
													{% endfor %}
												</select>
											</td>
											<td class="hasinput">
												<div class="input-group">
													<input type="text" class="form-control datepicker" style="z-index:1050!important;" placeholder="[선택]" data-dateformat="yy-mm-dd" data-mask="9999-99-99" data-mask-placeholder="_" id="dspy_de" name="dspy_de">
													<!-- <span class="input-group-addon"><i class="fa fa-calendar"></i></span> -->
												</div>
											</td>
											<td class="hasinput">
												<input type="number" class="form-control" placeholder="[선택]" id="extra_sn" name="extra_sn">
											</td>
											<td class="hasinput">
												<div class="input-group">
													<input type="text" class="form-control datepicker" style="z-index:1050!important;" placeholder="[선택]" data-dateformat="yy-mm-dd" data-mask="9999-99-99" data-mask-placeholder="_" id="reg_de" name="reg_de">
													<!-- <span class="input-group-addon"><i class="fa fa-calendar"></i></span> -->
												</div>
											</td>
											<td class="hasinput">
					{% if session['member']['auth_cd'] == 1 %}
												<div class="btn-group">
													<button type="button" class="btn btn-primary" id="btnSaveCost"><i class="fa fa-save"></i></button>
													<button type="button" class="btn btn-primary" id="btnRefrushCost" style="padding-left:11px;padding-right:11px;"><i class="fa fa-refresh"></i></button>
												</div>
					{% endif %}
											</td>
										</tr>
										<tr>
											<th style="vertical-align:middle;" class="text-center" rowspan="2">No.</th>
											<th style="vertical-align:middle;" rowspan="2">계약집행구분</th>
											<th style="vertical-align:middle;" rowspan="2">비용구분</th>
											<th style="vertical-align:middle;" rowspan="2">거래처</th>
											<th style="vertical-align:middle;" rowspan="2">품목</th>
											<th style="vertical-align:middle;" rowspan="2">설치분류</th>
											<th style="vertical-align:middle;" rowspan="2">모델번호</th>
											<th style="vertical-align:middle;" rowspan="2">수량</th>
											<th colspan="2">매입(출고)</th>
											<th colspan="2">매출(계약)</th>
											<th style="vertical-align:middle;" rowspan="2">DC(%)</th>
                                            <th style="vertical-align:middle;" rowspan="2">계약일자</th>
											<th style="vertical-align:middle;" rowspan="2">추가<br>DC(%)</th>
											<th style="vertical-align:middle;" rowspan="2">수수료<br>(%)</th>
											<th style="vertical-align:middle;" rowspan="2">전시구분</th>
											<th style="vertical-align:middle;" rowspan="2">전시일</th>
											<th style="vertical-align:middle;" rowspan="2">추가</th>
											<th style="vertical-align:middle;" rowspan="2">등록일</th>
											<th style="vertical-align:middle;" rowspan="2">-</th>
										</tr>
										<tr>
											<th>단가</th>
											<th>금액</th>
											<th>단가</th>
											<th>금액</th>
										</tr>
									</thead>
									<tbody>
									</tbody>
								</table>
							</form>
							</div><!--tab-pane-->

							<!-- 공사비산출(사전입찰) -->
							<div class="tab-pane fade" id="tabBox4">
							<form id="frmBox4">
								<table class="table table-bordered table-hover" id="dtList4">
									<colgroup>
										<col width="50">
										<col width="*">
										<col width="120">
										<col width="120">
										<col width="78">
									</colgroup>
									<thead>
										<tr><th class="" style="background:#0070C0;border-color:#0070C0;color:white;" colspan="5">
												공사비 산출
												<input type="hidden" id="cntrct_sn" name="cntrct_sn">
												<input type="hidden" id="prjct_sn" name="prjct_sn">
												<input type="hidden" id="s_construct_sn" name="s_construct_sn">
											</th>
										</tr>
										<tr><th class="hasinput" colspan="5">
												<div class="alert alert-block alert-warning-x" style="margin:0px;color:red!important;">
													<p><i class="fa-fw fa fa-info"></i>
														해당 공사비 산출 목록은 공사현황의 값과 무관합니다.
													</p>
													<p><i class="fa-fw fa fa-info"></i>
														대당단가는 세액을 제외한 공급가액을 입력해야합니다.
													</p>
												</div>
											</th>
										</tr>
										<tr style="background:#ffedaa;">
											<td class="hasinput" style="text-align:center;font-weight:bold;color:#00f;" id="action">
												입력
											</td>
											<td class="hasinput">
												<input type="text" class="form-control" placeholder="[필수]" id="construct_name" name="construct_name">
											</td>
											<td class="hasinput">
												<input type="number" class="form-control" placeholder="[필수]" id="construct_count" name="construct_count">
											</td>
											<td class="hasinput">
												<input type="number" class="form-control" placeholder="[필수]" id="construct_amt" name="construct_amt">
											</td>
											<td class="hasinput">
					{% if session['member']['auth_cd'] == 1 %}
												<div class="btn-group">
													<button type="button" class="btn btn-primary" id="btnSaveConstruct"><i class="fa fa-save"></i></button>
													<button type="button" class="btn btn-primary" id="btnRefrushConstruct" style="padding-left:11px;padding-right:11px;"><i class="fa fa-refresh"></i></button>
												</div>
					{% endif %}
											</td>
										</tr>
										<tr>
											<th style="vertical-align:middle;" class="text-center">No.</th>
											<th style="vertical-align:middle;">모델명</th>
											<th style="vertical-align:middle;">수량</th>
											<th style="vertical-align:middle;">대당단가</th>
											<th style="vertical-align:middle;">-</th>
										</tr>
									</thead>
									<tbody>
									</tbody>
								</table>
							</form>
							</div><!--tab-pane-->

						</div><!--tab-content-->
					</div><!--widget-body-->
				</div><!--content-->
			</div><!--jarviswidget-->
        </div><!--modal-content-->
    </div><!--modal-dialog-->
</div><!--modal-->
<script type="text/javascript">
/******************************************************************************
 *
 */
isDataChange = false;
isDataChangeContract = false;
/******************************************************************************
 *
 */
fnValidateContract = function(pMode = '')
{
	var result = true;

	// 프로젝트 생성여부
	var prjct_creat_at = $('#popBox1').find('input[name=prjct_creat_at]').is(':checked');
	if (result == true && fnIsEmpty(prjct_creat_at)) {
		alert('필수 입력 항목을 입력하시기 바랍니다.');
		result = false;
	}

	// 프로젝트 유형
	var prjct_ty_code = $('#popBox1').find('input[name=prjct_ty_code]').is(':checked');
	if (result == true && fnIsEmpty(prjct_ty_code)) {
		alert('필수 입력 항목을 입력하시기 바랍니다.');
		result = false;
	}

	// 진행상태
	var progrs_sttus_code = $('#popBox1').find('input[name=progrs_sttus_code]').is(':checked');
	if (result == true && fnIsEmpty(progrs_sttus_code)) {
		alert('필수 입력 항목을 입력하시기 바랍니다.');
		result = false;
	}

	// 프로젝트번호
	var cntrct_no = $('#popBox1').find('#cntrct_no').val();
	if (result == true && fnIsEmpty(cntrct_no)) {
		alert('필수 입력 항목을 입력하시기 바랍니다.');
		$('#popBox1').find('#cntrct_no').focus();
		result = false;
	}

	// 계약명(현장명)
	var cntrct_nm = $('#popBox1').find('#cntrct_nm').val();
	if (result == true && fnIsEmpty(cntrct_nm)) {
		alert('필수 입력 항목을 입력하시기 바랍니다.');
		$('#popBox1').find('#cntrct_nm').focus();
		result = false;
	}

	// 거래처
	var bcnc_sn = $('#popBox1').find('#bcnc_sn').val();
	if (result == true && fnIsEmpty(bcnc_sn)) {
		alert('필수 입력 항목을 입력하시기 바랍니다.');
		$('#popBox1').find('#bcnc_sn').focus();
		result = false;
	}

	// 계약일
	var cntrct_no = $('#popBox1').find('#cntrct_de').val();
	if (result == true && fnIsEmpty(cntrct_no)) {
		alert('필수 입력 항목을 입력하시기 바랍니다.');
		$('#popBox1').find('#cntrct_de').focus();
		result = false;
	}

	return result;
}


contractReadOnly = function(readOnly = true){

    $('#popBox1').find('#cntrct_no').attr('readonly', readOnly);
    $('#popBox1').find('#cntrct_de').attr('readonly', readOnly);
    $('#popBox1').find('#bcnc_sn').attr('readonly', readOnly);
    $('#popBox1').find('#cntrwk_bgnde').attr('readonly', readOnly);
    $('#popBox1').find('#cntrwk_endde').attr('readonly', readOnly);

    $('#popBox1').find('#cntrct_nm').attr('readonly', readOnly);
    $('#popBox1').find('#spt_adres').attr('readonly', readOnly);
    $('#popBox1').find('#bsn_chrg_sn').attr('readonly', readOnly);
    $('#popBox1').find('#spt_chrg_sn').attr('readonly', readOnly);
    $('#popBox1').find('#home_count').attr('readonly', readOnly);
    $('#popBox1').find('#home_region').attr('readonly', readOnly);

    $('#popBox1').find('input:radio[name=progrs_sttus_code]').yReadonly(readOnly);
}


getProject = function(s_cntrct_sn, s_prjct_sn)
{
	var params = '';
	params += '&s_cntrct_sn=' + s_cntrct_sn;

	$.ajax({
		url: '/api/project/ajax_get_contract',
		type: 'GET',
		data: params,
		dataType: 'json',
		contentType: false,
		processData: false,
		success: function(pResult) {
			console.log('getContract', pResult);
			if (pResult.status) {
				var data = pResult.data;

				$('#popBox1').find('#s_cntrct_sn').val(data.cntrct_sn);
                $('#popBox1').find('input[name=cntrct_sn]').yVal(data.cntrct_sn);
				$('#popBox1').find('input:radio[name=prjct_creat_at]').yVal(data.prjct_creat_at);
				$('#popBox1').find('input:radio[name=prjct_creat_at]').yReadonly();
				// $('#popBox1').find('#progrs_sttus_code').val(data.progrs_sttus_code);
				$('#popBox1').find('#cntrct_no').val(data.cntrct_no);
				$('#popBox1').find('#cntrct_nm').val(data.cntrct_nm);
				$('#popBox1').find('#cntrct_de').val(data.cntrct_de);
				$('#popBox1').find('#home_count').val(data.home_count);
				$('#popBox1').find('#home_region').yVal(data.home_region);
				$('#popBox1').find('#cntrct_amount').val(data.cntrct_amount);
				$('#popBox1').find('input:radio[name=author]').yVal(data.author);
				$('#popBox1').find('#author').val(data.author);
				$('#popBox1').find('input:radio[name=prjct_ty_code]').yVal(data.prjct_ty_code);
				$('#popBox1').find('input:radio[name=prjct_ty_code]').yReadonly();
				$('#popBox1').find('input:radio[name=progrs_sttus_code]').yVal(data.progrs_sttus_code);
				$('#popBox1').find('input:radio[name=progrs_sttus_code]').yReadonly(false);
				$('#popBox1').find('#bcnc_sn').yVal(data.bcnc_sn);
				// $('#popBox1').find('#bcnc_sn').val(data.bcnc_sn).trigger('change');
				// $('#popBox1').find('#spt_nm').val(data.spt_nm);
				$('#popBox1').find('#spt_adres').val(data.spt_adres);
				$('#popBox1').find('#cntrwk_bgnde').val(data.cntrwk_bgnde);
				$('#popBox1').find('#cntrwk_endde').val(data.cntrwk_endde);
				$('#popBox1').find('#etc_sttus').val(data.etc_sttus);
				$('#popBox1').find('#bsn_chrg_sn').val(data.bsn_chrg_sn).trigger('change');
				$('#popBox1').find('#spt_chrg_sn').val(data.spt_chrg_sn).trigger('change');
				$('#popBox1').find('#partclr_matter').val(data.partclr_matter);


                if (data.prjct_creat_at == 'N') {
					$('#popBox1').modal('show');
                    $('#popEditTabs').find('a[href=#tabBox1]').parent().hide();
                    $('#popEditTabs').find('a[href=#tabBox2]').parent().hide();
                    $('#popEditTabs').find('a[href=#tabBox4]').parent().hide();
                    $('#popEditTabs').find('a[href=#tabBox3]').parent().show();
                    $('#popEditTabs').find('a[href=#tabBox3]').trigger('click');
					$('#popBox1').find('#btnEdit').show();
                } else {

					$('#popBox1').modal('show');
					$('#popBox1').find('#btnEdit').hide();
					if(pResult.project.length > 0){
						var project = pResult.project[0];

						$('#popBox1').find('input[name=s_prjct_sn]').yVal(project.prjct_sn);
						$('#popBox1').find('input[name=cntrct_sn]').yVal(project.cntrct_sn);
						$('#popBox1').find('input[name=prjct_sn]').yVal(project.prjct_sn);
						$('#popBox1').find('input:radio[name=prjct_ty_code]').yVal(project.prjct_ty_code);
						$('#popBox1').find('input:radio[name=prjct_ty_code]').yReadonly();



						$('#tabBox1').find('#cntrct_sn').yVal(project.cntrct_sn);
						$('#tabBox1').find('#prjct_sn').yVal(project.prjct_sn);
						$('#tabBox1').find('#cntrct_se_code').yVal(project.cntrct_se_nm);
						$('#tabBox1').find('#mngr_sn').yVal(project.mngr_sn);
						$('#tabBox1').find('#manage_no').yVal(project.manage_no);
						$('#tabBox1').find('#regist_dtm').yVal(project.regist_dtm);
						$('#tabBox1').find('#eqpmn_dtls').yVal(project.eqpmn_dtls);
						$('#tabBox1').find('#cntrwk_dtls').yVal(project.cntrwk_dtls);
						$('#tabBox1').find('#cntrct_dscnt_rt').yVal(project.cntrct_dscnt_rt);
						$('#tabBox1').find('#cnsul_dscnt_rt').yVal(project.cnsul_dscnt_rt);
						$('#tabBox1').find('#drw_opertor_sn').yVal(project.drw_opertor_sn);
						$('#tabBox1').find('#acmslt_sttemnt_at').yVal(project.acmslt_sttemnt_at);
						$('#tabBox1').find('#cntwrk_regstr_ennc').yVal(project.cntwrk_regstr_ennc);
						$('#tabBox1').find('#acmslt_sttemnt_attmp').yVal(project.acmslt_sttemnt_at);
						$('#tabBox1').find('#cntwrk_regstr_ennctmp').yVal(project.cntwrk_regstr_ennc);
						$('#tabBox1').find('#enty').yVal(project.enty);
						$('#tabBox1').find('#enty_de').yVal(project.enty_de);
						$('#tabBox1').find('#enty_rm').yVal(project.enty_rm);
						$('#tabBox1').find('#prtpay').yVal(project.prtpay);
						$('#tabBox1').find('#prtpay_de').yVal(project.prtpay_de);
						$('#tabBox1').find('#prtpay_rm').yVal(project.prtpay_rm);
						$('#tabBox1').find('#surlus').yVal(project.surlus);
						$('#tabBox1').find('#surlus_de').yVal(project.surlus_de);
						$('#tabBox1').find('#surlus_rm').yVal(project.surlus_rm);
						$('#tabBox1').find('#setle_mth').yVal(project.setle_mth);
						$('#tabBox1').find('#partclr_matter').val(project.partclr_matter);

						if(pResult.charger){
							var charger = pResult.charger;
							$.each(charger, function(pKey, pValue) {
								$('#tabBox1').find('#charger_sn'+pValue.charger_se_code).yVal(pValue.charger_sn);
								$('#tabBox1').find('#charger_nm'+pValue.charger_se_code).yVal(pValue.charger_nm);
								$('#tabBox1').find('#charger_telno'+pValue.charger_se_code).yVal(pValue.charger_telno);
								$('#tabBox1').find('#charger_moblphon'+pValue.charger_se_code).yVal(pValue.charger_moblphon);
								if(pValue.charger_se_code == 6){
									$('#tabBox1').find('#charger_nm'+pValue.charger_se_code + 'tmp').yVal(pValue.charger_nm);
									$('#tabBox1').find('#charger_telno'+pValue.charger_se_code + 'tmp').yVal(pValue.charger_telno);
									$('#tabBox1').find('#charger_moblphon'+pValue.charger_se_code + 'tmp').yVal(pValue.charger_moblphon);
								}
							});
						}


						if (data.prjct_ty_code == 'NR' || data.prjct_ty_code == '') {
							$('#popEditTabs').find('a[href=#tabBox1]').parent().show();
							$('#popEditTabs').find('a[href=#tabBox3]').parent().show();
							// $('#popBox1').find('tr[name=charger]').show();
							// $('#popBox1').find('tr[name=charger2]').hide();
						} else {
							$('#popEditTabs').find('a[href=#tabBox1]').parent().show();
							$('#popEditTabs').find('a[href=#tabBox3]').parent().show();
							// $('#popBox1').find('tr[name=charger]').hide();
							// $('#popBox1').find('tr[name=charger2]').show();
						}
						$('#popEditTabs').find('a[href=#tabBox1]').trigger('click');

					}



                }
			}


		}
	});


}

$('#popBox1').on("click", "#popEditTabs a", function(){
	var action = $(this).data("action");
	if(action  == "tab1"){
		$('#popBox1').find("#btnSaveKeepContract").show();
		contractReadOnly(false);
	}
	else if (action === 'tab2') {
		$('#popBox1').find("#btnSaveKeepContract").hide();
		contractReadOnly(true);
		var cntrct_sn = $('#tabBox2').find('#cntrct_sn').val();
		var prjct_sn = $('#tabBox2').find('#prjct_sn').val();
		getOutsrcList(cntrct_sn, prjct_sn);
	}
	else if(action == "tab3"){
		$('#popBox1').find("#btnSaveKeepContract").hide();
		contractReadOnly(true);
		var cntrct_sn = $('#tabBox3').find('#cntrct_sn').val();
		var prjct_sn = $('#tabBox3').find('#prjct_sn').val();
		getCostList(cntrct_sn, prjct_sn);
	}
	else if(action == "tab4"){
		$('#popBox1').find("#btnSaveKeepContract").hide();
		contractReadOnly(true);
		var cntrct_sn = $('#tabBox3').find('#cntrct_sn').val();
		var prjct_sn = $('#tabBox3').find('#prjct_sn').val();
		getConstructList(cntrct_sn, prjct_sn);

	}
})

$('#popBox1').on('click', '#btnSaveKeepContract', function(pEvent) {
	updateContract();
});
$('#popBox1').on('click', '#btnEdit', function(pEvent) {
	contractReadOnly(false);
	$("#popBox1").find("#btnSaveKeepContract").show();
	$(this).hide();
});

$('#popBox1').on('click', '#btnDelete', function(pEvent) {
	var msg = '';
	msg += '프로젝트 정보를 삭제 할 경우 관련 정보가 모두 삭제되며,\n';
	msg += '복구가 불가능하기에 주의를 요합니다.\n\n';
	msg += '정말 삭제하시겠습니까?';
	if (confirm(msg)) {
		if($('#popBox1').find("input[name='prjct_creat_at']:checked").val() == 'Y'){
			deleteProject();
		}
		else{
			deleteContract();
		}
	}
});

deleteProject = function()
{
	$.ajax({
		url: '/api/project/ajax_delete_project',
		type: 'POST',
		data: getFormData($('#frmBox1')[0]),
		contentType: false,
		processData: false,
		success: function(pResult) {
			if (pResult.status) {
                deleteContract();
			}
		}
	});
}
deleteContract = function()
{
	$.ajax({
		url: '/api/project/ajax_delete_contract',
		type: 'POST',
		data: getFormData($('#frmBoxContract1')[0]),
		contentType: false,
		processData: false,
		success: function(pResult) {
			if (pResult.status) {
				$.datatable1.ajax.reload();
				fnAlert(pResult.message);
				$('#popBox1').modal('hide');
			}
		}
	});
}

updateContract = function()
{
	var progrs_sttus_code = $('#popBox1').find('input:radio[name=progrs_sttus_code]:checked').val();
	var prjct_creat_at = $('#popBox1').find('input[name=prjct_creat_at]:checked').val();
	if (progrs_sttus_code == 'C') {
		var loginID = $('#loginID').val();
		var loginAuth = $('#loginAuth').val();
		if (loginAuth != 8 && loginID != 'nexell' && loginID != 'rotcwhang') {
			alert('관리팀만 마감 할 수 있습니다.');
			return false;
		}
		if(!confirm('마감이후 관련 정보의 변경이 일체 불가능합니다.\n마감하시겠습니까?')) {
			return;
		}
	}
	$.ajax({
		url: '/api/project/ajax_update_contract',
		type: 'POST',
		data: getFormData($('#frmBoxContract1')[0]),
		contentType: false,
		processData: false,
		validate: function() {
			return fnValidateContract('update');
		},
		success: function(pResult) {
			if (pResult.status && prjct_creat_at != 'N') {

				$.ajax({
					url: '/api/project/ajax_update_project',
					type: 'POST',
					data: getFormData($('#frmBox1')[0]),
					contentType: false,
					processData: false,
					validate: function() {
						return true;
					},
					success: function(pResult) {
						if (pResult.status) {
							fnAlert(pResult.message);
							$.datatable1.ajax.reload();
						}
					}
				});


			}
			else{
				contractReadOnly(true);
				$("#popBox1").find("#btnSaveKeepContract").hide();
				$("#popBox1").find("#btnEdit").show();
			}
		}
	});
}


/******************************************************************************
 *
 */
getOutsrcList = function(s_cntrct_sn, s_prjct_sn)
{
	if (s_cntrct_sn == "") {
		return;
	}

	var params = '';
	params += '&s_cntrct_sn=' + s_cntrct_sn;
	params += '&s_prjct_sn=' + s_prjct_sn;

	$.ajax({
		url: '/api/project/ajax_get_outsrc_list',
		type: 'GET',
		data: params,
		dataType: 'json',
		contentType: false,
		processData: false,
		success: function(pResult) {
			// console.log(pResult);
			if (pResult.status) {
				var html = '';
                var progrs_sttus_code = $('#popBox1').find('input:radio[name=progrs_sttus_code]:checked').val();
                if(progrs_sttus_code == 'C'){
                    $('#btnSaveOutsrc').hide();
                }
                else{
                    $('#btnSaveOutsrc').show();

                }

				$.each(pResult.data, function(pIndex, pValue) {
					// console.log(pValue);
					html += '<tr>';
					html += '    <td class="text-center" data-outsrc_sn="'+pValue.outsrc_sn+'">'+(pIndex+1)+'</td>';
					html += '    <td>'+(pValue.outsrc_fo_nm)+'</td>';
					html += '    <td>'+(pValue.cntrct_de.toFormat('DATE'))+'</td>';
					html += '    <td>'+(pValue.pymnt_mth)+'</td>';
					html += '    <td>'+(pValue.outsrc_dtls)+'</td>';
					html += '    <td>'+(pValue.rspnber_nm)+'</td>';
					html += '    <td>'+(pValue.rspnber_telno)+'</td>';
					html += '    <td>'+(pValue.charger_nm)+'</td>';
					html += '    <td>'+(pValue.charger_telno)+'</td>';
					html += '    <td class="hasinput text-right">';

                    if(progrs_sttus_code != 'C'){
					{% if session['member']['auth_cd'] == 1 %}

                        html += '        <div class="btn-group">';
                        html += '	         <button type="button" class="btn btn-table btn-info btnUpdate" title="수정" data-cntrct_sn="'+pValue.cntrct_sn+'" data-prjct_sn="'+pValue.prjct_sn+'" data-outsrc_sn="'+pValue.outsrc_sn+'">';
                        html += '		         <i class="fa fa-edit"></i>';
                        html += '            </button>';
                        html += '	         <button type="button" class="btn btn-table btn-danger btnDelete" style="padding-left:8px;"title="삭제" data-cntrct_sn="'+pValue.cntrct_sn+'" data-prjct_sn="'+pValue.prjct_sn+'" data-outsrc_sn="'+pValue.outsrc_sn+'">';
                        html += '		         <i class="fa fa-trash-o"></i>';
                        html += '            </button>';
						html += '        </div>';
					{% endif %}
                    }
					html += '    </td>';
					html += '</tr>';
				});
				$('#dtList2 tbody').html(html);
			}
		}
	});
}

/******************************************************************************
 *
 */
getOutsrc = function(s_cntrct_sn, s_prjct_sn, s_outsrc_sn)
{
	var params = '';
	params += '&s_cntrct_sn=' + s_cntrct_sn;
	params += '&s_prjct_sn=' + s_prjct_sn;
	params += '&s_outsrc_sn=' + s_outsrc_sn;

	$.ajax({
		url: '/api/project/ajax_get_outsrc',
		type: 'GET',
		data: params,
		contentType: false,
		processData: false,
		success: function(pResult) {


			if (pResult.status) {
				var data = pResult.data;
				$('#tabBox2').find('#s_outsrc_sn').yVal(data.outsrc_sn);
				$('#tabBox2').find('#outsrc_fo_sn').yVal(data.outsrc_fo_sn);
				$('#tabBox2').find('#out_cntrct_de').yVal(data.cntrct_de);
				$('#tabBox2').find('#pymnt_mth').yVal(data.pymnt_mth);
				$('#tabBox2').find('#outsrc_dtls').yVal(data.outsrc_dtls);
				$('#tabBox2').find('#rspnber_nm').yVal(data.rspnber_nm);
				$('#tabBox2').find('#rspnber_telno').yVal(data.rspnber_telno);
				$('#tabBox2').find('#charger_nm').yVal(data.charger_nm);
				$('#tabBox2').find('#charger_telno').yVal(data.charger_telno);
				$('#tabBox2').find('#outsrc_fo_sn').yReadonly(true);
			}
		}
	});
}

/******************************************************************************
 *
 */
insertOutsrc = function()
{
	$.ajax({
		url: '/api/project/ajax_insert_outsrc',
		type: 'POST',
		data: getFormData($('#frmBox2')[0]),
		dataType: 'json',
		contentType: false,
		processData: false,
		validate: function() {
			var outsrc_fo_sn = $('#tabBox2').find('#outsrc_fo_sn').val();
			if (outsrc_fo_sn == '') {
				alert('필수 입력 항목을 입력하시기 바랍니다.');
				return false;
			}
			// var cntrct_de = $('#tabBox2').find('#cntrct_de').val();
			// if (cntrct_de == '') {
			// 	alert('필수 입력 항목을 입력하시기 바랍니다.');
			// 	return false;
			// }
			// var pymnt_mth = $('#tabBox2').find('#pymnt_mth').val();
			// if (pymnt_mth == '') {
			// 	alert('필수 입력 항목을 입력하시기 바랍니다.');
			// 	return false;
			// }
			// var outsrc_dtls = $('#tabBox2').find('#outsrc_dtls').val();
			// if (outsrc_dtls == '') {
			// 	alert('필수 입력 항목을 입력하시기 바랍니다.');
			// 	return false;
			// }
			return true;
		},
		success: function(pResult) {
			// console.log(pResult);
			if (pResult.status) {
				fnAlert(pResult.message);
				$('#tabBox2').find('#outsrc_fo_sn').yVal(pResult.outsrc_fo_sn);
				$('#tabBox2').find('#out_cntrct_de').yVal(pResult.cntrct_de);
				$('#tabBox2').find('#pymnt_mth').yVal(pResult.pymnt_mth);
				$('#tabBox2').find('#outsrc_dtls').yVal(pResult.outsrc_dtls);
				$('#tabBox2').find('#rspnber_nm').yVal(pResult.rspnber_nm);
				$('#tabBox2').find('#rspnber_telno').yVal(pResult.rspnber_telno);
				$('#tabBox2').find('#charger_nm').yVal(pResult.charger_nm);
				$('#tabBox2').find('#charger_telno').yVal(pResult.charger_telno);
				var cntrct_sn = $('#tabBox2').find('#cntrct_sn').val();
				var prjct_sn = $('#tabBox2').find('#prjct_sn').val();
				getOutsrcList(cntrct_sn, prjct_sn);
			} else {
				fnAlert(pResult.error, 'error');
			}
		}
	});
}

/******************************************************************************
 *
 */
updateOutsrc = function()
{
	$.ajax({
		url: '/api/project/ajax_update_outsrc',
		type: 'POST',
		data: getFormData($('#frmBox2')[0]),
		dataType: 'json',
		contentType: false,
		processData: false,
		validate: function() {
			var outsrc_fo_sn = $('#tabBox2').find('#outsrc_fo_sn').val();
			if (outsrc_fo_sn == '') {
				alert('필수 입력 항목을 입력하시기 바랍니다.');
				return false;
			}
			// var cntrct_de = $('#tabBox2').find('#cntrct_de').val();
			// if (cntrct_de == '') {
			// 	alert('필수 입력 항목을 입력하시기 바랍니다.');
			// 	return false;
			// }
			// var pymnt_mth = $('#tabBox2').find('#pymnt_mth').val();
			// if (pymnt_mth == '') {
			// 	alert('필수 입력 항목을 입력하시기 바랍니다.');
			// 	return false;
			// }
			// var outsrc_dtls = $('#tabBox2').find('#outsrc_dtls').val();
			// if (outsrc_dtls == '') {
			// 	alert('필수 입력 항목을 입력하시기 바랍니다.');
			// 	return false;
			// }
			return true;
		},
		success: function(pResult) {
			// console.log(pResult);
			if (pResult.status) {
				fnAlert(pResult.message);
				var cntrct_sn = $('#tabBox2').find('#cntrct_sn').val();
				var prjct_sn = $('#tabBox2').find('#prjct_sn').val();
				getOutsrcList(cntrct_sn, prjct_sn);
			} else {
				fnAlert(pResult.error, 'error');
			}
		}
	});
}

/******************************************************************************
 *
 */
deleteOutsrc = function(s_cntrct_sn, s_prjct_sn, s_outsrc_sn)
{
	var params = '';
	params += '&s_cntrct_sn=' + s_cntrct_sn;
	params += '&s_prjct_sn=' + s_prjct_sn;
	params += '&s_outsrc_sn=' + s_outsrc_sn;

	$.ajax({
		url: '/api/project/ajax_delete_outsrc',
		type: 'GET',
		data: params,
		contentType: false,
		processData: false,
		success: function(pResult) {
			if (pResult.status) {
				fnAlert(pResult.message);
				$('#tabBox2').find('#outsrc_fo_sn').yVal('');
				$('#tabBox2').find('#out_cntrct_de').yVal('');
				$('#tabBox2').find('#pymnt_mth').yVal('');
				$('#tabBox2').find('#outsrc_dtls').yVal('');
				$('#tabBox2').find('#rspnber_nm').yVal('');
				$('#tabBox2').find('#rspnber_telno').yVal('');
				$('#tabBox2').find('#charger_nm').yVal('');
				$('#tabBox2').find('#charger_telno').yVal('');
				$('#tabBox2').find('#outsrc_fo_sn').yReadonly(false);
				var cntrct_sn = $('#tabBox2').find('#cntrct_sn').val();
				var prjct_sn = $('#tabBox2').find('#prjct_sn').val();
				getOutsrcList(cntrct_sn, prjct_sn);
			}
		}
	});
}

	$('#tabBox2').on('click', '#btnSaveOutsrc', function(pEvent) {
		var outsrc_sn = $('#tabBox2').find('#s_outsrc_sn').val();
		if (outsrc_sn === '') {
			insertOutsrc();
		} else {
			updateOutsrc();
		}
	});

    /**************************************************************************
     *
     */
	$('#tabBox2').on('click', '#btnRefrushOutsrc', function(pEvent) {
		$('#tabBox2').find('#action').html('입력');
		$('#tabBox2').find('#s_outsrc_sn').yVal('');
		$('#tabBox2').find('#outsrc_fo_sn').yVal('');
		$('#tabBox2').find('#out_cntrct_de').yVal('');
		$('#tabBox2').find('#pymnt_mth').yVal('');
		$('#tabBox2').find('#outsrc_dtls').yVal('');
		$('#tabBox2').find('#rspnber_nm').yVal('');
		$('#tabBox2').find('#rspnber_telno').yVal('');
		$('#tabBox2').find('#charger_nm').yVal('');
		$('#tabBox2').find('#charger_telno').yVal('');
		$('#tabBox2').find('#outsrc_fo_sn').yReadonly(false);
	});

    /**************************************************************************
     *
     */
	$('#tabBox2').on('click', '.btnUpdate', function(pEvent) {
		$('#tabBox2').find('#action').html('수정');
		var target = pEvent.currentTarget;
		var cntrct_sn = $(target).data('cntrct_sn');
		var prjct_sn = $(target).data('prjct_sn');
		var outsrc_sn = $(target).data('outsrc_sn');
		getOutsrc(cntrct_sn, prjct_sn, outsrc_sn);
	});

    /**************************************************************************
     *
     */
	$('#tabBox2').on('click', '.btnDelete', function(pEvent) {
		var target = pEvent.currentTarget;
		var cntrct_sn = $(target).data('cntrct_sn');
		var prjct_sn = $(target).data('prjct_sn');
		var outsrc_sn = $(target).data('outsrc_sn');

		if (confirm('삭제하시겠습니까?')) {
			deleteOutsrc(cntrct_sn, prjct_sn, outsrc_sn);
		}
	});

    /**************************************************************************
     *
     */
	$('#dtList2').on('click', 'tbody tr', function(pEvent) {
		if ($(this).parent().find('td.dataTables_empty').length > 0) {
			return;
		} else {
			$(this).parent().find('tr.selected').removeClass('selected');
			$(this).addClass('selected');
		}
	});


/*************************
 * 예정 공사비
 *************************/
getCostList = function(s_cntrct_sn, s_prjct_sn)
{
	if (s_cntrct_sn == "") {
		return;
	}

	var params = '';
	params += '&s_cntrct_sn=' + s_cntrct_sn;
	params += '&s_prjct_sn=' + s_prjct_sn;

	$.ajax({
		url: '/api/project/ajax_get_cost_list',
		type: 'GET',
		data: params,
		dataType: 'json',
		contentType: false,
		processData: false,
		success: function(pResult) {
			console.log("get_cost_list", pResult);
			if (pResult.status) {
				var html = '';
                var progrs_sttus_code = $('#popBox1').find('input:radio[name=progrs_sttus_code]:checked').val();

                if(progrs_sttus_code == 'C'){
                    $('#btnSaveCost').hide();
                }
                else{
                    $('#btnSaveCost').show();

                }
                var author = $('#popBox1').find('input:radio[name=author]:checked').val();

                if(author == '0'){
                    $('#btnSaveCost').hide();
                }
				$.each(pResult.data, function(pIndex, pValue) {
					// console.log(pValue);
					var dscnt_rt = '', add_dscnt_rt = '', fee_rt = '';
                    var extra_sn = '';
                    if (pValue.extra_sn != 0){
                        extra_sn = parseInt(pValue.extra_sn);
                    }
					if (pValue.dscnt_rt != '') {
						dscnt_rt = parseFloat(pValue.dscnt_rt).toFixed(1)+'%';
					}
					if (pValue.add_dscnt_rt != '') {
						add_dscnt_rt = parseFloat(pValue.add_dscnt_rt).toFixed(1)+'%';
					}
					if (pValue.fee_rt != '') {
						fee_rt = parseFloat(pValue.fee_rt).toFixed(1)+'%';
					}

					html += '<tr>';
					html += '    <td class="text-center" data-cntrwk_ct_sn="'+pValue.cntrwk_ct_sn+'">'+(pIndex+1)+'</td>';
					html += '    <td>'+(pValue.cntrct_execut_nm)+'</td>';
					html += '    <td>'+(pValue.ct_se_nm)+'</td>';
					html += '    <td>'+(pValue.purchsofc_nm)+'</td>';
					html += '    <td>'+(pValue.prdlst_se_nm)+'</td>';
					html += '    <td>'+(pValue.cost_type_nm)+'</td>';
					html += '    <td>'+(pValue.model_no)+'</td>';
					html += '    <td class="text-right">'+(pValue.qy.toFormat('NUMBER'))+'</td>';
					html += '    <td class="text-right">'+(pValue.puchas_amount.toFormat('NUMBER'))+'</td>';
					html += '    <td class="text-right"></td>';
					html += '    <td class="text-right">'+(pValue.salamt.toFormat('NUMBER'))+'</td>';
					html += '    <td class="text-right"></td>';
					html += '    <td class="text-right">'+(dscnt_rt)+'</td>';
					html += '    <td>'+(pValue.cost_date.toFormat('DATE'))+'</td>';
					html += '    <td class="text-right">'+(add_dscnt_rt)+'</td>';
					html += '    <td class="text-right">'+(fee_rt)+'</td>';
					html += '    <td>'+(pValue.dspy_se_nm)+'</td>';
					html += '    <td>'+(pValue.dspy_de.toFormat('DATE'))+'</td>';
					html += '    <td>'+extra_sn+'</td>';
					html += '    <td>'+(pValue.reg_de.toFormat('DATE'))+'</td>';
					html += '    <td class="hasinput text-right">';

                    if(progrs_sttus_code != 'C'){
					{% if session['member']['auth_cd'] == 1 %}

					html += '        <div class="btn-group">';
					html += '	         <button type="button" class="btn btn-table btn-info btnUpdate" title="수정" data-cntrct_sn="'+pValue.cntrct_sn+'" data-prjct_sn="'+pValue.prjct_sn+'" data-cntrwk_ct_sn="'+pValue.cntrwk_ct_sn+'">';
					html += '		         <i class="fa fa-edit"></i>';
					html += '            </button>';
					html += '	         <button type="button" class="btn btn-table btn-danger btnDelete" style="padding-left:8px;"title="삭제" data-cntrct_sn="'+pValue.cntrct_sn+'" data-prjct_sn="'+pValue.prjct_sn+'" data-cntrwk_ct_sn="'+pValue.cntrwk_ct_sn+'">';
					html += '		         <i class="fa fa-trash-o"></i>';
					html += '            </button>';
					html += '        </div>';
					{% endif %}
                    }
					html += '    </td>';
					html += '</tr>';
				});
				$('#dtList3 tbody').html(html);

			}
		}
	});
}

getConstructList = function(s_cntrct_sn, s_prjct_sn)
{
	if (s_cntrct_sn == "") {
		return;
	}

	var params = '';
	params += '&s_cntrct_sn=' + s_cntrct_sn;
	params += '&s_prjct_sn=' + s_prjct_sn;

	$.ajax({
		url: '/api/project/ajax_get_construct_list',
		type: 'GET',
		data: params,
		dataType: 'json',
		contentType: false,
		processData: false,
		success: function(pResult) {
			console.log("get_construct_list", pResult);
			if (pResult.status) {
				var html = '';
                var progrs_sttus_code = $('#popBox1').find('input:radio[name=progrs_sttus_code]:checked').val();

                if(progrs_sttus_code == 'C'){
                    $('#btnSaveConstruct').hide();
                }
                else{
                    $('#btnSaveConstruct').show();

                }
                var author = $('#popBox1').find('input:radio[name=author]:checked').val();

                if(author == '0'){
                    $('#btnSaveConstruct').hide();
                }
				$.each(pResult.data, function(pIndex, pValue) {

					html += '<tr>';
					html += '    <td class="text-center" data-construct_sn="'+pValue.construct_sn+'">'+(pIndex+1)+'</td>';
					html += '    <td>'+(pValue.construct_name)+'</td>';
					html += '    <td class="text-right">'+(pValue.construct_count.toFormat('NUMBER'))+'</td>';
					html += '    <td class="text-right">'+(pValue.construct_amt.toFormat('NUMBER'))+'</td>';
					html += '    <td class="hasinput text-right">';

                    if(progrs_sttus_code != 'C'){
					{% if session['member']['auth_cd'] == 1 %}

					html += '        <div class="btn-group">';
					html += '	         <button type="button" class="btn btn-table btn-info btnUpdate" title="수정" data-cntrct_sn="'+pValue.cntrct_sn+'" data-prjct_sn="'+pValue.prjct_sn+'" data-construct_sn="'+pValue.construct_sn+'">';
					html += '		         <i class="fa fa-edit"></i>';
					html += '            </button>';
					html += '	         <button type="button" class="btn btn-table btn-danger btnDelete" style="padding-left:8px;"title="삭제" data-cntrct_sn="'+pValue.cntrct_sn+'" data-prjct_sn="'+pValue.prjct_sn+'" data-construct_sn="'+pValue.construct_sn+'">';
					html += '		         <i class="fa fa-trash-o"></i>';
					html += '            </button>';
					html += '        </div>';
					{% endif %}
                    }
					html += '    </td>';
					html += '</tr>';
				});
				$('#dtList4 tbody').html(html);

			}
		}
	});
}

/******************************************************************************
 *
 */
getCost = function(s_cntrct_sn, s_prjct_sn, s_cntrwk_ct_sn)
{
	var params = '';
	params += '&s_cntrct_sn=' + s_cntrct_sn;
	params += '&s_prjct_sn=' + s_prjct_sn;
	params += '&s_cntrwk_ct_sn=' + s_cntrwk_ct_sn;

	$.ajax({
		url: '/api/project/ajax_get_cost',
		type: 'GET',
		data: params,
		contentType: false,
		processData: false,
		success: function(pResult) {
			if (pResult.status) {
				var data = pResult.data;

				$('#tabBox3').find('#s_cntrwk_ct_sn').yVal(data.cntrwk_ct_sn);
				$('#tabBox3').find('#cntrct_execut_code').yVal(data.cntrct_execut_code);
				$('#tabBox3').find('#ct_se_code').yVal(data.ct_se_code);
				$('#tabBox3').find('#purchsofc_sn').yVal(data.purchsofc_sn);
				$('#tabBox3').find('#prdlst_se_code').yVal(data.prdlst_se_code);
				$('#tabBox3').find('#cost_type').yVal(data.cost_type);
				$('#tabBox3').find('#model_no').yVal(data.model_no);
				$('#tabBox3').find('#qy').yVal(data.qy);
				$('#tabBox3').find('#puchas_amount').yVal(data.puchas_amount);
				$('#tabBox3').find('#salamt').yVal(data.salamt);
				$('#tabBox3').find('#puchas_amount_tot').yVal('');
				$('#tabBox3').find('#salamt_tot').yVal('');
				$('#tabBox3').find('#dscnt_rt').yVal(data.dscnt_rt);
				$('#tabBox3').find('#cost_date').yVal(data.cost_date);
				$('#tabBox3').find('#add_dscnt_rt').yVal(data.add_dscnt_rt);
				$('#tabBox3').find('#extra_sn').yVal(data.extra_sn);
				$('#tabBox3').find('#fee_rt').yVal(data.fee_rt);
				$('#tabBox3').find('#dspy_se_code').yVal(data.dspy_se_code);
				$('#tabBox3').find('#dspy_de').yVal(data.dspy_de);
				$('#tabBox3').find('#reg_de').yVal(data.reg_de);
				// $('#tabBox3').find('#cntrct_execut_code').yReadonly(true);
				// $('#tabBox3').find('#ct_se_code').yReadonly(true);
				// $('#tabBox3').find('#purchsofc_sn').yReadonly(true);
			}
		}
	});
}
/******************************************************************************
 *
 */
getConstruct = function(s_cntrct_sn, s_prjct_sn, s_construct_sn)
{
	var params = '';
	params += '&s_cntrct_sn=' + s_cntrct_sn;
	params += '&s_prjct_sn=' + s_prjct_sn;
	params += '&s_construct_sn=' + s_construct_sn;

	$.ajax({
		url: '/api/project/ajax_get_construct',
		type: 'GET',
		data: params,
		contentType: false,
		processData: false,
		success: function(pResult) {
			if (pResult.status) {
				var data = pResult.data;

				$('#tabBox4').find('#s_construct_sn').yVal(data.construct_sn);
				$('#tabBox4').find('#construct_name').yVal(data.construct_name);
				$('#tabBox4').find('#construct_count').yVal(data.construct_count);
				$('#tabBox4').find('#construct_amt').yVal(data.construct_amt);
			}
		}
	});
}

/******************************************************************************
 *
 */
insertCost = function()
{
	$.ajax({
		url: '/api/project/ajax_insert_cost',
		type: 'POST',
		data: getFormData($('#frmBox3')[0]),
		dataType: 'json',
		contentType: false,
		processData: false,
		validate: function() {
			var cntrct_execut_code = $('#tabBox3').find('#cntrct_execut_code').val();
			if (cntrct_execut_code == '') {
				alert('필수 입력 항목을 입력하시기 바랍니다.');
				return false;
			}
			var ct_se_code = $('#tabBox3').find('#ct_se_code').val();
			if (ct_se_code == '') {
				alert('필수 입력 항목을 입력하시기 바랍니다.');
				return false;
			}
			// var purchsofc_sn = $('#tabBox3').find('#purchsofc_sn').val();
			// if (purchsofc_sn == '') {
			// 	alert('필수 입력 항목을 입력하시기 바랍니다.');
			// 	return false;
			// }
			var qy = $('#tabBox3').find('#qy').val();
			if (qy == '') {
				alert('필수 입력 항목을 입력하시기 바랍니다.');
				return false;
			}
			var puchas_amount = $('#tabBox3').find('#puchas_amount').val();
			var puchas_amount_tot = $('#tabBox3').find('#puchas_amount_tot').val();
			if (puchas_amount != '' && puchas_amount_tot != '') {
				alert('단가/총금액 중 한가지 값만 입력 바랍니다.');
				return false;
			}
            else if(puchas_amount_tot != ''){

                $('#tabBox3').find('#puchas_amount').yVal(parseInt(puchas_amount_tot)/parseInt(qy));
                $('#tabBox3').find('#puchas_amount_tot').yVal('');
                return insertCost();
            }

			var salamt = $('#tabBox3').find('#salamt').val();
			var salamt_tot = $('#tabBox3').find('#salamt_tot').val();
			if (salamt != '' && salamt_tot != '') {
				alert('단가/총금액 중 한가지 값만 입력 바랍니다.');
				return false;
			}
            else if(salamt_tot != ''){
                $('#tabBox3').find('#salamt').yVal(parseInt(salamt_tot)/parseInt(qy));
                $('#tabBox3').find('#salamt_tot').yVal('');
                return insertCost();
            }
            if (cntrct_execut_code == 'A' || cntrct_execut_code == 'C'){
                var cd = $('#tabBox3').find('#cost_date').val();
                if (cd == '') {
                    alert('계약날짜를 입력하시기 바랍니다.');
                    return false;
                }
            }
			return true;
		},
		success: function(pResult) {
			// console.log(pResult);
			if (pResult.status) {
				fnAlert(pResult.message);
				if (!confirm('계속 등록하시겠습니까?')) {
					$('#tabBox3').find('#s_cntrwk_ct_sn').yVal('');
					$('#tabBox3').find('#cntrct_execut_code').yVal('');
					$('#tabBox3').find('#ct_se_code').yVal('');
					$('#tabBox3').find('#purchsofc_sn').yVal('');
					$('#tabBox3').find('#prdlst_se_code').yVal('');
					$('#tabBox3').find('#cost_type').yVal('');
					$('#tabBox3').find('#model_no').yVal('');
					$('#tabBox3').find('#qy').yVal('');
					$('#tabBox3').find('#puchas_amount').yVal('');
					$('#tabBox3').find('#salamt').yVal('');
					$('#tabBox3').find('#puchas_amount_tot').yVal('');
					$('#tabBox3').find('#salamt_tot').yVal('');
					$('#tabBox3').find('#dscnt_rt').yVal('');
					$('#tabBox3').find('#cost_date').yVal('');
					$('#tabBox3').find('#add_dscnt_rt').yVal('');
					$('#tabBox3').find('#extra_sn').yVal('');
					$('#tabBox3').find('#fee_rt').yVal('');
					$('#tabBox3').find('#dspy_se_code').yVal('');
					$('#tabBox3').find('#dspy_de').yVal('');
					$('#tabBox3').find('#reg_de').yVal('');
				}
				var cntrct_sn = $('#tabBox3').find('#cntrct_sn').val();
				var prjct_sn = $('#tabBox3').find('#prjct_sn').val();
				getCostList(cntrct_sn, prjct_sn);
			} else {
				fnAlert(pResult.error, 'error');
			}
		}
	});
}

/******************************************************************************
 *
 *//******************************************************************************
 *
 */
insertConstruct = function()
{
	$.ajax({
		url: '/api/project/ajax_insert_construct',
		type: 'POST',
		data: getFormData($('#frmBox4')[0]),
		dataType: 'json',
		contentType: false,
		processData: false,
		validate: function() {
			var construct_name = $('#tabBox4').find('#construct_name').val();
			if (construct_name == '') {
				alert('필수 입력 항목을 입력하시기 바랍니다.');
				return false;
			}
			var construct_count = $('#tabBox4').find('#construct_count').val();
			if (construct_count == '') {
				alert('필수 입력 항목을 입력하시기 바랍니다.');
				return false;
			}
			var construct_amt = $('#tabBox4').find('#construct_amt').val();
			if (construct_amt == '') {
				alert('필수 입력 항목을 입력하시기 바랍니다.');
				return false;
			}
			return true;
		},
		success: function(pResult) {
			// console.log(pResult);
			if (pResult.status) {
				fnAlert(pResult.message);
				if (!confirm('계속 등록하시겠습니까?')) {
					$('#tabBox4').find('#s_construct_sn').yVal('');
					$('#tabBox4').find('#construct_name').yVal('');
					$('#tabBox4').find('#construct_count').yVal('');
					$('#tabBox4').find('#construct_amt').yVal('');
				}
				var cntrct_sn = $('#tabBox4').find('#cntrct_sn').val();
				var prjct_sn = $('#tabBox4').find('#prjct_sn').val();
				getConstructList(cntrct_sn, prjct_sn);
			} else {
				fnAlert(pResult.error, 'error');
			}
		}
	});
}

/******************************************************************************
 *
 */
updateCost = function()
{
	$.ajax({
		url: '/api/project/ajax_update_cost',
		type: 'POST',
		data: getFormData($('#frmBox3')[0]),
		dataType: 'json',
		contentType: false,
		processData: false,
		validate: function() {
			var cntrct_execut_code = $('#tabBox3').find('#cntrct_execut_code').val();
			if (cntrct_execut_code == '') {
				alert('필수 입력 항목을 입력하시기 바랍니다.');
				return false;
			}
			var ct_se_code = $('#tabBox3').find('#ct_se_code').val();
			if (ct_se_code == '') {
				alert('필수 입력 항목을 입력하시기 바랍니다.');
				return false;
			}
			// var purchsofc_sn = $('#tabBox3').find('#purchsofc_sn').val();
			// if (purchsofc_sn == '') {
			// 	alert('필수 입력 항목을 입력하시기 바랍니다.');
			// 	return false;
			// }
			var qy = $('#tabBox3').find('#qy').val();
			if (qy == '') {
				alert('필수 입력 항목을 입력하시기 바랍니다.');
				return false;
			}
			var puchas_amount = $('#tabBox3').find('#puchas_amount').val();
			var puchas_amount_tot = $('#tabBox3').find('#puchas_amount_tot').val();
			if (puchas_amount != '' && puchas_amount_tot != '') {
				alert('단가/총금액 중 한가지 값만 입력 바랍니다.');
				return false;
			}
            else if(puchas_amount_tot != ''){

                $('#tabBox3').find('#puchas_amount').yVal(parseInt(puchas_amount_tot)/parseInt(qy));
                $('#tabBox3').find('#puchas_amount_tot').yVal('');

            }

			var salamt = $('#tabBox3').find('#salamt').val();
			var salamt_tot = $('#tabBox3').find('#salamt_tot').val();
			if (salamt != '' && salamt_tot != '') {
				alert('단가/총금액 중 한가지 값만 입력 바랍니다.');
				return false;
			}
            else if(salamt_tot != ''){

                $('#tabBox3').find('#salamt').yVal(parseInt(salamt_tot)/parseInt(qy));
                $('#tabBox3').find('#salamt_tot').yVal('');

            }

            if (cntrct_execut_code == 'A' || cntrct_execut_code == 'C'){
                var cd = $('#tabBox3').find('#cost_date').val();
                if (cd == '') {
                    alert('계약날짜를 입력하시기 바랍니다.');
                    return false;
                }
            }

			return true;
		},
		success: function(pResult) {
			// console.log(pResult);
			if (pResult.status) {
				fnAlert(pResult.message);
				var cntrct_sn = $('#tabBox3').find('#cntrct_sn').val();
				var prjct_sn = $('#tabBox3').find('#prjct_sn').val();
				getCostList(cntrct_sn, prjct_sn);
			} else {
				fnAlert(pResult.error, 'error');
			}
		}
	});
}

/******************************************************************************
 *
 */
updateConstruct = function()
{
	$.ajax({
		url: '/api/project/ajax_update_construct',
		type: 'POST',
		data: getFormData($('#frmBox4')[0]),
		dataType: 'json',
		contentType: false,
		processData: false,
		validate: function() {
			var construct_name = $('#tabBox4').find('#construct_name').val();
			if (construct_name == '') {
				alert('필수 입력 항목을 입력하시기 바랍니다.');
				return false;
			}
			var construct_count = $('#tabBox4').find('#construct_count').val();
			if (construct_count == '') {
				alert('필수 입력 항목을 입력하시기 바랍니다.');
				return false;
			}
			var construct_amt = $('#tabBox4').find('#construct_amt').val();
			if (construct_amt == '') {
				alert('필수 입력 항목을 입력하시기 바랍니다.');
				return false;
			}

			return true;
		},
		success: function(pResult) {
			// console.log(pResult);
			if (pResult.status) {
				fnAlert(pResult.message);
				var cntrct_sn = $('#tabBox4').find('#cntrct_sn').val();
				var prjct_sn = $('#tabBox4').find('#prjct_sn').val();
				getConstructList(cntrct_sn, prjct_sn);
			} else {
				fnAlert(pResult.error, 'error');
			}
		}
	});
}

/******************************************************************************
 *
 */
deleteCost = function(s_cntrct_sn, s_prjct_sn, s_cntrwk_ct_sn)
{
	var params = '';
	params += '&s_cntrct_sn=' + s_cntrct_sn;
	params += '&s_prjct_sn=' + s_prjct_sn;
	params += '&s_cntrwk_ct_sn=' + s_cntrwk_ct_sn;

	$.ajax({
		url: '/api/project/ajax_delete_cost',
		type: 'GET',
		data: params,
		contentType: false,
		processData: false,
		success: function(pResult) {
			if (pResult.status) {
				fnAlert(pResult.message);
				$('#tabBox3').find('#action').html('입력');
				$('#tabBox3').find('#s_cntrwk_ct_sn').yVal('');
				$('#tabBox3').find('#cntrct_execut_code').yVal('');
				$('#tabBox3').find('#ct_se_code').yVal('');
				$('#tabBox3').find('#purchsofc_sn').yVal('');
				$('#tabBox3').find('#prdlst_se_code').yVal('');
				$('#tabBox3').find('#cost_type').yVal('');
				$('#tabBox3').find('#model_no').yVal('');
				$('#tabBox3').find('#qy').yVal('');
				$('#tabBox3').find('#puchas_amount').yVal('');
				$('#tabBox3').find('#salamt').yVal('');
				$('#tabBox3').find('#puchas_amount_tot').yVal('');
				$('#tabBox3').find('#salamt_tot').yVal('');
				$('#tabBox3').find('#dscnt_rt').yVal('');
				$('#tabBox3').find('#cost_date').yVal('');
				$('#tabBox3').find('#add_dscnt_rt').yVal('');
				$('#tabBox3').find('#extra_sn').yVal('');
				$('#tabBox3').find('#fee_rt').yVal('');
				$('#tabBox3').find('#dspy_se_code').yVal('');
				$('#tabBox3').find('#dspy_de').yVal('');
				$('#tabBox3').find('#cntrct_execut_code').yReadonly(false);
				$('#tabBox3').find('#ct_se_code').yReadonly(false);
				$('#tabBox3').find('#purchsofc_sn').yReadonly(false);
				var cntrct_sn = $('#tabBox3').find('#cntrct_sn').val();
				var prjct_sn = $('#tabBox3').find('#prjct_sn').val();
				getCostList(cntrct_sn, prjct_sn);
			}
		}
	});
}

/******************************************************************************
 *
 */
deleteConstruct = function(s_cntrct_sn, s_prjct_sn, s_construct_sn)
{
	var params = '';
	params += '&s_cntrct_sn=' + s_cntrct_sn;
	params += '&s_prjct_sn=' + s_prjct_sn;
	params += '&s_construct_sn=' + s_construct_sn;

	$.ajax({
		url: '/api/project/ajax_delete_construct',
		type: 'GET',
		data: params,
		contentType: false,
		processData: false,
		success: function(pResult) {
			if (pResult.status) {
				fnAlert(pResult.message);
				$('#tabBox4').find('#action').html('입력');
				$('#tabBox4').find('#s_construct_sn').yVal('');
				$('#tabBox4').find('#construct_name').yVal('');
				$('#tabBox4').find('#construct_count').yVal('');
				$('#tabBox4').find('#construct_amt').yVal('');
				var cntrct_sn = $('#tabBox4').find('#cntrct_sn').val();
				var prjct_sn = $('#tabBox4').find('#prjct_sn').val();
				getConstructList(cntrct_sn, prjct_sn);
			}
		}
	});
}

	$('#tabBox3').on('click', '#btnSaveCost', function(pEvent) {
		var cntrwk_ct_sn = $('#tabBox3').find('#s_cntrwk_ct_sn').val();
		if (cntrwk_ct_sn === '') {
			insertCost();
		} else {
			updateCost();
		}
	});
	$('#tabBox4').on('click', '#btnSaveConstruct', function(pEvent) {
		var s_construct_sn = $('#tabBox4').find('#s_construct_sn').val();
		if (s_construct_sn === '') {
			insertConstruct();
		} else {
			updateConstruct();
		}
	});

    /**************************************************************************
     *
     */
	$('#tabBox3').on('click', '#btnRefrushCost', function(pEvent) {
		$('#tabBox3').find('#action').html('입력');
		$('#tabBox3').find('#s_cntrwk_ct_sn').yVal('');
		$('#tabBox3').find('#cntrct_execut_code').yVal('');
		$('#tabBox3').find('#ct_se_code').yVal('');
		$('#tabBox3').find('#purchsofc_sn').yVal('');
		$('#tabBox3').find('#prdlst_se_code').yVal('');
		$('#tabBox3').find('#cost_type').yVal('');
		$('#tabBox3').find('#model_no').yVal('');
		$('#tabBox3').find('#qy').yVal('');
		$('#tabBox3').find('#puchas_amount').yVal('');
		$('#tabBox3').find('#salamt').yVal('');
		$('#tabBox3').find('#dscnt_rt').yVal('');
		$('#tabBox3').find('#cost_date').yVal('');
		$('#tabBox3').find('#add_dscnt_rt').yVal('');
		$('#tabBox3').find('#extra_sn').yVal('');
		$('#tabBox3').find('#fee_rt').yVal('');
		$('#tabBox3').find('#dspy_se_code').yVal('');
		$('#tabBox3').find('#dspy_de').yVal('');
		$('#tabBox3').find('#cntrct_execut_code').yReadonly(false);
		$('#tabBox3').find('#ct_se_code').yReadonly(false);
		$('#tabBox3').find('#purchsofc_sn').yReadonly(false);
	});
	$('#tabBox4').on('click', '#btnRefrushConstruct', function(pEvent) {
		$('#tabBox4').find('#action').html('입력');
		$('#tabBox4').find('#s_construct_sn').yVal('');
		$('#tabBox4').find('#construct_name').yVal('');
		$('#tabBox4').find('#construct_count').yVal('');
		$('#tabBox4').find('#construct_amt').yVal('');
	});

    /**************************************************************************
     *
     */
	$('#dtList3').on('click', 'tbody tr', function(pEvent) {
		if ($(this).parent().find('td.dataTables_empty').length > 0) {
			return;
		} else {
			$(this).parent().find('tr.selected').removeClass('selected');
			$(this).addClass('selected');
		}
	});

	$('#dtList4').on('click', 'tbody tr', function(pEvent) {
		if ($(this).parent().find('td.dataTables_empty').length > 0) {
			return;
		} else {
			$(this).parent().find('tr.selected').removeClass('selected');
			$(this).addClass('selected');
		}
	});

	/**************************************************************************
     *
     */
	$('#tabBox3').on('click', '.btnUpdate', function(pEvent) {
		$('#tabBox3').find('#action').html('수정');
		var target = pEvent.currentTarget;
		var cntrct_sn = $(target).data('cntrct_sn');
		var prjct_sn = $(target).data('prjct_sn');
		var cntrwk_ct_sn = $(target).data('cntrwk_ct_sn');
		getCost(cntrct_sn, prjct_sn, cntrwk_ct_sn);
	});
	$('#tabBox4').on('click', '.btnUpdate', function(pEvent) {
		$('#tabBox4').find('#action').html('수정');
		var target = pEvent.currentTarget;
		var cntrct_sn = $(target).data('cntrct_sn');
		var prjct_sn = $(target).data('prjct_sn');
		var construct_sn = $(target).data('construct_sn');
		getConstruct(cntrct_sn, prjct_sn, construct_sn);
	});

    /**************************************************************************
     *
     */
	$('#tabBox3').on('click', '.btnDelete', function(pEvent) {
		var target = pEvent.currentTarget;
		var cntrct_sn = $(target).data('cntrct_sn');
		var prjct_sn = $(target).data('prjct_sn');
		var cntrwk_ct_sn = $(target).data('cntrwk_ct_sn');

		if (confirm('삭제하시겠습니까?')) {
			deleteCost(cntrct_sn, prjct_sn, cntrwk_ct_sn);
		}
	});

	$('#tabBox4').on('click', '.btnDelete', function(pEvent) {
		var target = pEvent.currentTarget;
		var cntrct_sn = $(target).data('cntrct_sn');
		var prjct_sn = $(target).data('prjct_sn');
		var construct_sn = $(target).data('construct_sn');

		if (confirm('삭제하시겠습니까?')) {
			deleteConstruct(cntrct_sn, prjct_sn, construct_sn);
		}
	});



</script>


<div class="modal fade" data-backdrop="static" id="popBoxBiss">
    <style type="text/css">
#popBoxBiss tbody .btnUpdate, #popBox1 tbody .btnPrint{
    line-height: 1.42857143 !important;
    padding: 5px 7px!important;
    margin:  0px !important;
}
#popBoxBiss tbody{
    font-size:12px!important;
}

    </style>
    <div class="modal-dialog modal-w900" style="width:800px!important">
        <div class="modal-content">
			<div class="jarviswidget jarviswidget-color-greenDark">
				<header>
					<ul class="nav nav-tabs" id="popEditTabsBiss">
						<li class="active" data-action="1">
							<a data-toggle="tab" href="#tabBoxBiss1" data-action="tab1"><i class="fa fa-lg fa-edit"></i>&nbsp;<span>BISS 입력</span></a>
						</li>
					</ul>
					<div class="jarviswidget-ctrls" role="menu">
						<a class="button-icon jarviswidget-delete-btn" aria-hidden="true" data-dismiss="modal"><i class="fa fa-times"></i></a>
					</div>

				</header>
				<div role="content" style="min-height:110px;">
					<!-- widget edit box -->
					<div class="jarviswidget-editbox no-padding" style="display:block;">

					</div>
					<!-- end widget edit box -->
					<div class="widget-body no-padding">
						<div class="tab-content">

							<!-- 프로젝트 -->
							<div class="tab-pane fade active in" id="tabBoxBiss1">
							<form id="frmBoxBiss">
								<table class="table table-bordered table-form">
									<colgroup>
										<col width="175">
										<col width="390">
										<col width="60">
									</colgroup>
									<tbody>
										<tr>
											<th class="" style="background:#0070C0;border-color:#0070C0;color:white;border-left:none;padding:0;" colspan="3">
											<span class="widget-toolbar" id="popEditToolbarBiss">
												<button type="button" class="btn btn-primary" id="btnSaveBiss" title="저장합니다."><i class="fa fa-save"> 저장</i></button>

											</span>
											</th>
										</tr>

										<tr class="required">
											<th class="color-contract">현장명</th>
											<td class="hasinput" colspan="2">
												<select class="form-control select2" id="cntrct_sn" name="cntrct_sn">
													<option value="">[계약을 선택해주세요.]</option>
													{% for code in contract_list %}
													<option value="{{code.value}}">{{code.label}}</option>
													{% endfor %}
												</select>
											</td>
										</tr>
										<tr class="required">
											<th class="color-contract">BISS건수</th>
											<td class="hasinput" colspan="2">
												<input type="number" step="1" name="biss" id="biss" class="form-control text-right"/>
											</td>
										</tr>
									</tbody>
								</table>
							</form>
							</div><!--tab-pane-->
						</div><!--tab-content-->
					</div><!--widget-body-->
				</div><!--content-->
			</div><!--jarviswidget-->
        </div><!--modal-content-->
    </div><!--modal-dialog-->
</div><!--modal-->

<script>
	init = function(){
		$("#popBoxBiss").find("#s_bsn_chrg_sn").yVal('');
		$("#popBoxBiss").find("#cntrct_sn").yVal('');
		$("#popBoxBiss").find("#biss").val('');

	}
	$(document).on('click', '#btnSaveBiss', function(){
		var session = {{session | tojson | safe}};
		var authors = [""];
		var loginId = $("#loginID").val();
		console.log(session.member.auth_cd, 1, "1");
		if(!authors.includes("*") && !authors.includes(loginId) && ![1, 2, 3, 6].includes(session.member.auth_cd)){
			alert("권한이 없습니다.");
			return false;
		}
		var params = $("#frmBoxBiss").formSerialize();
		if($('#popBoxBiss').find("#cntrct_sn").val() == ''){
			alert("계약을 선택해주세요.");
			return false;
		}
		$.ajax({
			url: '/api/project/ajax_update_flaw_co',
			type: 'GET',
			data: params,
			dataType: 'json',
			contentType: false,
			processData: false,
			success: function (pResult) {
				alert("저장되었습니다.");
				init();
			}

		});
	});

	$('#popBoxBiss').on('shown.bs.modal', function(pEvent)
	{
		init();
	});
</script>

{% endblock %}