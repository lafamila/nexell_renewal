{% extends 'common/main_base.html' %}
{% block content %}

<!--########################################################################-->
<!--# contents style end                                                   #-->
<!--########################################################################-->

<style type="text/css">
tbody .btnUpdate, tbody .btn{
    line-height: 0.3!important;
}
    tbody{
        font-size:12px!important;
    }
    .table>tbody>tr>td, .table>tbody>tr>th, .table>tfoot>tr>td, .table>tfoot>tr>th, .table>thead>tr>td, .table>thead>tr>th {
        line-height: 0.95!important;
    }
    #dtList1.table>tbody>tr>td, #dtList1.table>tbody>tr>th, #dtList1.table>tfoot>tr>td, #dtList1.table>tfoot>tr>th, #dtList1.table>thead>tr>td, #dtList1.table>thead>tr>th {
        line-height: 1.95!important;
    }
	.color-blue{
		color:blue!important;
	}
</style>
<!--########################################################################-->
<!--# RIBBON area start                                                    #-->
<!--########################################################################-->
<div id="ribbon" style="background:#B3E5FC!important;">
	<span class="ribbon-button-alignment">
		<span class="btn btn-ribbon"><i class="fa fa-refresh"></i></span>
	</span>
    <ol class="breadcrumb" style="font-size:14px !important;">
<!--		<li>홈</li><li>계약 및 프로젝트</li><li>계약 및 프로젝트 등록</li>-->
        <style>
            .breadcrumb>li+li:before {
                content: ">";
                color : #374850!important;
            }
        </style>
        <li style="font-size:17px !important;color:#1565C0!important;">개인근태현황</li><li><span> 근태 관리</span></li>
	</ol>



</div>
<!--########################################################################-->
<!--# RIBBON area end                                                      #-->
<!--########################################################################-->


<!--########################################################################-->
<!--# contents area start                                                  #-->
<!--########################################################################-->
<div id="content">

	<!-- 화면 제목 -->
	<div class="row">
		<div class="col-xs-12 col-sm-7 col-md-7 col-lg-4">
<!--
			<h1 class="page-title txt-color-blueDark">
				<i class="fa-fw fa fa-list-alt"></i>
					목표 관리 <span>> 기성</span>
			</h1>
-->
		</div>

		<!-- right side of the page with the sparkline graphs -->
		<div class="col-xs-12 col-sm-5 col-md-5 col-lg-8">
		</div>
	</div>

	<!-- 화면 설명 -->
<!--
	<div class="alert alert-block alert-info" style="background:#e6faff!important;">
		<p><i class="fa-fw fa fa-info"></i>
			월별 수주 계획을 관리합니다.
		</p>
	</div>
-->

	<!-- 화면 내용 -->
	<section id="widget-grid">

		<div class="row">
			<article class="">

				<!-- Widget ID (each widget will need unique ID)-->
				<div class="jarviswidget jarviswidget-color-darken">
                    <script>


                    </script>
					<header>
						<span class="widget-icon"> <i class="fa fa-list"></i> </span>
                        <h2>개인 근태 현황</h2>
						<div class="widget-toolbar">
                            <button class="btn btn-info" data-toggle="modal" href="#popReport1"><i class="fa fa-info"> 휴가사용내역</i></button>
							<button type="button" class="btn btn-success" id="btnExcel"><i class="fa fa-file-excel-o"> 엑셀 다운로드</i></button>
						</div>


					</header>
					<!-- widget body div-->
					<div>
						<!-- widget edit box -->
						<div class="jarviswidget-editbox">
						</div>
						<!-- end widget edit box -->
						<style>
                            .bottom_border{

                                border-bottom: 2px solid #666!important;
                            }
                            .top_border{

                                border-top: 2px solid #666!important;
                            }
                            .right_border{
                                border-right: 2px solid #666!important;
                            }

                            .left_border{
                                border-left: 2px solid #666!important;
                            }
                            #dtList1 tbody, #dtList1 thead tr{
                                font-size: 11px!important;
                            }
							#dtList tbody tr td:first-child{
								border-left-width:0!important;
							}
							#dtList tbody tr td:last-child{
								border-right-width:0!important;
							}
							#dtList tbody tr:last-child td{
								border-bottom-width:0!important;
							}
							table.table-bordered tbody td, table.table-bordered tbody th {
								border-left-width: 1px;
								border-bottom-width: 1px;
							}
                            .colorEG{
                                background:rgb(255,204,153)!important;
                                font-weight: bold;
                            }
                            .colorJ{
                                background:#3d8b40!important;
                                font-weight: bold;
                                color:white;
                            }
                            .colorSky{
                                background:rgb(146, 205, 220);
                                font-weight: bold;
                            }
                            .tot{
                                background:rgb(255,153,204);
                                font-weight: bold;
                            }
                            .sub_tot{
                                background:#e6faff!important;
                                font-size:8px!important;
                                font-weight: 600!important;
                            }
                            .bold{
                                font-size:11px!important;
                                font-weight: 600!important;
								text-overflow: ellipsis!important;
								overflow: hidden;
								white-space: nowrap;
                            }
                            .colorG {
                                background: rgb(204,255,204)!important;
                            }
/*
                            .colorY {
                                background: #FDFD96!important;
                            }
*/
                            .table>tbody+tbody {
                                border-top: 2px solid #666;
                            }
                            .table>thead+tbody {
                                border-top: 2px solid #666;
                            }
                            .middle{
                                vertical-align: middle!important;
                            }
                            @media (min-width: 100px) and (max-width: 1024px) {


                                body.smart-style-6 #content{
                                        margin-left: 0px;
                                        padding:30px 0px;
                                }
                            }
                            .jarviswidget>div{
                                font-size:12px!important;
                            }
                            .colored{
                                background: #FFFF00!important   ;
                            }
                            .coloredRed{
                                background: rgb(255,153,204)!important;
                            }
							.no-padding-3{
								padding-right:3px!important;
								padding-left:3px!important;
							}
							.color-red{
								color: red!important;
							}
                        </style>
						<!-- widget content -->
                      <div class="widget-body no-padding">
							<table class="datatable table table-bordered table-hover" id="dtList0">
                              <colgroup>
                                <col width="12.5%">
                                <col width="12.5%">
                                <col width="12.5%">
                                <col width="12.5%">
                                <col width="12.5%">
                                <col width="12.5%">
                                <col width="12.5%">
                                <col width="12.5%">
                              </colgroup>
                              <thead>
                                <tr>
                                  <th colspan="4" class="text-center">직전 연차일수</th>
                                  <th colspan="4" class="text-center">현 연차일수</th>
                                </tr>
                                <tr>
                                  <th class="text-center">발생일수</th>
                                  <th class="text-center">조정일수</th>
                                  <th class="text-center">사용일수</th>
                                  <th class="text-center">잔여일수</th>
                                  <th class="text-center">발생일수</th>
                                  <th class="text-center">조정일수</th>
                                  <th class="text-center">사용일수</th>
                                  <th class="text-center">잔여일수</th>
                                </tr>
                              </thead>
                              <tbody>

                              </tbody>
                            </table>
                      </div>

                      <div class="widget-body no-padding">
							<table class="datatable table table-bordered table-hover" id="dtList1">
								<colgroup>
									<col width="14.28%">
									<col width="14.28%">
									<col width="14.28%">
									<col width="14.28%">
									<col width="14.28%">
									<col width="14.28%">
									<col width="14.28%">
								</colgroup>
								<thead>
									<!-- 헤더 -->
									<tr>
										<th class="hasinput" colspan="7">
											<span style="margin-left:15px;margin-right:20px;">년월</span>
											<input type="text" class="form-control datepicker-s" style="display:inline;width:96px!important;" data-dateformat="yy-mm-dd" data-mask="9999-99-99" data-mask-placeholder="_" id="s_calendar" name="s_calendar" placeholder="[기준일자]">
										</th>
									</tr>
									<tr>
										<th class="text-center" colspan="7" id="title">2023년 2월</th>
									</tr>
                                    <tr>
										<th class="text-center color-red">일</th>
										<th class="text-center">월</th>
										<th class="text-center">화</th>
										<th class="text-center">수</th>
										<th class="text-center">목</th>
										<th class="text-center">금</th>
										<th class="text-center">토</th>
									</tr>
								</thead>
                                <tbody>


                                </tbody>
                            </table>
						</div>
						<!-- end widget content -->
					</div>
					<!-- end widget body div -->
				</div>
				<!-- end widget -->

			</article>
		</div>

	</section>

</div>
<!--########################################################################-->
<!--# contents area end                                                    #-->
<!--########################################################################-->


<!--########################################################################-->
<!--# commom script start                                                  #-->
<!--########################################################################-->
<script>
getWorkPersonal = function(){

	var now = new Date();

	var params = '';
	let offset = (new Date()).getTimezoneOffset() * 60000;
	var calendar = $('.datepicker-s').val();
	params += '&s_stdyy='+(new Date(now.getTime()-offset)).toISOString().split("T")[0];
	params += '&calendar='+calendar;
	console.log(params);
	$.ajax({
		url: '/api/work/ajax_get_personal',
		type: 'GET',
		data: params,
		dataType: 'json',
		contentType: false,
		processData: false,
		success: function (pResult) {
			if(pResult.data.length == 0){
				alert("현재 날짜가 입사일 이전이거나, 사용할 수 없는 아이디입니다.");
				return false;
			}
			var pData = pResult.data[0];
			var html = `<tr>
							<td class="text-center bottom_border" style="border-bottom:2px solid #CCC!important;">${parseFloat(pData.last_tot).toFixed(1)}</td>
							<td class="text-center bottom_border" style="border-bottom:2px solid #CCC!important;">${parseFloat(pData.last_mod).toFixed(1)}</td>
							<td class="text-center bottom_border" style="border-bottom:2px solid #CCC!important;">${parseFloat(pData.last_use).toFixed(1)}</td>
							<td class="text-center bottom_border" style="border-bottom:2px solid #CCC!important;">${(parseFloat(pData.last_tot) + parseFloat(pData.last_mod) - parseFloat(pData.last_use)).toFixed(1)}</td>
							<td class="text-center bottom_border" style="border-bottom:2px solid #CCC!important;">${parseFloat(pData.tot).toFixed(1)}</td>
							<td class="text-center bottom_border" style="border-bottom:2px solid #CCC!important;">${parseFloat(pData.mod).toFixed(1)}</td>
							<td class="text-center bottom_border" style="border-bottom:2px solid #CCC!important;">${parseFloat(pData.use).toFixed(1)}</td>
							<td class="text-center bottom_border" style="border-bottom:2px solid #CCC!important;">${(parseFloat(pData.tot) + parseFloat(pData.mod) - parseFloat(pData.use)).toFixed(1)}</td>
						</tr>`;
			$(document).find("#dtList0").find("tbody").html(html);
			console.log(pResult.calendar);
			var html = '';
			$.each(pResult.calendar.rows, function(pIndex, pRow){
				html += `<tr>`;
				$.each(pRow, function(i, r){
					let text = [0, 6].includes(i) ? "휴일" : (r == '' ? '' : pResult.timer[r]);
					var rowHTML = `<div style="margin-top:10px;text-align:left!important;">${text}</div>`;
					if(r=='') rowHTML = `<div style="margin-top:10px;text-align:left!important;"></div>`;
					if([0, 6].includes(i)) html += `<td class="color-red text-right">${r}${rowHTML}</td>`;
					else html += `<td class="text-right">${r}${rowHTML}</td>`;
				});
				for(let _=0;_<7-pRow.length;_++) html += `<td></td>`;
				html += `</tr>`;
			});
			$(document).find("#dtList1").find("tbody").html(html);
			$(document).find("#dtList1").find("#title").html(`${calendar.split("-")[0]}년 ${calendar.split("-")[1]}월`);
			console.log();
		}
	});


}

</script>

<script>
$(document).on('click', '#btnExcel', function(e) {
    var postfix = $("#s_stdyy").val();
    var fileName = "월별 매출현황(공조)"+postfix+".xls";
    var a = document.createElement('a');
    var data_type = 'data:application/vnd.ms-excel';
    var table_html = '';
    var tbl = 'dtList1';
    var table_div = document.getElementById(tbl);

    table_html += table_div.outerHTML.replace(/ /g, '%20');
    a.href = data_type + ',%EF%BB%BF' + table_html;
    a.download = fileName;
    a.click();


    e.preventDefault();



});

</script>
<script type="text/javascript">


$(function () {
  $('table.floating-thead').each(function() {
    if( $(this).css('border-collapse') == 'collapse') {
      $(this).css('border-collapse','separate').css('border-spacing',0);
    }
    $(this).prepend( $(this).find('thead:first').clone().hide().css('top',160).css('position','fixed') );
  });

  $(window).scroll(function() {
    var scrollTop = $(window).scrollTop(),
      scrollLeft = $(window).scrollLeft();
    $('table.floating-thead').each(function(i,v) {
      var thead = $(this).find('thead:last'),
        clone = $(this).find('thead:first'),
        top = $(this).offset().top,
        bottom = top + $(this).height() - thead.height();

      if( scrollTop < top-180 || scrollTop > bottom ) {
        clone.hide();
        return true;
      }
      if( clone.is('visible') ) return true;
      var fixP = 0;
      clone.find('th').each(function(i) {
        if(thead.find('th').eq(i).html() == '계'){
            fixP = -1;
        }
        $(this).width( thead.find('th').eq(i).width() +fixP);
      });
      clone.css("margin-left", -scrollLeft ).width( thead.width() ).show();
    });
  });
});

$(function() {
	/**************************************************************************
     *
     */
	$('.datepicker-s').datepicker({
		onSelect: function(dateText) {
			$(this).change();
		},
	});
	var date = $('.datepicker-s').val();
	if (date == '') {
		$('.datepicker-s').datepicker('setDate', 'today');
	}
	$(document).on('change', '.datepicker-s', function(pEvent){
		if ($(this).data('before')) {
			if ($(this).data('before') != $(this).val()) {
				getWorkPersonal();
			}
		} else {
			getWorkPersonal();
		}
	});
	getWorkPersonal();
});
</script>
{% endblock %}
