{% extends 'common/main_base.html' %}
{% block content %}
<style>

    .table>tbody>tr>td, .table>tbody>tr>th, .table>tfoot>tr>td, .table>tfoot>tr>th, .table>thead>tr>td, .table>thead>tr>th {
        line-height: 0.5 !important;
    }

    #rcppay_status_summary{
        line-height: 0.5 !important;

    }
	.middle{
		vertical-align: middle!important;
		text-overflow: ellipsis!important;
		overflow: hidden;
		white-space: nowrap;
	}
	.color-red{
		color:red!important;
	}
	.colorLY{
		background-color:#FAFAD2!important;
	}

</style>

<div id="ribbon" style="background:#B3E5FC!important;">
	<span class="ribbon-button-alignment">
		<span id="refresh" class="btn btn-ribbon" data-action="resetWidgets" data-title="refresh"  rel="tooltip" data-placement="bottom" data-original-title="<i class='text-warning fa fa-warning'></i> Warning! This will reset all your widget settings." data-html="true">
			<i class="fa fa-refresh"></i>
		</span>
	</span>
    <ol class="breadcrumb">
        <li style="">대시보드</li>
	</ol>
</div>

<div id="content" style="width:1580px!important;margin: 0 auto;">

	<!-- 화면 내용 -->
	<section id="widget-grid" class="" style="margin-top:20px;">

		<!-- row -->
		<div class="row report">

<!-- 기성 현황 시작 -->
<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
    <div style="position: relative;">

        <h5 style="position: absolute; left: 0; top: 0; width:100%;overflow: hidden" class="sub-title underline" id="dashboard_title1">팀별 실적 현황 <span style="font-size:12px!important;">(VAT 포함)</span></h5>
        <div style="position: absolute; right: 0; top: -5px; text-align: right; max-width: 50%; overflow: hidden">
            <button class="btn btn-info" data-toggle="modal" href="#popReport99"><i class="fa fa-print"> 영업점검</i></button>
            <button class="btn btn-info" data-toggle="modal" href="#popReport8"><i class="fa fa-print"> 사전입찰</i></button>
            <button class="btn btn-info" data-toggle="modal" href="#popReport1"><i class="fa fa-print"> 연간현황</i></button>
            <input type="text" class="form-control datepicker-s" style="display:inline-block;width:89px!important;padding-top:5px!important;" readonly data-dateformat="yy-mm-dd" data-mask="9999-99-99" data-mask-placeholder="_" id="s_pxcond_mt" name="s_pxcond_mt" placeholder="[시작일자]">
            <button class="btn btn-info" id="dash_search">이동</button>

        </div>
    </div>
    <br/>
    <br/>
	<table id="rptContractStatus" class="table table-bordered w100p">
		<colgroup>
			<col width="100">
			<col width="150">
			<col width="*">
		</colgroup>
		<tbody role="header">
			<tr>
				<th class="colorB" style="vertical-align:middle;border-right:2px solid black!important;" rowspan="2">구분</th>
				<th class="colorB" style="vertical-align:middle;border-right:2px solid black!important;" rowspan="2">팀</th>
				<th class="colorB" colspan="3" id="rptContractStatus_m" style="border-right:2px solid black!important;border-bottom:1px solid black!important;">월</th>
				<th class="colorB" colspan="3" style="border-right:2px solid black!important;border-bottom:1px solid black!important;">누계</th>
				<th class="colorB" colspan="2" style="border-right:2px solid black!important;border-bottom:1px solid black!important;">

                    연간

                </th>
                <th class="colorB" style="vertical-align:middle;" rowspan="2">팀점유율</th>
			</tr>
			<tr>
				<th class="colorB" style="border-right:1px solid black!important;">목표</th>
				<th class="colorB" style="border-right:1px solid black!important;">실적</th>
				<th class="colorB" style="border-right:2px solid black!important;">%</th>
				<th class="colorB" style="border-right:1px solid black!important;">목표</th>
				<th class="colorB" style="border-right:1px solid black!important;">실적</th>
				<th class="colorB" style="border-right:2px solid black!important;">%</th>
				<th class="colorB" style="border-right:1px solid black!important;">목표</th>
				<th class="colorB" style="border-right:2px solid black!important;">%</th>
			</tr>
		</tbody>
		<tbody role="body">
		</tbody>
	</table>
	<br>
</div>
<!-- 기성 현황 끝 -->

<!-- CS 발생현황 시작 -->
<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
	<h5 class="sub-title underline">현장현황 및 BISS 지적현황</h5>
    <table class="table table-bordered w100p" style="width:30%!important;border-bottom:none!important;">
		<colgroup>
			<col width="75">
			<col width="140">
			<col width="75">
			<col width="75">
			<col width="75">
			<col width="75">
		</colgroup>
		<tbody role="header" style="border-bottom:none!important;">
            <tr>
                <th rowspan="3" class="colorB" style="vertical-align:middle;font-size:11px!important;">기준</th>
                <th class="colorB" style="font-size:11px!important;">부서</th>
                <th class="colorB" style="font-size:11px!important;">진행</th>
                <th class="colorB" style="font-size:11px!important;">대기</th>
                <th class="colorB" style="font-size:11px!important;">사전</th>
                <th class="colorB" style="font-size:11px!important;">유보</th>
            </tr>
            <tr>
                <td style="font-size:11px!important;">공조</td>
                <td style="font-size:11px!important;">공1%</td>
                <td style="font-size:11px!important;">공0%</td>
                <td style="font-size:11px!important;">낙찰</td>
                <td style="font-size:11px!important;">미지급</td>
            </tr>
            <tr>
                <td style="font-size:11px!important;">빌트</td>
                <td style="font-size:11px!important;">납품1%</td>
                <td style="font-size:11px!important;">납품0%</td>
                <td style="font-size:11px!important;">낙찰</td>
                <td style="font-size:11px!important;">미입금</td>
            </tr>
        </tbody>

    </table>
	<table id="rptBissSummery" class="table table-bordered w100p">
		<colgroup>
			<col width="75">
			<col width="140">
			<col width="30">
			<col width="75">
			<col width="75">
			<col width="75">
			<col width="75">
			<col width="75">
			<col width="75">
			<col width="125">
<!--			<col width="*">-->
			<col width="575">
			<col width="75">
			<col width="75">
		</colgroup>
		<tbody role="header">
			<tr>
				<th class="colorB" style="vertical-align:middle;border-right:2px solid black!important;" colspan="9">현장현황</th>
				<th class="colorG" colspan="4">BiSS 지적현황</th>
			</tr>
			<tr>
				<th class="colorB" style="vertical-align:middle;">부서</th>
				<th class="colorB" style="vertical-align:middle;" colspan="2">담당자</th>
				<th class="colorB" style="vertical-align:middle;">진행현장</th>
				<th class="colorB" style="vertical-align:middle;">대기현장</th>
				<th class="colorB" style="vertical-align:middle;">사전입찰</th>
				<th class="colorB" style="vertical-align:middle;">유보</th>
				<th class="colorB" style="vertical-align:middle;">판매</th>
				<th class="colorB" style="vertical-align:middle;border-right:2px solid black!important;">계</th>





                <th class="colorG" style="border-right:2px solid black!important;">건설사</th>
				<th class="colorG">계약명(현장명)</th>
				<th class="colorG">BiSS건수</th>
				<th class="colorG">계</th>
			</tr>
		</tbody>
		<tbody role="body">
		</tbody>
        <tbody role="foot">

				<th class="colorSky" style="vertical-align:middle;" colspan="3">총계</th>
				<th class="colorSky" style="vertical-align:middle;"></th>
				<th class="colorSky" style="vertical-align:middle;"></th>
				<th class="colorSky" style="vertical-align:middle;"></th>
				<th class="colorSky" style="vertical-align:middle;"></th>
				<th class="colorSky" style="vertical-align:middle;"></th>
				<th class="colorSky" style="vertical-align:middle;border-right:2px solid black!important;"></th>
				<th class="colorSky" style="vertical-align:middle;" colspan="2"></th>
				<th class="colorSky" style="vertical-align:middle;"></th>
				<th class="colorSky" style="vertical-align:middle;"></th>

        </tbody>
	</table>
	<br>
</div>
<!-- CS 발생현황 끝 -->

<!-- 미수금현황 시작 -->
<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
		<h5 class="sub-title underline">외상미수금</h5>
		<table id="rcppay_status_summary">
			<colgroup>
                        <col width="60">
                        <col width="120">
                        <col width="220">
                        <col width="80">
                        <col width="100">
                        <col width="100">
                        <col width="100">
                        <col width="100">
                        <col width="120">
                        <col width="80">
                        <col width="60">
                        <col width="80">
                        <col width="100">
                        <col width="100">
            </colgroup>
            <thead>
                <tr>
                    <th class="colorG" colspan="14">입금</th>
                </tr>
                <tr>
                    <th class="colorG">출고월</th>
                    <th class="colorG">거래처명</th>
                    <th class="colorG">현장명</th>
                    <th class="colorG">부서</th>
                    <th class="colorG">장비대</th>
                    <th class="colorG">로지텍</th>
                    <th class="colorG">설치비</th>
                    <th class="colorG">합계</th>
                    <th class="colorG">세금계산서금액</th>
                    <td class="colorG">거래구분</td>
                    <th class="colorG">예정일</th>
                    <th class="colorButton">입금일</th>
                    <th class="colorButton">입금액</th>
                    <th class="colorButton">미입금액</th>

                </tr>
            </thead>
            <tbody role="body">
            </tbody>
            <tfoot>
                <tr>
                    <th class="colorG" style="" colspan="4">합계</th>
                    <th class="colorG text-number"></th>
                    <th class="colorG text-number"></th>
                    <th class="colorG text-number"></th>
                    <th class="colorG text-number"></th>
                    <th class="colorG text-number"></th>
                    <th class="colorP text-number" colspan="2"></th>
                    <th class="colorButton"></th>
                    <th class="colorButton"></th>
                    <th class="colorButton"></th>
                </tr>
            </tfoot>
		</table>
	<br>
</div>
<!-- 미수금현황 끝 -->

<!-- 매입/매출 현황 시작 -->
<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">

    <div style="position: relative;">

        <h5 style="position: absolute; left: 0; top: 0; width:100%;overflow: hidden" class="sub-title underline">매입처별 매입 현황 (장비, 자재)</h5>
        <div style="position: absolute; right: 0; top: -5px; text-align: right; max-width: 50%; overflow: hidden">
<!--            <button class="btn btn-info" data-toggle="modal" href="#popReport9"><i class="fa fa-print"> 로지텍</i></button>-->
            <button class="btn btn-info" data-toggle="modal" href="#popReport4"><i class="fa fa-print"> 연간현황</i></button>
            <input type="text" class="form-control datepicker-s" style="display:inline-block;width:89px!important;padding-top:5px!important;" readonly data-dateformat="yy-mm-dd" data-mask="9999-99-99" data-mask-placeholder="_" id="s_pxcond_mt_last" name="s_pxcond_mt_last" placeholder="[시작일자]">
            <button class="btn btn-info" id="last_search">이동</button>

        </div>
    </div>
    <br/>
    <br/>
	<table id="rptSalesSummery" class="table table-bordered w100p">
	</table>
	<br>
</div>
<!-- 매입/매출 현황 끝 -->

		</div>
		<!-- end row -->
	</section>
	<!-- end widget grid -->

</div>

<script type="text/javascript">
$(function(){

	/**************************************************************************
	* 거래일 캘린더 셋팅
	*/
	var minYears = 1;
	var maxYears = 3;
	$('#s_pxcond_mt').datepicker({
		beforeShow: function(dateText) {
			$(this).data('before', $(this).val());
		},
		onSelect: function(dateText) {
			$(this).change();
		},
		onClose: function(dateText) {
			var minDate = new Date($(this).val());
			minDate.setDate(minDate.getDate() - ((365*maxYears)-1));
		},
	});

	var end = $('#s_pxcond_mt').val();
	if (end == '') {
		$('#s_pxcond_mt').datepicker('setDate', 'today');
	}
    end = $('#s_pxcond_mt').val();

	$('#s_pxcond_mt_last').datepicker({
		beforeShow: function(dateText) {
			$(this).data('before', $(this).val());
		},
		onSelect: function(dateText) {
			$(this).change();
		},
		onClose: function(dateText) {
			var minDate = new Date($(this).val());
			minDate.setDate(minDate.getDate() - ((365*maxYears)-1));
		},
	});

	var end = $('#s_pxcond_mt_last').val();
	if (end == '') {
		$('#s_pxcond_mt_last').datepicker('setDate', 'today');
	}
    end = $('#s_pxcond_mt').val();
	getCompletedSummary(end);
    getSalesExpectReport();
	getBissSummery();
    end = $('#s_pxcond_mt_last').val();
	getSalesSummary(end);
});
$("#dash_search").on("click", function(){
    var end = $('#s_pxcond_mt').val();
	getCompletedSummary(end);

});
$("#last_search").on("click", function(){
    var end = $('#s_pxcond_mt_last').val();
	getSalesSummary(end);

});

/******************************************************************************
 * 기성현황
 */
getCompletedSummary = function(s_pxcond_mt)
{
    var params = '';
	params += '&s_pxcond_mt='+s_pxcond_mt;
	$.ajax({
		url: '/api/dashboard/ajax_get_completed_summary',
		type: 'GET',
		data: params,
		dataType: 'json',
		contentType: false,
		processData: false,
		success: function(pResult) {
            console.log("ajax_get_completed_summary", pResult);
			var pxcond_mt = pResult.s_pxcond_mt;
			var pxcond_mt_arr = pxcond_mt.split('-');
			var year = parseInt(pxcond_mt_arr[0]);
			var month = parseInt(pxcond_mt_arr[1]);
			var day = parseInt(pxcond_mt_arr[2]);
            $("#dashboard_title1").html(year+'년 '+month+'월 팀별 실적 현황 <span style="font-size:12px!important;">(VAT 포함)</span>');
			// ============================================================
			var html = '';
			var rt1 = 0, rt2 = 0, rt3 = 0;
			var b_amt1 = 0, b_amt2 = 0, b_amt3 = 0, b_amt4 = 0, b_amt5 = 0;
			var total1 = 0, total2 = 0, total3 = 0, total4 = 0, total5 = 0;
			$('#content').find('#rptContractStatus_m').html(month+'월');
			$.each(pResult.contractStatusList, function(pIndex, pValue){
				if (pValue.amt_ty_code == '2') { // 수주
                    b_amt1 = parseInt(pValue.m_contract_amount); if(isNaN(b_amt1)) b_amt1 = 0;
                    b_amt2 = parseInt(pValue['m'+parseInt(pxcond_mt_arr[1])]); if(isNaN(b_amt2)) b_amt2 = 0;
                    b_amt3 = parseInt(pValue.y_contract_amount); if(isNaN(b_amt3)) b_amt3 = 0;
                    b_amt4 = 0; for(i=1; i<=month; i++) { b_amt4 += isNaN(parseInt(pValue['m'+i]))?0:parseInt(pValue['m'+i]); } if(isNaN(b_amt4)) b_amt4 = 0;
                    b_amt5 = 0; for(i=1; i<=12; i++) { b_amt5 += isNaN(parseInt(pValue['m'+i]))?0:parseInt(pValue['m'+i]); } if(isNaN(b_amt5)) b_amt5 = 0;
					rt1 = (b_amt2 < 0) ? 100.0 + (b_amt2 - b_amt1)*100/b_amt2 : (b_amt1/b_amt2)*100; if (isNaN(rt1)) rt1 = 0.0;
					rt2 = (b_amt4 < 0) ? 100.0 + (b_amt4 - b_amt3)*100/b_amt4 : (b_amt3/b_amt4)*100; if (isNaN(rt2)) rt2 = 0.0;
					rt3 = (b_amt3/b_amt5)*100; if (isNaN(rt3)) rt3 = 0.0;

					html += '<tr>';
					html += '    <td class="text-center colorSky" style="vertical-align:middle;border-right:2px solid black!important;border-bottom:1px solid black!important;"><a data-toggle="modal" href="#popReport2" style="color:inherit;">'+pValue.amt_ty_nm+'</a></td>';
                    html += '    <td class="text-center" style="border-right:2px solid black!important;">'+pValue.dept_nm+'</td>';
                    html += '    <td class="text-number">'+b_amt2.toString().toFormat('NUMBER')+'</td>';
                    html += '    <td class="text-number">'+b_amt1.toString().toFormat('NUMBER')+'</td>';
                    html += '    <td class="text-number" style="border-right:2px solid black!important;">'+((rt1 == Infinity)? '' : (rt1.toFixed(1)+'%'))+'</td>';
                    html += '    <td class="text-number">'+b_amt4.toString().toFormat('NUMBER')+'</td>';
                    html += '    <td class="text-number">'+b_amt3.toString().toFormat('NUMBER')+'</td>';
                    html += '    <td class="text-number" style="border-right:2px solid black!important;">'+((rt2 == Infinity)? '' : (rt2.toFixed(1)+'%'))+'</td>';
                    html += '    <td class="text-number">'+b_amt5.toString().toFormat('NUMBER')+'</td>';
                    html += '    <td class="text-number" style="border-right:2px solid black!important;">'+((rt3 == Infinity)? '' : (rt3.toFixed(1)+'%'))+'</td>';
                    html += '    <td class="text-number total-rates" data-target="suju_rates'+pValue.amt_ty_code+'" data-amount="'+b_amt5+'"></td>';
                    html += '</tr>';
					// 합계처리
					total1 += parseInt(b_amt1);
					total2 += parseInt(b_amt2);
					total3 += parseInt(b_amt3);
					total4 += parseInt(b_amt4);
					total5 += parseInt(b_amt5);
					if ((pIndex+1)%pValue.dept_count == 0) {
						rt1 =  (total2 < 0) ? 100.0 + (total2 - total1)*100/total2 : (total1/total2)*100; if (isNaN(rt1)) rt1 = 0.0;
						rt2 =  (total4 < 0) ? 100.0 + (total4 - total3)*100/total4 : (total3/total4)*100; if (isNaN(rt2)) rt2 = 0.0;
						rt3 = (total3/total5)*100; if (isNaN(rt3)) rt3 = 0.0;
						html += '<tr>';
						html += '    <td class="text-center" style="border-right:2px solid black!important;"><a data-toggle="modal" href="#popReport2" style="color:inherit;">'+pValue.amt_ty_nm+'</a></td>';
						html += '    <td class="text-center colorSky" style="border-right:2px solid black!important;">계</td>';
                        html += '    <td class="text-number colorSky">'+total2.toString().toFormat('NUMBER')+'</td>';
                        html += '    <td class="text-number colorSky">'+total1.toString().toFormat('NUMBER')+'</td>';
                        html += '    <td class="text-number colorSky" style="border-right:2px solid black!important;">'+((rt1 == Infinity)? '' : (rt1.toFixed(1)+'%'))+'</td>';
                        html += '    <td class="text-number colorSky">'+total4.toString().toFormat('NUMBER')+'</td>';
                        html += '    <td class="text-number colorSky">'+total3.toString().toFormat('NUMBER')+'</td>';
                        html += '    <td class="text-number colorSky" style="border-right:2px solid black!important;">'+((rt2 == Infinity)? '' : (rt2.toFixed(1)+'%'))+'</td>';
                        html += '    <td class="text-number colorSky" id="suju_rates'+pValue.amt_ty_code+'">'+total5.toString().toFormat('NUMBER')+'</td>';
                        html += '    <td class="text-number colorSky" style="border-right:2px solid black!important;">'+((rt3 == Infinity)? '' : (rt3.toFixed(1)+'%'))+'</td>';
                        html += '    <td class="text-number colorSky"></td>';
                        html += '</tr>';
						total1 = 0, total2 = 0, total3 = 0, total4 = 0, total5 = 0;
					}
				} else if (pValue.amt_ty_code == '3' || pValue.amt_ty_code == '5') { // 매출, VA
                    b_amt1 = parseInt(pValue.m_contract_amount); if(isNaN(b_amt1)) b_amt1 = 0;
                    b_amt2 = parseInt(pValue['m'+parseInt(pxcond_mt_arr[1])]); if(isNaN(b_amt2)) b_amt2 = 0;
                    b_amt3 = parseInt(pValue.y_contract_amount); if(isNaN(b_amt3)) b_amt3 = 0;
                    b_amt4 = 0; for(i=1; i<=month; i++) { b_amt4 += isNaN(parseInt(pValue['m'+i]))?0:parseInt(pValue['m'+i]); } if(isNaN(b_amt4)) b_amt4 = 0;
                    b_amt5 = 0; for(i=1; i<=12; i++) { b_amt5 += isNaN(parseInt(pValue['m'+i]))?0:parseInt(pValue['m'+i]); } if(isNaN(b_amt5)) b_amt5 = 0;
                    var link_start = '<a data-toggle="modal" href="#popReport'+pValue.amt_ty_code+'" style="color:inherit;">';
                    var link_end = '</a>';

					//장려금 합산
					j_amt1 = parseInt(pValue.ty9_goal_amount); if(isNaN(j_amt1)) j_amt1 = 0;
                    j_amt2 = parseInt(pValue.ty8_goal_amount); if(isNaN(j_amt2)) j_amt2 = 0;
                    j_amt3 = parseInt(pValue.ty9_goal_amount_sum); if(isNaN(j_amt3)) j_amt3 = 0;
                    j_amt4 = parseInt(pValue.ty8_goal_amount_sum); if(isNaN(j_amt4)) j_amt4 = 0;
                    j_amt5 = parseInt(pValue.ty8_goal_amount_total); if(isNaN(j_amt5)) j_amt5 = 0;

					html += '<tr class="'+pValue.dept_code+'">';
					html += '    <td class="text-center colorSky" style="vertical-align:middle;border-right:2px solid black!important;">'+link_start+pValue.amt_ty_nm+link_end+'</td>';
					html += '    <td class="text-center" style="border-right:2px solid black!important;">'+pValue.dept_nm+'</td>';
					html += '    <td class="text-number">'+(b_amt2 + j_amt2).toString().toFormat('NUMBER')+'</td>';
					html += '    <td class="text-number">'+(b_amt1 + j_amt1).toString().toFormat('NUMBER')+'</td>';
					html += '    <td class="text-number" style="border-right:2px solid black!important;"></td>';
					html += '    <td class="text-number">'+(b_amt4 + j_amt4).toString().toFormat('NUMBER')+'</td>';
					html += '    <td class="text-number">'+(b_amt3 + j_amt3).toString().toFormat('NUMBER')+'</td>';
					html += '    <td class="text-number" style="border-right:2px solid black!important;"></td>';
					html += '    <td class="text-number">'+(b_amt5 + j_amt5).toString().toFormat('NUMBER')+'</td>';
					html += '    <td class="text-number" style="border-right:2px solid black!important;"></td>';
                    html += '    <td class="text-number '+pValue.dept_code+'"></td>';
					html += '</tr>';
					// 장려금금
					// html += '<tr>';
					// html += '    <td class="text-center" style="border-right:2px solid black!important;">'+link_start+pValue.amt_ty_nm+link_end+'</td>';
					// html += '    <td class="text-center" style="border-right:2px solid black!important;">장려금</td>';
					// html += '    <td class="text-number">'+j_amt2.toString().toFormat('NUMBER')+'</td>';
					// html += '    <td class="text-number">'+j_amt1.toString().toFormat('NUMBER')+'</td>';
					// html += '    <td class="text-number" style="border-right:2px solid black!important;"></td>';
					// html += '    <td class="text-number">'+j_amt4.toString().toFormat('NUMBER')+'</td>';
					// html += '    <td class="text-number">'+j_amt3.toString().toFormat('NUMBER')+'</td>';
					// html += '    <td class="text-number" style="border-right:2px solid black!important;"></td>';
					// html += '    <td class="text-number">'+j_amt5.toString().toFormat('NUMBER')+'</td>';
					// html += '    <td class="text-number" style="border-right:2px solid black!important;"></td>';
					// html += '    <td class="text-number '+pValue.dept_code+'"></td>';
					// html += '</tr>';
					// 소계
					t_amt1 = parseInt(b_amt1) + parseInt(j_amt1);
					t_amt2 = parseInt(b_amt2) + parseInt(j_amt2);
					t_amt3 = parseInt(b_amt3) + parseInt(j_amt3);
					t_amt4 = parseInt(b_amt4) + parseInt(j_amt4);
					t_amt5 = parseInt(b_amt5) + parseInt(j_amt5);
					rt1 = (t_amt2 < 0) ? 100.0 + (t_amt2 - t_amt1)*100/t_amt2 : (t_amt1/t_amt2)*100; if (isNaN(rt1)) rt1 = 0.0;
					rt2 = (t_amt4 < 0) ? 100.0 + (t_amt4 - t_amt3)*100/t_amt4 : (t_amt3/t_amt4)*100; if (isNaN(rt2)) rt2 = 0.0;
					rt3 = (t_amt3/t_amt5)*100; if (isNaN(rt3)) rt3 = 0.0;

					// 합계처리
                    if(pValue.dept_code !== 'ST' ) {
                        total1 += parseInt(t_amt1);
                        total2 += parseInt(t_amt2);
                        total3 += parseInt(t_amt3);
                        total4 += parseInt(t_amt4);
                        total5 += parseInt(t_amt5);
                    }
					if ((pIndex+1)%pValue.dept_count == 0) {
						rt1 =  (total2 < 0) ? 100.0 + (total2 - total1)*100/total2 : (total1/total2)*100; if (isNaN(rt1)) rt1 = 0.0;
						rt2 =  (total4 < 0) ? 100.0 + (total4 - total3)*100/total4 : (total3/total4)*100; if (isNaN(rt2)) rt2 = 0.0;
						rt3 = (total3/total5)*100; if (isNaN(rt3)) rt3 = 0.0;
						html += '<tr>';
						html += '    <td class="text-center" style="border-right:2px solid black!important;">'+link_start+pValue.amt_ty_nm+link_end+'</td>';
						html += '    <td class="text-center colorSky" style="border-right:2px solid black!important;">계</td>';
                        html += '    <td class="text-number colorSky">'+total2.toString().toFormat('NUMBER')+'</td>';
                        html += '    <td class="text-number colorSky">'+total1.toString().toFormat('NUMBER')+'</td>';
                        html += '    <td class="text-number colorSky" style="border-right:2px solid black!important;">'+((rt1 == Infinity)? '' : (rt1.toFixed(1) + '%'))+'</td>';
                        html += '    <td class="text-number colorSky">'+total4.toString().toFormat('NUMBER')+'</td>';
                        html += '    <td class="text-number colorSky">'+total3.toString().toFormat('NUMBER')+'</td>';
                        html += '    <td class="text-number colorSky" style="border-right:2px solid black!important;">'+((rt2 == Infinity)? '' : (rt2.toFixed(1) + '%'))+'</td>';
                        html += '    <td class="text-number colorSky" id="suju_rates'+pValue.amt_ty_code+'">'+total5.toString().toFormat('NUMBER')+'</td>';
                        html += '    <td class="text-number colorSky" style="border-right:2px solid black!important;">'+((rt3 == Infinity)? '' : (rt3.toFixed(1)+'%'))+'</td>';
                        html += '    <td class="text-number colorSky"></td>';
                        html += '</tr>';
						total1 = 0, total2 = 0, total3 = 0, total4 = 0, total5 = 0;
					}
				}
			});
			$('#content').find('#rptContractStatus tbody[role=body]').html(html);
			$('#content').find('#rptContractStatus tbody[role=body] td.ST').parent().remove();
            var rates = $('#content').find('#rptContractStatus tbody[role=body]').find(".total-rates");
            $.each(rates, function(pIndex, pValue){
                var tot_rates = parseInt($(document).find('#'+$(pValue).data("target")).html().replaceAll(",", ""));
                if(isNaN(tot_rates)) tot_rates = 0.0;
                var v = $(pValue).data("amount");
                $(pValue).html((parseInt(v)*100.0 / tot_rates).toFixed(1)+'%');
            });

			$('#content').find('#rptContractStatus tbody[role=body]').yRowspan(0);
			var cells = $('#content').find('#rptContractStatus tbody[role=body] td, #rptContractStatus tbody[role=body] th');
            $.each(cells, function(pIndex, pValue){
                let value = $(pValue).html();
                if(value == '0' || value == '0.0%' || value=='-Infinity%' || value=='Infinity%'){

                    $(pValue).html('');
                }
            });
		}
	});
}
/******************************************************************************
 * 현장담당자별 BiSS지적현황
 */
getBissSummery = function()
{
	$.ajax({
		url: '/api/dashboard/ajax_get_biss_state',
		type: 'GET',
		data: '',
		dataType: 'json',
		contentType: false,
		processData: false,
		validate: function() {
			return true;
		},
		success: function(pResult) {
			if (pResult.status) {
                console.log(pResult);

				var html = '';
				var cntrct_sum = 0, flaw_sum = 0, ct_sum = 0, n_sum = 0, k_sum = 0, s_sum=0, before='';
                var k_cnts = {};
                $.each(pResult.data, function(pIndex, pValue){
                    if(!k_cnts.hasOwnProperty(pValue.mber_sn)){
                        k_cnts[pValue.mber_sn] = 0;
                    }
                    var rate = pValue.rate == '' ? 0.0 : parseFloat(pValue.rate);
                    if(rate == 0.0)
                        k_cnts[pValue.mber_sn]++;
                });
                var small_tot = [0, 0, 0, 0, 0, 0, 0, 0, 0];
                var flag = false;
				$.each(pResult.list, function(pIndex, pValue){
					var bgColor = '';
					if (pValue.mber_nm == '총계') {
						bgColor = 'colorSky';
					}
                    if((parseInt(pValue.cntrct_cnt) != 0 || parseInt(pValue.ct_cnt) != 0)){
                        if(pValue.dept_code[0] != 'T' && pValue.dept_code[0] != 'P' && !flag){

                            html += '<tr>';
                            html += '    <td class="colorSky " style="vertical-align:middle;" colspan="2">공조팀 계</td>';
                            html += '    <td class="text-center colorSky " style="vertical-align:middle;">'+small_tot[0]+'</td>';
                            html += '    <td class="text-center colorSky " style="vertical-align:middle;">'+small_tot[1]+'</td>';
                            html += '    <td class="text-center colorSky " style="vertical-align:middle;">'+small_tot[2]+'</td>';
                            html += '    <td class="text-center colorSky " style="vertical-align:middle;">'+small_tot[3]+'</td>';
                            html += '    <td class="text-center colorSky " style="vertical-align:middle;">'+small_tot[4]+'</td>';
                            html += '    <td class="text-center colorSky " style="vertical-align:middle;">'+small_tot[5]+'</td>';
                            html += '    <td class="text-center colorSky " style="vertical-align:middle;">'+small_tot[6]+'</td>';
                            html += '    <td class="text-center colorSky " style="vertical-align:middle;" colspan="2"></td>';
                            html += '    <td class="text-center colorSky " style="vertical-align:middle;">'+small_tot[7]+'</td>';
                            html += '    <td class="text-center colorSky " style="vertical-align:middle;">'+small_tot[8]+'</td>';
                            html += '</tr>';
                            small_tot = [0, 0, 0, 0, 0, 0, 0, 0, 0];
                            flag = true;
                        }

                        var k_cnt = k_cnts.hasOwnProperty(pValue.mber_sn) ? k_cnts[pValue.mber_sn] : 0;
                        var s = parseInt(pValue.ct_cnt) + parseInt(pValue.cntrct_cnt) + parseInt(pValue.n_cnt) + parseInt(pValue.s_cnt);
                        html += '<tr>';
                        html += '    <td class="colorSky '+bgColor+'" style="vertical-align:middle;"><a style="color:inherit;" class="btnDept" data-code="'+pValue.dept_code+'">'+pValue.dept_nm+'</a></td>';
                        html += '    <td class="colorSky '+bgColor+'" style="vertical-align:middle;"><a style="color:inherit;" class="btnMber" data-code="'+pValue.mber_sn+'" data-dept="'+pValue.dept_code+'">'+pValue.mber_nm+'</a></td>';
                        html += '    <td class="colorSky '+bgColor+'" style="vertical-align:middle;" data-code="'+pValue.mber_sn+'">'+pValue.mber_size+'<div class="sr-only">'+pValue.mber_sn+'</div></td>';
                        html += '    <td class="text-center '+bgColor+'" style="vertical-align:middle;">'+(parseInt(pValue.cntrct_cnt)-k_cnt).toString().toFormat('NUMBER')+'<div class="sr-only">'+pValue.mber_sn+'</div></td>';
                        html += '    <td class="text-center '+bgColor+'" style="vertical-align:middle;">'+k_cnt.toString().toFormat('NUMBER')+'<div class="sr-only">'+pValue.mber_sn+'</div></td>';

                        html += '    <td class="text-center '+bgColor+'" style="vertical-align:middle;">'+pValue.ct_cnt.toString().toFormat('NUMBER')+'<div class="sr-only">'+pValue.mber_sn+'</div></td>';
                        html += '    <td class="text-center '+bgColor+'" style="vertical-align:middle;">'+pValue.n_cnt.toString().toFormat('NUMBER')+'<div class="sr-only">'+pValue.mber_sn+'</div></td>';
                        html += '    <td class="text-center '+bgColor+'" style="vertical-align:middle;">'+pValue.s_cnt.toString().toFormat('NUMBER')+'<div class="sr-only">'+pValue.mber_sn+'</div></td>';
                        html += '    <td class="text-center '+bgColor+'" style="vertical-align:middle;border-right:2px solid black!important;">'+s.toString().toFormat('NUMBER')+'<div class="sr-only">'+pValue.mber_sn+'</div></td>';
                        html += '    <td class="text-center '+bgColor+'" style="border-right:2px solid black!important;">'+pValue.bcnc_nm+'</td>';
                        html += '    <td class="text-left '+bgColor+'">'+pValue.spt_nm+'</td>';
                        html += '    <td class="text-center '+bgColor+'">'+pValue.flaw_co.toString().toFormat('NUMBER')+'</td>';
                        html += '    <td class="text-center '+bgColor+'" style="vertical-align:middle;">'+pValue.flaw_cnt.toString().toFormat('NUMBER')+'<div class="sr-only">'+pValue.mber_sn+'</div></td>';
                        html += '</tr>';
                        if(before != pValue.mber_sn){
                            cntrct_sum += parseInt(pValue.cntrct_cnt)-k_cnt;
                            ct_sum += parseInt(pValue.ct_cnt);
                            flaw_sum += parseInt(pValue.flaw_cnt);
                            n_sum += parseInt(pValue.n_cnt);
                            s_sum += parseInt(pValue.s_cnt);
                            k_sum += k_cnt;
                            before = pValue.mber_sn;
                            small_tot[0] += parseInt(pValue.mber_size);
                            small_tot[1] += (parseInt(pValue.cntrct_cnt)-k_cnt);
                            small_tot[2] += k_cnt;
                            small_tot[3] += parseInt(pValue.ct_cnt);
                            small_tot[4] += parseInt(pValue.n_cnt);
                            small_tot[5] += parseInt(pValue.s_cnt);
                            small_tot[6] += s;
                        }
                        small_tot[7] += parseInt(pValue.flaw_co == '' ? 0 : pValue.flaw_co);
                        small_tot[8] += parseInt(pValue.flaw_co == '' ? 0 : pValue.flaw_co);
                    }
				});
                html += '<tr>';
                html += '    <td class="colorSky " style="vertical-align:middle;" colspan="2">빌트인 계</td>';
                html += '    <td class="text-center colorSky " style="vertical-align:middle;">'+small_tot[0]+'</td>';
                html += '    <td class="text-center colorSky " style="vertical-align:middle;">'+small_tot[1]+'</td>';
                html += '    <td class="text-center colorSky " style="vertical-align:middle;">'+small_tot[2]+'</td>';
                html += '    <td class="text-center colorSky " style="vertical-align:middle;">'+small_tot[3]+'</td>';
                html += '    <td class="text-center colorSky " style="vertical-align:middle;">'+small_tot[4]+'</td>';
                html += '    <td class="text-center colorSky " style="vertical-align:middle;">'+small_tot[5]+'</td>';
                html += '    <td class="text-center colorSky " style="vertical-align:middle;border-right:2px solid black!important;">'+small_tot[6]+'</td>';
                html += '    <td class="text-center colorSky " style="vertical-align:middle;" colspan="2"></td>';
                html += '    <td class="text-center colorSky " style="vertical-align:middle;">'+small_tot[7]+'</td>';
                html += '    <td class="text-center colorSky " style="vertical-align:middle;">'+small_tot[8]+'</td>';
                html += '</tr>';

				$('#rptBissSummery tbody[role=body]').html(html);
				$('#rptBissSummery tbody[role=body]').yRowspan(0);
				$('#rptBissSummery tbody[role=body]').yRowspan(1);
				$('#rptBissSummery tbody[role=body]').yRowspan(2);
				$('#rptBissSummery tbody[role=body]').yRowspan(3);
				$('#rptBissSummery tbody[role=body]').yRowspan(4);
				$('#rptBissSummery tbody[role=body]').yRowspan(5);
				$('#rptBissSummery tbody[role=body]').yRowspan(6);
//				$('#rptBissSummery tbody[role=body]').yRowspan(5);
//				$('#rptBissSummery tbody[role=body]').yRowspan(9);
				$('#rptBissSummery tbody[role=body]').yRowspan(7);
				$('#rptBissSummery tbody[role=body]').yRowspan(8);
				$('#rptBissSummery tbody[role=body]').yRowspan(12);

				$('#rptBissSummery tbody[role=foot]').find('th').eq(1).html(cntrct_sum);
				$('#rptBissSummery tbody[role=foot]').find('th').eq(2).html(k_sum);
				$('#rptBissSummery tbody[role=foot]').find('th').eq(3).html(ct_sum);
				$('#rptBissSummery tbody[role=foot]').find('th').eq(4).html(n_sum);
				$('#rptBissSummery tbody[role=foot]').find('th').eq(5).html(s_sum);
//				$('#rptBissSummery tbody[role=foot]').find('th').eq(6).html(flaw_sum);
//				$('#rptBissSummery tbody[role=foot]').find('th').eq(7).html(flaw_sum);
				$('#rptBissSummery tbody[role=foot]').find('th').eq(6).html(cntrct_sum + ct_sum + n_sum + k_sum + s_sum);
				$('#rptBissSummery tbody[role=foot]').find('th').eq(8).html(flaw_sum);
				$('#rptBissSummery tbody[role=foot]').find('th').eq(9).html(flaw_sum);
                var cells = $('#rptBissSummery tbody[role=body] td, #rptBissSummery tbody[role=body] th');
                $.each(cells, function(pIndex, pValue){
                    let value = $(pValue).clone().children().remove().end().text();
                    if(value == '0' || value == '0.0%' || value=='-Infinity%' || value=='Infinity%'){

                        $(pValue).html('');
                    }
                });
			}
		}
	});
};

/******************************************************************************
 * 외상미수금
 */
getSalesExpectReport = function(){
	var params = '';
	$.ajax({
		url: '/api/sales/ajax_get_sales_expect_report',
		type: 'GET',
		data: params,
		timeout: 7200000,
		async: false,
		dataType: 'json',
		success: function (pTable) {
			console.log(pTable.longTermData);
			var keys = [-1, 0, 1, 2];
			var pkeys = [-1, 0];
			/* summary start */
			var html = '';
			var _class = "colorW";
			$.each(pTable.longTermData, function(pIndex, pValue){
				var color3 = $.dateDiff(pValue.rcppay_de) <= 3.0 ? ' colorButton' : ' ';
				html += `<tr class="${_class}">`;
				html += '    <td class=""><span data-cntrct="'+pValue.cntrct_sn+'" data-sn="'+pValue.taxbil_sn+'"></span>'+pValue.dlivy_de+'</td>';
				html += '    <td class=""><span data-cntrct="'+pValue.cntrct_sn+'" data-sn="'+pValue.taxbil_sn+'"></span>'+pValue.bcnc_nm+'</td>';
				html += '    <td class=""><span data-cntrct="'+pValue.cntrct_sn+'" data-sn="'+pValue.taxbil_sn+'"></span>'+pValue.cntrct_nm+'</td>';
				html += '    <td class=""><span data-cntrct="'+pValue.cntrct_sn+'" data-sn="'+pValue.taxbil_sn+'"></span>'+pValue.dept_nm+'</td>';
				html += '    <td class="text-number">'+pValue.price_1.toString().toFormat('NUMBER')+'</td>';
				html += '    <td class="text-number">'+pValue.price_2.toString().toFormat('NUMBER')+'</td>';
				html += '    <td class="text-number"><span data-cntrct="'+pValue.cntrct_sn+'" data-sn="'+pValue.taxbil_sn+'"></span>'+pValue.price_3.toString().toFormat('NUMBER')+'</td>';
				html += '    <td class="text-number"><span data-cntrct="'+pValue.cntrct_sn+'" data-sn="'+pValue.taxbil_sn+'"></span>'+pValue.price_sum.toString().toFormat('NUMBER')+'</td>';
				html += '    <td class="text-number"><span data-cntrct="'+pValue.cntrct_sn+'" data-sn="'+pValue.taxbil_sn+'"></span>'+pValue.price_4.toString().toFormat('NUMBER')+'</td>';
				html += '    <td class=""><span data-cntrct="'+pValue.cntrct_sn+'" data-sn="'+pValue.taxbil_sn+'"></span>'+ ((pValue.taxbil_sn == '') ? '' : (pValue.delng_se_nm.match(/\(([^)]+)\)/g) == null ? '매출' : pValue.delng_se_nm.match(/\(([^)]+)\)/g)[0].replaceAll("(", "").replaceAll(")", "")))+'</td>';
				html += '    <td class=""><span data-cntrct="'+pValue.cntrct_sn+'" data-sn="'+pValue.taxbil_sn+'"></span>'+pValue.expect_de.substr(2,5)+'</td>';
				html += '    <td class="'+color3+'">'+pValue.rcppay_de.substr(2,8)+'</td>';
				html += '    <td class="text-number '+color3+'">'+pValue.rcppay_amount.toString().toFormat('NUMBER')+'</td>';
				html += '    <td class="text-number"><span data-cntrct="'+pValue.cntrct_sn+'" data-sn="'+pValue.taxbil_sn+'">'+pValue.diff.toString().toFormat('NUMBER')+'</td>';
				html += '</tr>';
			});
			$(document).find(`#rcppay_status_summary`).find("tbody[role='body']").html(html);
			$(document).find(`#rcppay_status_summary`).find("tbody[role='body']").yRowspan(0);
			$(document).find(`#rcppay_status_summary`).find("tbody[role='body']").yRowspan(1);
			$(document).find(`#rcppay_status_summary`).find("tbody[role='body']").yRowspan(2);
			$(document).find(`#rcppay_status_summary`).find("tbody[role='body']").yRowspan(3);
			$(document).find(`#rcppay_status_summary`).find("tbody[role='body']").yRowspan(7);
			$(document).find(`#rcppay_status_summary`).find("tbody[role='body']").yRowspan(8);
			$(document).find(`#rcppay_status_summary`).find("tbody[role='body']").yRowspan(9);
			$(document).find(`#rcppay_status_summary`).find("tbody[role='body']").yRowspan(10);
			$(document).find(`#rcppay_status_summary`).find("tbody[role='body']").yRowspan(13);
			var prices = $(document).find(`#rcppay_status_summary`).find("tbody[role='body']").find("tr").calculation(4, 8);
			var rPrices = $(document).find(`#rcppay_status_summary`).find("tbody[role='body']").find("tr").calculation(12, 13);
			$(document).find(`#rcppay_status_summary`).find("tfoot").find("th").eq(1).html(prices[0].toFormat('NUMBER'));
			$(document).find(`#rcppay_status_summary`).find("tfoot").find("th").eq(2).html(prices[1].toFormat('NUMBER'));
			$(document).find(`#rcppay_status_summary`).find("tfoot").find("th").eq(3).html(prices[2].toFormat('NUMBER'));
			$(document).find(`#rcppay_status_summary`).find("tfoot").find("th").eq(4).html(prices[3].toFormat('NUMBER'));
			$(document).find(`#rcppay_status_summary`).find("tfoot").find("th").eq(5).html(prices[4].toFormat('NUMBER'));
			$(document).find(`#rcppay_status_summary`).find("tfoot").find("th").eq(8).html(rPrices[0].toFormat('NUMBER'));
			$(document).find(`#rcppay_status_summary`).find("tfoot").find("th").eq(9).html(rPrices[1].toFormat('NUMBER'));
			$(document).find(`#rcppay_status_summary`).find("tfoot").find("th").eq(6).html((prices[3]-rPrices[0]).toFormat('NUMBER'));
			$("#myContentSummary").show();

			/* summary end */


		}
	});

}



/******************************************************************************
 * 장비/자재 매입 현황
 */
getSales = function(pResult, label, dept)
{
    var result = 0;
    $.each(pResult, function(pIndex, pValue){
       if(pValue.label == label && pValue.bsn_dept_nm == dept){
        result += parseInt(pValue.p_month);
       }
    });
    return result;
}

getSalesSummary = function(s_pxcond_mt)
{
    var params = '';
	params += '&s_pxcond_mt='+s_pxcond_mt;
	$.ajax({
		url: '/api/dashboard/ajax_get_sales_summary',
		type: 'GET',
		data: params,
		dataType: 'json',
		contentType: false,
		processData: false,
		validate: function() {
			return true;
		},
		success: function(pResult) {
			if (pResult.status) {
                console.log("sales", pResult);
				var html = '';

                var bcncs = [];
                var depts = [];
                $.each(pResult.one, function(pIndex, pValue){
                   bcncs.push(pValue.label);
                    if(pValue.bsn_dept_nm != ''){
                        depts.push(pValue.bsn_dept_nm);
                    }
                });
                bcncs = bcncs.reduce(function(a,b){
                       if (a.indexOf(b) < 0 ) a.push(b);
                       return a;
                    },[]);
				bcncs.sort((a,b) => {
					if(a.includes("자재") && b.includes("자재")){
						if(a.includes("타사")){
							return 1;
						}
						else if(b.includes("타사")) {
							return -1;
						}
						else{
							return a.localeCompare(b);
						}
					}
					else if(a.includes("자재")){
						return 1;
					}
					else if(b.includes("자재")){
						return -1;
					}
					else{
						if(a.includes("타사")){
							return 1;
						}
						else if(b.includes("타사")) {
							return -1;
						}
						else{
							return a.localeCompare(b);
						}
					}
				});
                depts = depts.reduce(function(a,b){
                       if (a.indexOf(b) < 0 ) a.push(b);
                       return a;
                    },[]);

                sales = {};
                var prices = [];
                $.each(depts, function(p, q){
                    prices.push(0);
                });
                prices.push(0);
                $.each(bcncs, function(pIndex, pValue){
                    var row = '';
                    row += '<tr>';
                    var sum = 0;
                    row += '  <td class="colorSky">'+pValue+'</td>';
                    $.each(depts, function(p, q){
                       let price = getSales(pResult.one, pValue, q);
                       row += '  <td>'+price.toString().toFormat('NUMBER')+'</td>';
                       sum += parseInt(price);

                        prices[p] += parseInt(price);
                    });
                    row += '  <td>'+sum.toString().toFormat('NUMBER')+'</td>';
                    row += '</tr>';
                    prices[depts.length] += sum;
                    if(sum != 0){
                        sales[sum] = row;
                    }
					html += row;
                });
                // $.each(sales, function(key, value){
                //     if(key > 0){
                //         html = value + html;
                //     }
                // });
                // $.each(sales, function(key, value){
                //     if(key < 0){
                //         html = html + value;
                //     }
                // });

                var table = '';
                table += '<colgroup>';
                table += '	<col width="200">';
                $.each(depts, function(key, value){
                    table += '	<col width="110">';
                });
                table += '	<col width="110">';
                table += '</colgroup>';
                table += '<tbody role="header">';
                table += '	<tr>';
                table += '		<th class="colorB">'+s_pxcond_mt.split("-")[1]+'월 매입처</th>';
                $.each(depts, function(key, value){
                    table += '  <th class="colorB">'+value+'</th>';
                });
                table += '      <th class="colorB">누계</th>';
                table += '	</tr>';
                table += '</tbody>';
                table += '<tbody role="body">';
                table += '</tbody>';
                table += '<tbody role="footer">';
                table += '</tbody>';
                $('#rptSalesSummery').html(table);


                $('#rptSalesSummery tbody[role=body]').html(html);
                html = '';
                html += '<tr>';
                html += '    <td class="colorSky">총계</td>';
                $.each(prices, function(k, v){
                    html += '<td class="colorSky">'+v.toString().toFormat('NUMBER')+'</td>';
                });
                html += '</tr>';
                $('#rptSalesSummery tbody[role=footer]').html(html);


                //console.log(sales);
//				html = '';
//                $.each(pResult.list, function(pIndex, pValue){
//					var bgColor = '';
//					if (pValue.label == '총계') {
//						bgColor = 'colorSky';
//					}
//					html += '<tr>';
//					html += '    <td class="colorLG '+bgColor+'">'+pValue.label+'</td>';
//					html += '    <td class="text-number '+bgColor+'">'+pValue.p_month01.toString().toFormat('NUMBER')+'</td>';
//					html += '    <td class="text-number '+bgColor+'">'+pValue.p_month02.toString().toFormat('NUMBER')+'</td>';
//					html += '    <td class="text-number '+bgColor+'">'+pValue.p_month03.toString().toFormat('NUMBER')+'</td>';
//					html += '    <td class="text-number '+bgColor+'">'+pValue.p_month04.toString().toFormat('NUMBER')+'</td>';
//					html += '    <td class="text-number '+bgColor+'">'+pValue.p_month05.toString().toFormat('NUMBER')+'</td>';
//					html += '    <td class="text-number '+bgColor+'">'+pValue.p_month06.toString().toFormat('NUMBER')+'</td>';
//					html += '    <td class="text-number '+bgColor+'">'+pValue.p_month07.toString().toFormat('NUMBER')+'</td>';
//					html += '    <td class="text-number '+bgColor+'">'+pValue.p_month08.toString().toFormat('NUMBER')+'</td>';
//					html += '    <td class="text-number '+bgColor+'">'+pValue.p_month09.toString().toFormat('NUMBER')+'</td>';
//					html += '    <td class="text-number '+bgColor+'">'+pValue.p_month10.toString().toFormat('NUMBER')+'</td>';
//					html += '    <td class="text-number '+bgColor+'">'+pValue.p_month11.toString().toFormat('NUMBER')+'</td>';
//					html += '    <td class="text-number '+bgColor+'">'+pValue.p_month12.toString().toFormat('NUMBER')+'</td>';
//					html += '    <td class="text-number '+bgColor+'">'+pValue.p_month99.toString().toFormat('NUMBER')+'</td>';
//					html += '</tr>';
//				});
//				$('#rptSalesSummery tbody[role=body]').html(html);
			}
		}
	});
};

$('#rptBissSummery').on('click', '.btnMber', function(pEvent) {
    var code = $(this).data('code');
    var dept_code = $(this).data('dept');
    console.log($('#s_pxcond_mt').val().substr(0,4));
    //getBcnc($('#s_pxcond_mt').val().substr(0,4));
    getProjectsByDeptMember(code, dept_code);
});
$('#rptBissSummery').on('click', '.btnDept', function(pEvent) {
    var code = $(this).data('code');
    getProjectsByDeptMember('', code);
});


</script>

<!-- popReport99 : 영업점검 -->
<div class="modal fade" data-backdrop="static" id="popReport99">
    <div class="modal-dialog modal-w1200" style="width:100%!important;">
        <div class="modal-content">
			<div class="modal-header">
				<div class="pull-right" style="margin-right:10px;">
					<input type="text" class="form-control datepicker-s" style="display:inline-block;width:89px!important;padding-top:5px!important;" readonly data-dateformat="yy-mm-dd" data-mask="9999-99-99" data-mask-placeholder="_" id="report99_pxcond_mt" name="report99_pxcond_mt" placeholder="[기준일자]">
					<button type="button" class="btn btn-primary" id="btnPrint99"><i class="fa fa-print">&nbsp;출력</i></button>
					<button type="button" class="btn btn-default" aria-hidden="true" data-dismiss="modal"><i class="fa fa-times">&nbsp;취소</i></button>
				</div>
			</div>
			<div class="modal-body report">
				<style>
					#rpt99detail{
						max-height:640px!important;
						overflow-y:auto;
					}
					h5[data-usage='toggle']{
						position:relative;
						cursor:pointer;
					}
					.arrow-up::after{
						position:absolute;
						right:0px;
						content: "접기";
						font-size:5px!important;
						font-weight:normal!important;
					}
					.arrow-down::after{
						position:absolute;
						right:0px;
						content: "펼치기";
						font-size:5px!important;
						font-weight:normal!important;
					}
				</style>
				<div id="rpt99">
				<div class="title"><h2 class="colorLS"></h2></div>

				<!-- 기성 현황 시작 -->
				<table id="top-summary" class="table table-bordered w100p">
					 <colgroup>
						<col width="50">
						<col width="75">
						<col width="100">
						<col width="100">
						<col width="100">
						<col width="100">
						<col width="100">
						<col width="100">
						<col width="100">
						<col width="100">
						<col width="100">
						<col width="100">

						<col width="50">
						<col width="75">
						<col width="100">
						<col width="100">
						<col width="100">
						<col width="100">
						<col width="100">
						<col width="100">
						<col width="100">
						<col width="100">
						<col width="100">
						<col width="100">
					</colgroup>
					<tbody role="header">
						<tr>
							<th class="colorB" style="line-height: 1.0!important;font-size:15px!important;" colspan="12"><span class="two-now-year"></span>년 <span class="one-now-month"></span>월 수주 현황</th>
							<th class="colorB" style="line-height: 1.0!important;font-size:15px!important;" colspan="12"><span class="two-now-year"></span>년 <span class="one-now-month"></span>월 매출 현황</th>
						</tr>
						<tr>
							<th class="colorB middle text-center" rowspan="2">구분</th>
							<th class="colorB middle text-center" rowspan="2">부서</th>
							<th class="colorB middle text-center" colspan="4"><span class="two-now-year"></span>.<span class="one-now-month"></span>월</th>
							<th class="colorB middle text-center" colspan="4"><span class="two-now-year"></span>.<span class="one-now-month"></span> 누계</th>
							<th class="colorB middle text-center" rowspan="2">연간목표</th>
							<th class="colorB middle text-center" rowspan="2">연 달성(%)</th>

							<th class="colorB middle text-center" rowspan="2">구분</th>
							<th class="colorB middle text-center" rowspan="2">부서</th>
							<th class="colorB middle text-center" colspan="4"><span class="two-now-year"></span>.<span class="one-now-month"></span>월</th>
							<th class="colorB middle text-center" colspan="4"><span class="two-now-year"></span>.<span class="one-now-month"></span> 누계</th>
							<th class="colorB middle text-center" rowspan="2">연간목표</th>
							<th class="colorB middle text-center" rowspan="2">연 달성(%)</th>
						</tr>
						<tr>
							<th class="colorB middle text-center">경영목표</th>
							<th class="colorB middle text-center">점검(<span class="one-now-month"></span>/<span class="one-now-day"></span>)</th>
							<th class="colorB middle text-center">수주실적</th>
							<th class="colorB middle text-center">달성(%)</th>
							<th class="colorB middle text-center">경영목표</th>
							<th class="colorB middle text-center">수주실적</th>
							<th class="colorB middle text-center">달성(%)</th>
							<th class="colorB middle text-center">차질액</th>
							<th class="colorB middle text-center">경영목표</th>
							<th class="colorB middle text-center">점검(<span class="one-now-month"></span>/<span class="one-now-day"></span>)</th>
							<th class="colorB middle text-center">수주실적</th>
							<th class="colorB middle text-center">달성(%)</th>
							<th class="colorB middle text-center">경영목표</th>
							<th class="colorB middle text-center">수주실적</th>
							<th class="colorB middle text-center">달성(%)</th>
							<th class="colorB middle text-center">차질액</th>
						</tr>
					</tbody>
					<tbody role="body">
					</tbody>
				</table>
				</div><!-- 기성 현황 끝 -->

				<div id="rpt99detail">

				</div>


			</div><!--modal-body-->
        </div><!--modal-content-->
    </div><!--modal-dialog-->
</div><!--modal-->
<script>
getMonthReport = function(pxcond_mt){
	var now_year = pxcond_mt.split("-")[0].substring(2, 4);
	var now_month = parseInt(pxcond_mt.split("-")[1]);
	var now_day = parseInt(pxcond_mt.split("-")[2]);
	var params = '';
	params += '&s_pxcond_mt='+pxcond_mt;
	$.ajax({
		url: '/api/dashboard/ajax_get_month_report',
		type: 'GET',
		data: params,
		dataType: 'json',
		contentType: false,
		processData: false,
		success: function (pResult) {
			console.log("ajax_get_month_report", pResult);
			// ============================================================
			var html = '';
			var pData = {};
			var pDataOrder = [];
			var nameMap = {};
			var rt1 = 0, rt2 = 0, rt3 = 0;
			var b_amt1 = 0, b_amt2 = 0, b_amt3 = 0, b_amt4 = 0, b_amt5 = 0;
			var j_amt1 = 0, j_amt2 = 0, j_amt3 = 0, j_amt4 = 0, j_amt5 = 0;
			var diff = 0;
			var total11 = 0, total12 = 0, total13 = 0, total14 = 0, total15 = 0, total21 = 0, total22 = 0, total23 = 0, total24 = 0, total25 = 0;
			$.each(pResult.contractStatusList, function (pIndex, pValue) {
				var dept_code = pValue.dept_code;
				if (pValue.amt_ty_code == '2') { // 수주
					if (!pDataOrder.includes(dept_code)) pDataOrder.push(dept_code);
					if (!pData.hasOwnProperty(dept_code)) pData[dept_code] = {};
					pData[dept_code][pValue.amt_ty_code] = pValue;
					nameMap[dept_code] = pValue.dept_nm;
				} else if (pValue.amt_ty_code == '3') {
					if (!pDataOrder.includes(dept_code)) pDataOrder.push(dept_code);
					if (!pData.hasOwnProperty(dept_code)) pData[dept_code] = {};
					pData[dept_code][pValue.amt_ty_code] = pValue;
					nameMap[dept_code] = pValue.dept_nm;
				}
			});
			$.each(pDataOrder, function(pIndex, dept_code){
				html += `<tr data-dept="${dept_code}">`;
				var pValue1 = pData[dept_code]['2'];
				b_amt1 = parseInt(pValue1.m_contract_amount); if (isNaN(b_amt1)) b_amt1 = 0;
				b_amt2 = parseInt(pValue1['m' + now_month]); if (isNaN(b_amt2)) b_amt2 = 0;
				b_amt3 = parseInt(pValue1.y_contract_amount); if (isNaN(b_amt3)) b_amt3 = 0;
				b_amt4 = 0; for (let i = 1; i <= now_month; i++) b_amt4 += isNaN(parseInt(pValue1['m' + i])) ? 0 : parseInt(pValue1['m' + i]); if (isNaN(b_amt4)) b_amt4 = 0;
				b_amt5 = 0; for (let i = 1; i <= 12; i++) b_amt5 += isNaN(parseInt(pValue1['m' + i])) ? 0 : parseInt(pValue1['m' + i]); if (isNaN(b_amt5)) b_amt5 = 0;
				rt1 = (b_amt2 < 0) ? 100.0 + (b_amt2 - b_amt1) * 100 / b_amt2 : (b_amt1 / b_amt2) * 100; if (isNaN(rt1)) rt1 = 0.0;
				rt2 = (b_amt4 < 0) ? 100.0 + (b_amt4 - b_amt3) * 100 / b_amt4 : (b_amt3 / b_amt4) * 100; if (isNaN(rt2)) rt2 = 0.0;
				rt3 = (b_amt3 / b_amt5) * 100; if (isNaN(rt3)) rt3 = 0.0;
				diff = Math.round((b_amt3 - b_amt4)/10000);
				total11 += b_amt1;
				total12 += b_amt2;
				total13 += b_amt3;
				total14 += b_amt4;
				total15 += b_amt5;
				html += `	<td class="colorSky text-center middle">${pValue1.amt_ty_nm}</td>
							<td class="colorSky text-center middle">${pValue1.dept_nm.replaceAll("팀", "")}</td>
							<td class="colorLY text-right middle" data-column="summary">${Math.round(b_amt2/10000).toFormat('NUMBER')}</td>
							<td class="colorLY text-right middle" data-column="summary" data-value="valueS"></td>
							<td class="colorLY text-right middle" data-column="summary">${Math.round(b_amt1/10000).toFormat('NUMBER')}</td>
							<td class="colorLY text-right middle" data-column="summary">${((rt1 == Infinity) ? '' : (rt1.toFixed(1) + '%'))}</td>
							<td class="colorLY text-right middle" data-column="summary">${Math.round(b_amt4/10000).toFormat('NUMBER')}</td>
							<td class="colorLY text-right middle" data-column="summary">${Math.round(b_amt3/10000).toFormat('NUMBER')}</td>
							<td class="colorLY text-right middle" data-column="summary">${((rt2 == Infinity) ? '' : (rt2.toFixed(1) + '%'))}</td>
							<td class="colorLY text-right middle ${diff < 0 ? 'color-red' : ''}" data-column="summary">${diff.toFormat('NUMBER')}</td>
							<td class="colorLY text-right middle" data-column="summary">${Math.round(b_amt5/10000).toFormat('NUMBER')}</td>
							<td class="colorLY text-right middle" data-column="summary">${((rt3 == Infinity) ? '' : (rt3.toFixed(1) + '%'))}</td>`;

				var pValue2 = pData[dept_code]['3'];
				b_amt1 = parseInt(pValue2.m_contract_amount); if (isNaN(b_amt1)) b_amt1 = 0;
				b_amt2 = parseInt(pValue2['m' + now_month]); if (isNaN(b_amt2)) b_amt2 = 0;
				b_amt3 = parseInt(pValue2.y_contract_amount); if (isNaN(b_amt3)) b_amt3 = 0;
				b_amt4 = 0; for (let i = 1; i <= now_month; i++) b_amt4 += isNaN(parseInt(pValue2['m' + i])) ? 0 : parseInt(pValue2['m' + i]); if (isNaN(b_amt4)) b_amt4 = 0;
				b_amt5 = 0; for (let i = 1; i <= 12; i++) b_amt5 += isNaN(parseInt(pValue2['m' + i])) ? 0 : parseInt(pValue2['m' + i]); if (isNaN(b_amt5)) b_amt5 = 0;
				j_amt1 = parseInt(pValue2.ty9_goal_amount); if (isNaN(j_amt1)) j_amt1 = 0;
				j_amt2 = parseInt(pValue2.ty8_goal_amount); if (isNaN(j_amt2)) j_amt2 = 0;
				j_amt3 = parseInt(pValue2.ty9_goal_amount_sum); if (isNaN(j_amt3)) j_amt3 = 0;
				j_amt4 = parseInt(pValue2.ty8_goal_amount_sum); if (isNaN(j_amt4)) j_amt4 = 0;
				j_amt5 = parseInt(pValue2.ty8_goal_amount_total); if (isNaN(j_amt5)) j_amt5 = 0;
				b_amt1 += j_amt1;
				b_amt2 += j_amt2;
				b_amt3 += j_amt3;
				b_amt4 += j_amt4;
				b_amt5 += j_amt5;
				rt1 = (b_amt2 < 0) ? 100.0 + (b_amt2 - b_amt1) * 100 / b_amt2 : (b_amt1 / b_amt2) * 100; if (isNaN(rt1)) rt1 = 0.0;
				rt2 = (b_amt4 < 0) ? 100.0 + (b_amt4 - b_amt3) * 100 / b_amt4 : (b_amt3 / b_amt4) * 100; if (isNaN(rt2)) rt2 = 0.0;
				rt3 = (b_amt3 / b_amt5) * 100; if (isNaN(rt3)) rt3 = 0.0;
				total21 += b_amt1;
				total22 += b_amt2;
				total23 += b_amt3;
				total24 += b_amt4;
				total25 += b_amt5;
				html += `	<td class="colorSky text-center middle">${pValue2.amt_ty_nm}</td>
							<td class="colorSky text-center middle">${pValue2.dept_nm.replaceAll("팀", "")}</td>
							<td class="colorLY text-right middle" data-column="summary">${Math.round(b_amt2/10000).toFormat('NUMBER')}</td>
							<td class="colorLY text-right middle" data-column="summary" data-value="valueT"></td>
							<td class="colorLY text-right middle" data-column="summary">${Math.round(b_amt1/10000).toFormat('NUMBER')}</td>
							<td class="colorLY text-right middle" data-column="summary">${((rt1 == Infinity) ? '' : (rt1.toFixed(1) + '%'))}</td>
							<td class="colorLY text-right middle" data-column="summary">${Math.round(b_amt4/10000).toFormat('NUMBER')}</td>
							<td class="colorLY text-right middle" data-column="summary">${Math.round(b_amt3/10000).toFormat('NUMBER')}</td>
							<td class="colorLY text-right middle" data-column="summary">${((rt2 == Infinity) ? '' : (rt2.toFixed(1) + '%'))}</td>
							<td class="colorLY text-right middle ${diff < 0 ? 'color-red' : ''} data-column="summary"">${diff.toFormat('NUMBER')}</td>
							<td class="colorLY text-right middle" data-column="summary">${Math.round(b_amt5/10000).toFormat('NUMBER')}</td>
							<td class="colorLY text-right middle" data-column="summary">${((rt3 == Infinity) ? '' : (rt3.toFixed(1) + '%'))}</td>`;
				html += `</tr>`;

			});
			var rt11 = 0, rt12 = 0, rt13 = 0;
			var rt21 = 0, rt22 = 0, rt23 = 0;
			rt11 = (total12 < 0) ? 100.0 + (total12 - total11) * 100 / total12 : (total11 / total12) * 100; if (isNaN(rt11)) rt11 = 0.0;
			rt12 = (total14 < 0) ? 100.0 + (total14 - total13) * 100 / total14 : (total13 / total14) * 100; if (isNaN(rt12)) rt12 = 0.0;
			rt13 = (total13 / total15) * 100; if (isNaN(rt13)) rt13 = 0.0;
			rt21 = (total22 < 0) ? 100.0 + (total22 - total21) * 100 / total22 : (total21 / total22) * 100; if (isNaN(rt21)) rt21 = 0.0;
			rt22 = (total24 < 0) ? 100.0 + (total24 - total23) * 100 / total24 : (total23 / total24) * 100; if (isNaN(rt22)) rt22 = 0.0;
			rt23 = (total23 / total25) * 100; if (isNaN(rt23)) rt23 = 0.0;

			html += `<tr data-dept="total">
						<td class="colorSky text-center middle">수주</td>
						<td class="colorLG text-center middle">소계</td>
						<td class="colorLG text-right middle">${Math.round(total12 / 10000).toFormat('NUMBER')}</td>
						<td class="colorLG text-right middle" data-value="valueStot"></td>
						<td class="colorLG text-right middle">${Math.round(total11 / 10000).toFormat('NUMBER')}</td>
						<td class="colorLG text-right middle">${((rt11 == Infinity) ? '' : (rt1.toFixed(1) + '%'))}</td>
						<td class="colorLG text-right middle">${Math.round(total14 / 10000).toFormat('NUMBER')}</td>
						<td class="colorLG text-right middle">${Math.round(total13 / 10000).toFormat('NUMBER')}</td>
						<td class="colorLG text-right middle">${((rt12 == Infinity) ? '' : (rt2.toFixed(1) + '%'))}</td>
						<td class="colorLG text-right middle ${diff < 0 ? 'color-red' : ''}">${diff.toFormat('NUMBER')}</td>
						<td class="colorLG text-right middle">${Math.round(total15 / 10000).toFormat('NUMBER')}</td>
						<td class="colorLG text-right middle">${((rt13 == Infinity) ? '' : (rt3.toFixed(1) + '%'))}</td>;
						<td class="colorSky text-center middle">매출</td>
						<td class="colorLG text-center middle">소계</td>
						<td class="colorLG text-right middle">${Math.round(total22 / 10000).toFormat('NUMBER')}</td>
						<td class="colorLG text-right middle" data-value="valueTtot"></td>
						<td class="colorLG text-right middle">${Math.round(total21 / 10000).toFormat('NUMBER')}</td>
						<td class="colorLG text-right middle">${((rt21 == Infinity) ? '' : (rt1.toFixed(1) + '%'))}</td>
						<td class="colorLG text-right middle">${Math.round(total24 / 10000).toFormat('NUMBER')}</td>
						<td class="colorLG text-right middle">${Math.round(total23 / 10000).toFormat('NUMBER')}</td>
						<td class="colorLG text-right middle">${((rt22 == Infinity) ? '' : (rt2.toFixed(1) + '%'))}</td>
						<td class="colorLG text-right middle ${diff < 0 ? 'color-red' : ''}">${diff.toFormat('NUMBER')}</td>
						<td class="colorLG text-right middle">${Math.round(total25 / 10000).toFormat('NUMBER')}</td>
						<td class="colorLG text-right middle">${((rt23 == Infinity) ? '' : (rt3.toFixed(1) + '%'))}</td>
					 </tr>`;

			$("#rpt99").find("#top-summary").find("tbody[role='body']").html(html);
			$("#rpt99").find("#top-summary").find("tbody[role='body']").yRowspan(0);
			$("#rpt99").find("#top-summary").find("tbody[role='body']").yRowspan(12);


			$("#rpt99detail").html("");
			$.each(pDataOrder, function(pIndex, dept_code){
				var pRow = pResult.contractList[dept_code];
				var sLength = 0, tLength = 0;
				if(pRow.hasOwnProperty('2')) sLength = pRow['2'].length;
				if(pRow.hasOwnProperty('3')) tLength = pRow['3'].length;
				var length = Math.max(sLength, tLength);
				var html = '';
				html += `<h5 class="sub-title underline arrow-up" data-usage="toggle" data-target="${dept_code}">${nameMap[dept_code].replaceAll("팀", "")}</h5>`;
				html += `<table id="detail-${dept_code}" class="table table-bordered w100p">
							<colgroup>
							<col width="25">
							<col width="25">
							<col width="145">
							<col width="125">
							<col width="120">
							<col width="100">
							<col width="145">
							<col width="100">
							<col width="100">
							<col width="100">
							<col width="100">
							<col width="100">

							<col width="25">
							<col width="25">
							<col width="145">
							<col width="125">
							<col width="120">
							<col width="100">
							<col width="145">
							<col width="100">
							<col width="100">
							<col width="100">
							<col width="100">
							<col width="100">
							</colgroup>
							<thead>
								<tr>
									<th class="color-contract text-center middle" colspan="2" rowspan="3" style="font-size:24px;"><span class="two-now-year"></span>/<span class="one-now-month"></span></th>
									<th class="colorB text-center middle" colspan="4"><span class="two-now-year"></span>.<span class="one-now-month"></span>월</th>
									<th class="colorB text-center middle" colspan="4"><span class="two-now-year"></span>.1~<span class="one-now-month"></span>월 누계</th>
									<th class="colorB text-center middle" rowspan="2">연간목표</th>
									<th class="colorB text-center middle" rowspan="2">연 달성(%)</th>
									<th class="color-contract text-center middle" colspan="2" rowspan="3" style="font-size:24px;"><span class="two-now-year"></span>/<span class="one-now-month"></span></th>
									<th class="colorB text-center middle" colspan="4"><span class="two-now-year"></span>.<span class="one-now-month"></span>월</th>
									<th class="colorB text-center middle" colspan="4"><span class="two-now-year"></span>.1~<span class="one-now-month"></span>월 누계</th>
									<th class="colorB text-center middle" rowspan="2">연간목표</th>
									<th class="colorB text-center middle" rowspan="2">연 달성(%)</th>
								</tr>
								<tr>
									<th class="colorB text-center middle">경영수주목표</th>
									<th class="colorB text-center middle">점검(<span class="one-now-month"></span>/<span class="one-now-day"></span>)</th>
									<th class="colorB text-center middle">수주실적</th>
									<th class="colorB text-center middle">달성(%)</th>
									<th class="colorB text-center middle">경영수주목표</th>
									<th class="colorB text-center middle">수주실적</th>
									<th class="colorB text-center middle">달성(%)</th>
									<th class="colorB text-center middle">차질액</th>
									<th class="colorB text-center middle">경영매출목표</th>
									<th class="colorB text-center middle">점검(<span class="one-now-month"></span>/<span class="one-now-day"></span>)</th>
									<th class="colorB text-center middle">매출실적</th>
									<th class="colorB text-center middle">달성(%)</th>
									<th class="colorB text-center middle">경영매출목표</th>
									<th class="colorB text-center middle">매출실적</th>
									<th class="colorB text-center middle">달성(%)</th>
									<th class="colorB text-center middle">차질액</th>
								</tr>
								<tr data-row="summary">
									<td class="colorLY text-right middle"></td>
									<td class="colorLY text-right middle"></td>
									<td class="colorLY text-right middle"></td>
									<td class="colorLY text-right middle"></td>
									<td class="colorLY text-right middle"></td>
									<td class="colorLY text-right middle"></td>
									<td class="colorLY text-right middle"></td>
									<td class="colorLY text-right middle"></td>
									<td class="colorLY text-right middle"></td>
									<td class="colorLY text-right middle"></td>
									<td class="colorLY text-right middle"></td>
									<td class="colorLY text-right middle"></td>
									<td class="colorLY text-right middle"></td>
									<td class="colorLY text-right middle"></td>
									<td class="colorLY text-right middle"></td>
									<td class="colorLY text-right middle"></td>
									<td class="colorLY text-right middle"></td>
									<td class="colorLY text-right middle"></td>
									<td class="colorLY text-right middle"></td>
									<td class="colorLY text-right middle"></td>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td class="color-contract middle text-center" colspan="2">수주</td>
									<td class="colorB middle text-center">건설사</td>
									<td class="colorB middle text-center">현장명</td>
									<td class="colorB middle text-center">경영수주목표</td>
									<td class="colorB middle text-center">점검(<span class="one-now-month"></span>/<span class="one-now-day"></span>)</td>
									<td class="colorB middle text-center">확정</td>
									<td class="colorB middle text-center">차이</td>
									<td class="colorB middle text-center" colspan="4">세부내역(+,- 1천만원 이상 차이시 작성)</td>
									<td class="color-contract middle text-center" colspan="2">매출</td>
									<td class="colorB middle text-center">건설사</td>
									<td class="colorB middle text-center">현장명</td>
									<td class="colorB middle text-center">경영매출목표</td>
									<td class="colorB middle text-center">점검(<span class="one-now-month"></span>/<span class="one-now-day"></span>)</td>
									<td class="colorB middle text-center">확정</td>
									<td class="colorB middle text-center">차이</td>
									<td class="colorB middle text-center" colspan="4">세부내역(+,- 1천만원 이상 차이시 작성)</td>
								</tr>`;
				var tot11 = 0, tot12 = 0, tot13 = 0, tot14 = 0;
				var tot21 = 0, tot22 = 0, tot23 = 0, tot24 = 0;
				for(let i=0;i<length;i++){
					html += `   <tr data-dept="${dept_code}">`;
					if(i < sLength && pRow.hasOwnProperty('2')){
						var pR = pRow['2'][i];
						var d_value = pR.dashboard_value == '' ? 0 : parseInt(pR.dashboard_value);
						var d_rm = pR.dashboard_rm;
						var amount = pR.amount;
						var diff = (pR.amount-pR.value);
						html += `	<td class="color-contract middle text-center" colspan="2">수주</td>
								 	<td class="middle text-left">${pR.bcnc_nm}</td>
								 	<td class="middle text-left">${pR.cntrct_nm}</td>
								 	<td class="middle text-right">${Math.round(pR.value/10000).toFormat('NUMBER')}</td>
								 	<td class="middle text-right input-available only-number" data-column="valueS" data-row="${pR.cntrct_sn}">${d_value.toFormat('NUMBER')}</td>
								 	<td class="middle text-right">${Math.round(amount/10000).toFormat('NUMBER')}</td>
								 	<td class="middle text-right ${diff < 0 ? 'color-red' : ''}">${Math.round(diff/10000).toFormat('NUMBER')}</td>
								 	<td class="middle text-left input-available only-text" colspan="4" data-column="rmS" data-row="${pR.cntrct_sn}">${d_rm}</td>
								`;
						tot11 += pR.value;
						tot12 += d_value;
						tot13 += amount;
						tot14 += diff;
					}
					else{
						html += `	<td class="color-contract middle text-center" colspan="2">수주</td>
								 	<td class="middle text-left"></td>
								 	<td class="middle text-left"></td>
								 	<td class="middle text-right"></td>
								 	<td class="middle text-right"></td>
								 	<td class="middle text-right"></td>
								 	<td class="middle text-right"></td>
								 	<td class="middle text-left" colspan="4"></td>
								`;
					}
					if(i < tLength && pRow.hasOwnProperty('3')){
						var pR = pRow['3'][i];
						var d_value = pR.dashboard_value == '' ? 0 : parseInt(pR.dashboard_value);
						var d_rm = pR.dashboard_rm;
						var amount = pR.amount;
						var diff = (pR.amount-pR.value);
						html += `	<td class="color-contract middle text-center" colspan="2">매출</td>
								 	<td class="middle text-left">${pR.bcnc_nm}</td>
								 	<td class="middle text-left">${pR.cntrct_nm}</td>
								 	<td class="middle text-right">${Math.round(pR.value/10000).toFormat('NUMBER')}</td>
								 	<td class="middle text-right input-available only-number" data-column="valueT" data-row="${pR.cntrct_sn}">${d_value.toFormat('NUMBER')}</td>
								 	<td class="middle text-right">${Math.round(amount/10000).toFormat('NUMBER')}</td>
								 	<td class="middle text-right ${diff < 0 ? 'color-red' : ''}">${Math.round(diff/10000).toFormat('NUMBER')}</td>
								 	<td class="middle text-left input-available only-text" colspan="4" data-column="rmT" data-row="${pR.cntrct_sn}">${d_rm}</td>
								`;
						tot21 += pR.value;
						tot22 += d_value;
						tot23 += amount;
						tot24 += diff;

					}
					else{
						html += `	<td class="color-contract middle text-center" colspan="2">매출</td>
								 	<td class="middle text-left"></td>
								 	<td class="middle text-left"></td>
								 	<td class="middle text-right"></td>
								 	<td class="middle text-right"></td>
								 	<td class="middle text-right"></td>
								 	<td class="middle text-right"></td>
								 	<td class="middle text-left" colspan="4"></td>
								`;
					}
					html += `   </tr>`;
				}
				html += `		<tr>
									<td class="color-contract middle text-center" colspan="2">수주</td>
									<td class="colorSky middle text-center" colspan="2">합 계</td>
									<td class="colorSky middle text-right">${Math.round(tot11/10000).toFormat('NUMBER')}</td>
									<td class="colorSky middle text-right" data-column="valueStot">${Math.round(tot12).toFormat('NUMBER')}</td>
									<td class="colorSky middle text-right">${Math.round(tot13/10000).toFormat('NUMBER')}</td>
									<td class="colorSky middle text-right ${tot14 < 0 ? 'color-red' : ''}">${Math.round(tot14/10000).toFormat('NUMBER')}</td>
									<td class="colorSky middle text-center" colspan="4"></td>
									<td class="color-contract middle text-center" colspan="2">매출</td>
									<td class="colorSky middle text-center" colspan="2">합 계</td>
									<td class="colorSky middle text-right">${Math.round(tot21/10000).toFormat('NUMBER')}</td>
									<td class="colorSky middle text-right" data-column="valueTtot">${Math.round(tot22).toFormat('NUMBER')}</td>
									<td class="colorSky middle text-right">${Math.round(tot23/10000).toFormat('NUMBER')}</td>
									<td class="colorSky middle text-right ${tot24 < 0 ? 'color-red' : ''}">${Math.round(tot24/10000).toFormat('NUMBER')}</td>
									<td class="colorSky middle text-center" colspan="4"></td>
								</tr>`;
				html += `   </tbody>
						</table>`;

				$("#rpt99detail").append(html);
				$("#rpt99").find(`tr[data-dept="${dept_code}"] td[data-value="valueS"]`).html(Math.round(tot12).toFormat('NUMBER'));
				$("#rpt99").find(`tr[data-dept="${dept_code}"] td[data-value="valueT"]`).html(Math.round(tot22).toFormat('NUMBER'));
				var summaries = $("#rpt99detail").find(`#detail-${dept_code}`).find("tr[data-row='summary'] td");
				var answers = $("#top-summary").find(`tr[data-dept='${dept_code}']`).find("td[data-column='summary']");
				$.each(summaries, function(pIndex, pValue){
					$(pValue).html(answers.eq(pIndex).html());
					if(answers.eq(pIndex).hasClass("color-red"))
						$(pValue).addClass("color-red");
				});
				$("#rpt99detail").find(`#detail-${dept_code}`).find("tbody").yRowspan(0);
				$("#rpt99detail").find(`#detail-${dept_code}`).find("tbody").yRowspan(7);
			});
			var summary_total = 0;
			$("#rpt99").find(`td[data-value="valueS"]`).each(function(pIndex, pTag){
				let value = parseInt($(pTag).html().replaceAll(",", "")); if(isNaN(value)) value = 0;
				summary_total += value;
			});
			$("#rpt99").find(`td[data-value="valueStot"]`).html(Math.round(summary_total).toFormat('NUMBER'));
			var summary_total = 0;
			$("#rpt99").find(`td[data-value="valueT"]`).each(function(pIndex, pTag){
				let value = parseInt($(pTag).html().replaceAll(",", "")); if(isNaN(value)) value = 0;
				summary_total += value;
			});
			$("#rpt99").find(`td[data-value="valueTtot"]`).html(Math.round(summary_total).toFormat('NUMBER'));


			$("#popReport99").find(".title h2").html(`${now_year}년 ${now_month}월 영업점검`);
			$("#popReport99").find(".two-now-year").html(now_year);
			$("#popReport99").find(".one-now-month").html(now_month);
			$("#popReport99").find(".one-now-day").html(now_day);


		}
	});
}
$(document).on("click", "#popReport99 h5[data-usage='toggle']", function(){
	var dept_code = $(this).data("target");
	$(document).find(`#detail-${dept_code}`).toggle();
	$(this).toggleClass('arrow-down').toggleClass('arrow-up');
});
$(document).on("dblclick", "#popReport99 .input-available", function(){
	var td = $(this);

	var authors = ["*"];
	var loginId = $("#loginID").val();
	if(!authors.includes("*") && !authors.includes(loginId)){
		alert("권한이 없습니다.");
		return false;
	}

	var data = prompt("값을 입력하세요.");
	if($(td).hasClass("only-number")) {
		try {
			if (/^\d+$/.test(data)) {
				data = parseInt(data);
			} else {
				throw new Error(`Parameter is not a number : ${data}`);
			}
		} catch (e) {
			alert("숫자 형식이 아닙니다. 올바른 형식으로 입력해주세요.");
			return false;
		}
	}
	var pxcond_mt = $('#report99_pxcond_mt').val();
	if (pxcond_mt == '') {
		$('#report99_pxcond_mt').datepicker('setDate', 'today');
		pxcond_mt = $('#report99_pxcond_mt').val();
	}
	var dept_code = $(this).parent().data("dept");
	var dashboard_date = pxcond_mt.substring(0, 7);
	var dashboard_column = $(this).data("column");
	var dashboard_row = $(this).data("row");
	var params = '';
	params += '&dashboard_date='+dashboard_date;
	params += '&dashboard_column='+dashboard_column;
	params += '&dashboard_row='+dashboard_row;
	params += '&dashboard_data='+data;
	console.log(params);
	$.ajax({
		url: '/api/dashboard/ajax_set_dashboard_data',
		type: 'GET',
		data: params,
		dataType: 'json',
		contentType: false,
		processData: false,
		success: function (pResult) {
			if(pResult.status){
				if($(td).hasClass("only-number")) {
					$(td).text(data.toString().toFormat("NUMBER"));
					let total = 0;
					$(td).parent().parent().find(`td[data-column='${dashboard_column}']`).each(function (pIndex, pTag) {
						let value = parseInt($(pTag).html().replaceAll(",", "")); if(isNaN(value)) value = 0;
						total += value;
					});
					$(td).parent().parent().find(`td[data-column="${dashboard_column}tot"]`).html(total.toFormat('NUMBER'));
					$("#rpt99").find(`tr[data-dept="${dept_code}"] td[data-value="${dashboard_column}"]`).html(Math.round(total).toFormat('NUMBER'));
					let summary_total = 0;
					$("#rpt99").find(`td[data-value="${dashboard_column}"]`).each(function(pIndex, pTag){
						let value = parseInt($(pTag).html().replaceAll(",", "")); if(isNaN(value)) value = 0;
						summary_total += value;
					});
					$("#rpt99").find(`td[data-value="${dashboard_column}tot"]`).html(Math.round(summary_total).toFormat('NUMBER'));
				}
				else
					$(td).text(data);
			}
		}
	});

});
$(function() {
    /**************************************************************************
     *
     */
	$('#popReport99').on('show.bs.modal', function(pEvent) {
		$('#report99_pxcond_mt').datepicker({
			beforeShow: function(dateText) {
				$(this).data('before', $(this).val());
			},
			onSelect: function(dateText) {
				$(this).change();
			},
		});

		var end = $('#report99_pxcond_mt').val();
		if (end == '') {
			$('#report99_pxcond_mt').datepicker('setDate', 'today');
			end = $('#report99_pxcond_mt').val();
		}
		getMonthReport(end);
		// getCompletedSujuB($("#s_pxcond_mt").val());
	});
	$('#report99_pxcond_mt').on("change", function(pEvent){
		var end = $(this).val();
		var before = $(this).data('before');
		if(before != end) getMonthReport(end);
	});

    /**************************************************************************
     *
     */
	$('#btnPrint99').on('click', function(pEvent) {
		var html = $('#popReport99').find('.modal-body').html();
		$('#_print').contents().find('body>div.report').html('');
		$('#_print').contents().find('body>div.report').html(html);
		parent.frames['_print'].focus();
    	parent.frames['_print'].print();
	});
});
</script>

<!-- popReport8 : 사전입찰 -->
<div class="modal fade" data-backdrop="static" id="popReport8">
    <div class="modal-dialog modal-w1200" style="width:57%!important;">
        <div class="modal-content">
			<div class="modal-header">
				<div class="pull-right" style="margin-right:10px;">
					<button type="button" class="btn btn-primary" id="btnPrint8"><i class="fa fa-print">&nbsp;출력</i></button>
					<button type="button" class="btn btn-default" aria-hidden="true" data-dismiss="modal"><i class="fa fa-times">&nbsp;취소</i></button>
				</div>
                <div class="pull-right" style="margin-right:10px;width:150px;">
				</div>

			</div>
			<div class="modal-body report">


			<style>

				tbody td.colorN3{
					background: #e6faff!important;
				}
				#rpt8 .table>tbody>tr>td, #rpt8 .table>tbody>tr>th, #rpt8 .table>tfoot>tr>td, #rpt8 .table>tfoot>tr>th, #rpt8 .table>thead>tr>td, #rpt8 .table>thead>tr>th {
					line-height: 1.0 !important;
				}
				body.smart-style-6 .modal .table>tbody>tr>td, body.smart-style-6 .modal .table>tfoot>tr>th, body.smart-style-6 .modal .table>tfoot>tr>td, body.smart-style-6 .modal .table>thead>tr>td {
					padding: 7px!important;
					vertical-align: middle!important;
				}
				@media (min-width: 100px) and (max-width: 1024px) {

					#popReport8 div.report table th,
					#popReport8 div.report table td {
						font-size: 8px!important;
						padding: 7px 5px!important;
						line-height: 1.0!important;
					}
				}
			</style>

				<div id="rpt8">
				<div class="title"><h2 class="colorLS" id="title">팀별 사전입찰 현황</h2></div>

				<!-- 기성 현황 시작 -->
				<table id="suju" class="table table-bordered w100p">
					 <colgroup>
						<col width="100">
						<col width="100">
						<col width="*">
						<col width="100">
						<col width="250">
						<col width="80">
						<col width="100">
					</colgroup>
					<tbody role="header">
						<tr>
							<th class="colorB" colspan="1">부서</th>
							<th class="colorB" colspan="1">거래처명</th>
							<th class="colorB" colspan="1">계약명(현장명)</th>
							<th class="colorB" colspan="1">사전입찰 확정월</th>
							<th class="colorB" colspan="1">공사 기간</th>
							<th class="colorB" colspan="1">총세대수</th>
							<th class="colorB" colspan="1">사전입찰 예정가</th>
						</tr>
					</tbody>
					<tbody role="body_suju">
					</tbody>
				</table>
				</div><!-- 기성 현황 끝 -->


			</div><!--modal-body-->
        </div><!--modal-content-->
    </div><!--modal-dialog-->
</div><!--modal-->
<script>
getCompletedSujuB = function(s_pxcond_mt)
{
    var params = '';
	params += '&s_pxcond_mt='+s_pxcond_mt;

	$.ajax({
		url: '/api/dashboard/ajax_get_completed_suju_b',
		type: 'GET',
		data: params,
		dataType: 'json',
		contentType: false,
		processData: false,
		success: function(pResult) {
			var html = '';
			var suju1, suju2; // 목표, 실적
            var before = "";
            var before_count = 0;
            var before_count2 = 0;
            var before_price_1 = 0;
            var before_price_2 = 0;

            var total_count = 0;
            var total_count2 = 0;
			var total_price_1 = 0;
            var total_price_2 = 0;
            $.each(pResult.data, function(pIndex, pValue){
                if(before != "" && before != pValue.code_nm){

                    html += '<tr>';
                    html += '    <td class="colorSky">'+before+'</td>';
                    html += '    <td class="colorN3">소계</td>';
                    html += '    <td class="colorN3">'+before_count2.toString().toFormat('NUMBER')+'개 현장</td>';
                    html += '    <td class="colorN3"></td>';
                    html += '    <td class="colorN3"></td>';
                    html += '    <td class="colorN3"></td>';
                    html += '    <td class="colorN3">'+before_price_2.toString().toFormat('NUMBER')+'</td>';
                    html += '</tr>';
                    total_count += before_count;
                    total_count2 += before_count2;
                    total_price_1 += before_price_1;
                    total_price_2 += before_price_2;

                    before_count = 0;
                    before_count2 = 0;
                    before_price_1 = 0;
                    before_price_2 = 0;
                }
				var extracted_de = pValue.cntrct_nm.match(/(?<=\D|^)\d{2}\/\d{2}(?=\D|$)/g);
				if(extracted_de == null || extracted_de.length == 0) extracted_de = '';
				else extracted_de = `20${extracted_de[0].split("/")[0]}년 ${extracted_de[0].split("/")[1]}월`;
                html += '<tr>';
                html += '    <td class="colorSky">'+pValue.code_nm+'</td>';
                html += '    <td>'+pValue.bcnc_nm+'</td>';
                html += '    <td>'+pValue.cntrct_nm.replace(/(?<=\D|^)\d{2}\/\d{2}(?=\D|$)/g, "").replaceAll("()", "")+'</td>';
                html += '    <td>'+extracted_de+'</td>';
                html += '    <td>'+pValue.cntrwk_period+'</td>';
				//

                html += '    <td></td>';
                html += '    <td>'+pValue.price_2.toString().toFormat('NUMBER')+'</td>';
                html += '</tr>';
                before = pValue.code_nm;
                if(pValue.ordr == '0')
                    before_count += parseInt(pValue.count);
                else
                    before_count2 += parseInt(pValue.count);
                before_price_1 += parseInt(pValue.price_1);
                before_price_2 += parseInt(pValue.price_2);
			});
            html += '<tr>';
            html += '    <td class="colorSky">'+before+'</td>';
            html += '    <td class="colorN3">소계</td>';
			html += '    <td class="colorN3">'+before_count2.toString().toFormat('NUMBER')+'개 현장</td>';
			html += '    <td class="colorN3"></td>';
			html += '    <td class="colorN3"></td>';
			html += '    <td class="colorN3"></td>';
			html += '    <td class="colorN3">'+before_price_2.toString().toFormat('NUMBER')+'</td>';
            html += '</tr>';
            total_count += before_count;
            total_count2 += before_count2;
            total_price_1 += before_price_1;
            total_price_2 += before_price_2;
            html += '<tr>';
            html += '    <td class="colorSky">총계</td>';
            html += '    <td class="colorSky"></td>';
            html += '    <td class="colorSky">'+total_count2.toString().toFormat('NUMBER')+'개 현장</td>';
            html += '    <td class="colorSky"></td>';
            html += '    <td class="colorSky"></td>';
            html += '    <td class="colorSky"></td>';
            html += '    <td class="colorSky">'+total_price_2.toString().toFormat('NUMBER')+'</td>';
            html += '</tr>';

            $("#rpt8").find("#suju tbody[role=body_suju]").html(html);
            $('#rpt8').find('#suju tbody[role=body_suju]').yRowspan(0);
            $('#rpt8').find('#suju tbody[role=body_suju]').yRowspan(1);

            var cells = $('#rpt8').find('#suju tbody[role=body_suju] td, #suju tbody[role=body_suju] th');
            $.each(cells, function(pIndex, pValue){
                let value = $(pValue).html();
                if(value == '0' || value == '0.0%' || value=='-Infinity%' || value=='Infinity%'){

                    $(pValue).html('');
                }
            });
		}
	});
}

$(function() {
    /**************************************************************************
     *
     */
	$('#popReport8').on('show.bs.modal', function(pEvent) {
		getCompletedSujuB($("#s_pxcond_mt").val());
	});


    /**************************************************************************
     *
     */
	$('#btnPrint8').on('click', function(pEvent) {
		var html = $('#popReport8').find('.modal-body').html();
		$('#_print').contents().find('body>div.report').html('');
		$('#_print').contents().find('body>div.report').html(html);
		parent.frames['_print'].focus();
    	parent.frames['_print'].print();
	});
});

</script>

<!-- popReport1 : 연간현황 -->
<div class="modal fade" data-backdrop="static" id="popReport1">
    <div class="modal-dialog modal-w1200" style="width:88%!important;">
        <div class="modal-content">
			<div class="modal-header">
				<div class="pull-right" style="margin-right:10px;">
					<button type="button" class="btn btn-primary" id="btnPrint1"><i class="fa fa-print">&nbsp;출력</i></button>
					<button type="button" class="btn btn-default" aria-hidden="true" data-dismiss="modal"><i class="fa fa-times">&nbsp;취소</i></button>
				</div>
			</div>
			<div class="modal-body report">

<style>
@media (min-width: 100px) and (max-width: 1024px) {

    #popReport1 div.report table th,
    #popReport1 div.report table td {
        font-size: 8px!important;
        padding: 7px 5px!important;
        line-height: 1.0!important;
    }
}
</style>
				<div id="rpt">
				<div class="title"><h2 class="colorLS" id="title">연간 실적 현황</h2></div>

				<!-- 기성 현황 시작 -->
				<table id="rptContractStatus2" class="table table-bordered w100p">
				<!--
					 <colgroup>
						<col width="50">
						<col width="90">
						<col width="90">
						<col width="180">
						<col width="180">
						<col width="180">
						<col width="180">
						<col width="180">
						<col width="180">
						<col width="180">
						<col width="180">
						<col width="180">
						<col width="180">
						<col width="180">
						<col width="180">
						<col width="180">
					</colgroup>
				-->
					<tbody role="header">
						<tr>
							<th class="colorB" colspan="3">구분</th>
							<th class="colorB" colspan="1"><a style="color:inherit;" class="btnSearch" data-code="0">1월</a></th>
							<th class="colorB" colspan="1"><a style="color:inherit;" class="btnSearch" data-code="1">2월</a></th>
							<th class="colorB" colspan="1"><a style="color:inherit;" class="btnSearch" data-code="2">3월</a></th>
							<th class="colorB" colspan="1"><a style="color:inherit;" class="btnSearch" data-code="3">4월</a></th>
							<th class="colorB" colspan="1"><a style="color:inherit;" class="btnSearch" data-code="4">5월</a></th>
							<th class="colorB" colspan="1"><a style="color:inherit;" class="btnSearch" data-code="5">6월</a></th>
							<th class="colorB" colspan="1"><a style="color:inherit;" class="btnSearch" data-code="6">7월</a></th>
							<th class="colorB" colspan="1"><a style="color:inherit;" class="btnSearch" data-code="7">8월</a></th>
							<th class="colorB" colspan="1"><a style="color:inherit;" class="btnSearch" data-code="8">9월</a></th>
							<th class="colorB" colspan="1"><a style="color:inherit;" class="btnSearch" data-code="9">10월</a></th>
							<th class="colorB" colspan="1"><a style="color:inherit;" class="btnSearch" data-code="10">11월</a></th>
							<th class="colorB" colspan="1"><a style="color:inherit;" class="btnSearch" data-code="11">12월</a></th>
							<th class="colorB" colspan="1">누계</th>
						</tr>
					</tbody>
					<tbody role="body_suju">
					</tbody>
					<tbody role="body_sales">
					</tbody>
					<tbody role="body_va">
					</tbody>
				</table>
				</div><!-- 기성 현황 끝 -->


			</div><!--modal-body-->
        </div><!--modal-content-->
    </div><!--modal-dialog-->
</div><!--modal-->
<script>
getCompletedYearSummary = function()
{
	$.ajax({
		url: '/api/dashboard/ajax_get_completed_year_summary',
		type: 'GET',
		data: '',
		dataType: 'json',
		contentType: false,
		processData: false,
		success: function(pResult) {
			console.log('getCompletedYearSummary', pResult);
			var html = '';
			var suju1, suju2; // 목표, 실적
			$.each(pResult.data, function(pIndex, pValue){
				if (pIndex == 0) { // 수주
					html = '';
					$.each(pValue, function(pIndex, pValue){
						console.log(pIndex, pValue);
						var count = pValue.length;
						if (pValue.sort == '1') {
							suju1 = pValue; // 목표
						} else if (pValue.sort == '2') {
							suju2 = pValue; // 실적
						}
						html += '<tr>';
						html += '    <td class="text-center colorSky" style="vertical-align:middle;">수주</td>';
						html += '    <td class="text-center colorSky" style="vertical-align:middle;">' + (pValue.dept_nm.replaceAll('팀','')) + '</td>';
						html += '    <td class="text-center">' + (pValue.sort == '1' ? '목표' : '실적') +'</td>';
						html += '    <td class="text-right" name="'+(pValue.sort)+'01">' + (pValue.m01).toFormat('NUMBER') + '</td>';
						html += '    <td class="text-right" name="'+(pValue.sort)+'02">' + (pValue.m02).toFormat('NUMBER') + '</td>';
						html += '    <td class="text-right" name="'+(pValue.sort)+'03">' + (pValue.m03).toFormat('NUMBER') + '</td>';
						html += '    <td class="text-right" name="'+(pValue.sort)+'04">' + (pValue.m04).toFormat('NUMBER') + '</td>';
						html += '    <td class="text-right" name="'+(pValue.sort)+'05">' + (pValue.m05).toFormat('NUMBER') + '</td>';
						html += '    <td class="text-right" name="'+(pValue.sort)+'06">' + (pValue.m06).toFormat('NUMBER') + '</td>';
						html += '    <td class="text-right" name="'+(pValue.sort)+'07">' + (pValue.m07).toFormat('NUMBER') + '</td>';
						html += '    <td class="text-right" name="'+(pValue.sort)+'08">' + (pValue.m08).toFormat('NUMBER') + '</td>';
						html += '    <td class="text-right" name="'+(pValue.sort)+'09">' + (pValue.m09).toFormat('NUMBER') + '</td>';
						html += '    <td class="text-right" name="'+(pValue.sort)+'10">' + (pValue.m10).toFormat('NUMBER') + '</td>';
						html += '    <td class="text-right" name="'+(pValue.sort)+'11">' + (pValue.m11).toFormat('NUMBER') + '</td>';
						html += '    <td class="text-right" name="'+(pValue.sort)+'12">' + (pValue.m12).toFormat('NUMBER') + '</td>';
						html += '    <td class="text-right" name="'+(pValue.sort)+'13">' + (pValue.total).toFormat('NUMBER') + '</td>';
						html += '</tr>';
						// 달성율처리
						if ((pIndex+1)%2 == 0) {
							html += '<tr>';
							html += '    <td class="text-center colorSky" style="vertical-align:middle;">수주</td>';
							html += '    <td class="text-center colorSky" style="vertical-align:middle;">' + (pValue.dept_nm.replaceAll('팀','')) + '</td>';
							html += '    <td class="text-center colorLG">달성율</td>';
							html += '    <td class="text-right colorLG">' + ((parseInt(suju2.m01)/parseInt(suju1.m01))*100).toFixed(0) + '%</td>';
							html += '    <td class="text-right colorLG">' + ((parseInt(suju2.m02)/parseInt(suju1.m02))*100).toFixed(0) + '%</td>';
							html += '    <td class="text-right colorLG">' + ((parseInt(suju2.m03)/parseInt(suju1.m03))*100).toFixed(0) + '%</td>';
							html += '    <td class="text-right colorLG">' + ((parseInt(suju2.m04)/parseInt(suju1.m04))*100).toFixed(0) + '%</td>';
							html += '    <td class="text-right colorLG">' + ((parseInt(suju2.m05)/parseInt(suju1.m05))*100).toFixed(0) + '%</td>';
							html += '    <td class="text-right colorLG">' + ((parseInt(suju2.m06)/parseInt(suju1.m06))*100).toFixed(0) + '%</td>';
							html += '    <td class="text-right colorLG">' + ((parseInt(suju2.m07)/parseInt(suju1.m07))*100).toFixed(0) + '%</td>';
							html += '    <td class="text-right colorLG">' + ((parseInt(suju2.m08)/parseInt(suju1.m08))*100).toFixed(0) + '%</td>';
							html += '    <td class="text-right colorLG">' + ((parseInt(suju2.m09)/parseInt(suju1.m09))*100).toFixed(0) + '%</td>';
							html += '    <td class="text-right colorLG">' + ((parseInt(suju2.m10)/parseInt(suju1.m10))*100).toFixed(0) + '%</td>';
							html += '    <td class="text-right colorLG">' + ((parseInt(suju2.m11)/parseInt(suju1.m11))*100).toFixed(0) + '%</td>';
							html += '    <td class="text-right colorLG">' + ((parseInt(suju2.m12)/parseInt(suju1.m12))*100).toFixed(0) + '%</td>';
							html += '    <td class="text-right colorLG">' + ((parseInt(suju2.total)/parseInt(suju1.total))*100).toFixed(0) + '%</td>';
							html += '</tr>';
						}
					});
					$('#rpt').find('#rptContractStatus2 tbody[role=body_suju]').html(html);

					// 합계처리
					var suju1_sum = [], suju2_sum = [];
					html = '';
					for (var i=1; i<=2; i++) {
						html += '<tr>';
						html += '    <td class="text-center colorG" style="vertical-align:middle;" colspan="2">계</td>';
						html += '    <td class="text-center colorG">' + (i == '1' ? '목표' : '실적') +'</td>';
						for (var m=1; m<=13; m++) {
							var sum = 0;
							var tmp = $('#rpt').find('#rptContractStatus2 tbody[role=body_suju] td[name='+i+('0'+m).slice(-2)+']');
							$.each(tmp, function(pIndex, pValue){
								sum += parseInt((pValue.innerText).replaceAll(',', ''));
							});
							html += '    <td class="text-right colorG">' + (''+sum).toFormat('NUMBER') + '</td>';
							if (i == 1) {
								suju1_sum.push(sum);
							} else if (i == 2) {
								suju2_sum.push(sum);
							}
						}
						html += '</tr>';
					}
					html += '<tr>';
					html += '    <td class="text-center colorG" colspan="2">계</td>';
					html += '    <td class="text-center colorG">달성율</td>';
					for (var m=1; m<=13; m++) {
						html += '    <td class="text-right colorG">' + ((suju2_sum[m-1]/suju1_sum[m-1])*100).toFixed(0) + '%</td>';
					}
					html += '</tr>';
					$('#rpt').find('#rptContractStatus2 tbody[role=body_suju]').append(html);
					$('#rpt').find('#rptContractStatus2 tbody[role=body_suju]').yRowspan(0);
					$('#rpt').find('#rptContractStatus2 tbody[role=body_suju]').yRowspan(1);
				} else if (pIndex == 1) { // 매출
					html = '';
					$.each(pValue, function(pIndex, pValue){
						console.log(pIndex, pValue);
						var count = pValue.length;
						if (pValue.sort == '1') {
							suju1 = pValue; // 목표
						} else if (pValue.sort == '2') {
							suju2 = pValue; // 실적
						}
						html += '<tr>';
						html += '    <td class="text-center colorSky" style="vertical-align:middle;">매출</td>';
						html += '    <td class="text-center colorSky" style="vertical-align:middle;">' + (pValue.dept_nm.replaceAll('팀','')) + '</td>';
						html += '    <td class="text-center">' + (pValue.sort == '1' ? '목표' : '실적') +'</td>';
						html += '    <td class="text-right" name="'+(pValue.sort)+'01">' + (pValue.m01).toFormat('NUMBER') + '</td>';
						html += '    <td class="text-right" name="'+(pValue.sort)+'02">' + (pValue.m02).toFormat('NUMBER') + '</td>';
						html += '    <td class="text-right" name="'+(pValue.sort)+'03">' + (pValue.m03).toFormat('NUMBER') + '</td>';
						html += '    <td class="text-right" name="'+(pValue.sort)+'04">' + (pValue.m04).toFormat('NUMBER') + '</td>';
						html += '    <td class="text-right" name="'+(pValue.sort)+'05">' + (pValue.m05).toFormat('NUMBER') + '</td>';
						html += '    <td class="text-right" name="'+(pValue.sort)+'06">' + (pValue.m06).toFormat('NUMBER') + '</td>';
						html += '    <td class="text-right" name="'+(pValue.sort)+'07">' + (pValue.m07).toFormat('NUMBER') + '</td>';
						html += '    <td class="text-right" name="'+(pValue.sort)+'08">' + (pValue.m08).toFormat('NUMBER') + '</td>';
						html += '    <td class="text-right" name="'+(pValue.sort)+'09">' + (pValue.m09).toFormat('NUMBER') + '</td>';
						html += '    <td class="text-right" name="'+(pValue.sort)+'10">' + (pValue.m10).toFormat('NUMBER') + '</td>';
						html += '    <td class="text-right" name="'+(pValue.sort)+'11">' + (pValue.m11).toFormat('NUMBER') + '</td>';
						html += '    <td class="text-right" name="'+(pValue.sort)+'12">' + (pValue.m12).toFormat('NUMBER') + '</td>';
						html += '    <td class="text-right" name="'+(pValue.sort)+'13">' + (pValue.total).toFormat('NUMBER') + '</td>';
						html += '</tr>';
						// 달성율처리
						if ((pIndex+1)%2 == 0) {
							html += '<tr>';
							html += '    <td class="text-center colorSky" style="vertical-align:middle;">매출</td>';
							html += '    <td class="text-center colorSky" style="vertical-align:middle;">' + (pValue.dept_nm.replaceAll('팀','')) + '</td>';
							html += '    <td class="text-center colorLG">달성율</td>';
							html += '    <td class="text-right colorLG">' + ((parseInt(suju2.m01)/parseInt(suju1.m01))*100).toFixed(0) + '%</td>';
							html += '    <td class="text-right colorLG">' + ((parseInt(suju2.m02)/parseInt(suju1.m02))*100).toFixed(0) + '%</td>';
							html += '    <td class="text-right colorLG">' + ((parseInt(suju2.m03)/parseInt(suju1.m03))*100).toFixed(0) + '%</td>';
							html += '    <td class="text-right colorLG">' + ((parseInt(suju2.m04)/parseInt(suju1.m04))*100).toFixed(0) + '%</td>';
							html += '    <td class="text-right colorLG">' + ((parseInt(suju2.m05)/parseInt(suju1.m05))*100).toFixed(0) + '%</td>';
							html += '    <td class="text-right colorLG">' + ((parseInt(suju2.m06)/parseInt(suju1.m06))*100).toFixed(0) + '%</td>';
							html += '    <td class="text-right colorLG">' + ((parseInt(suju2.m07)/parseInt(suju1.m07))*100).toFixed(0) + '%</td>';
							html += '    <td class="text-right colorLG">' + ((parseInt(suju2.m08)/parseInt(suju1.m08))*100).toFixed(0) + '%</td>';
							html += '    <td class="text-right colorLG">' + ((parseInt(suju2.m09)/parseInt(suju1.m09))*100).toFixed(0) + '%</td>';
							html += '    <td class="text-right colorLG">' + ((parseInt(suju2.m10)/parseInt(suju1.m10))*100).toFixed(0) + '%</td>';
							html += '    <td class="text-right colorLG">' + ((parseInt(suju2.m11)/parseInt(suju1.m11))*100).toFixed(0) + '%</td>';
							html += '    <td class="text-right colorLG">' + ((parseInt(suju2.m12)/parseInt(suju1.m12))*100).toFixed(0) + '%</td>';
							html += '    <td class="text-right colorLG">' + ((parseInt(suju2.total)/parseInt(suju1.total))*100).toFixed(0) + '%</td>';
							html += '</tr>';
						}
					});
					$('#rpt').find('#rptContractStatus2 tbody[role=body_sales]').html(html);

					// 합계처리
					var suju1_sum = [], suju2_sum = [];
					html = '';
					for (var i=1; i<=2; i++) {
						html += '<tr>';
						html += '    <td class="text-center colorG" style="vertical-align:middle;" colspan="2">계</td>';
						html += '    <td class="text-center colorG">' + (i == '1' ? '목표' : '실적') +'</td>';
						for (var m=1; m<=13; m++) {
							var sum = 0;
							var tmp = $('#rpt').find('#rptContractStatus2 tbody[role=body_sales] td[name='+i+('0'+m).slice(-2)+']');
							$.each(tmp, function(pIndex, pValue){
								sum += parseInt((pValue.innerText).replaceAll(',', ''));
							});
							html += '    <td class="text-right colorG">' + (''+sum).toFormat('NUMBER') + '</td>';
							if (i == 1) {
								suju1_sum.push(sum);
							} else if (i == 2) {
								suju2_sum.push(sum);
							}
						}
						html += '</tr>';
					}
					html += '<tr>';
					html += '    <td class="text-center colorG" colspan="2">계</td>';
					html += '    <td class="text-center colorG">달성율</td>';
					for (var m=1; m<=13; m++) {
						html += '    <td class="text-right colorG">' + ((suju2_sum[m-1]/suju1_sum[m-1])*100).toFixed(0) + '%</td>';
					}
					html += '</tr>';
					$('#rpt').find('#rptContractStatus2 tbody[role=body_sales]').append(html);
					$('#rpt').find('#rptContractStatus2 tbody[role=body_sales]').yRowspan(0);
					$('#rpt').find('#rptContractStatus2 tbody[role=body_sales]').yRowspan(1);
				} else if (pIndex == 2) { // VA
					html = '';
					$.each(pValue, function(pIndex, pValue){
						console.log(pIndex, pValue);
						var count = pValue.length;
						if (pValue.sort == '1') {
							suju1 = pValue; // 목표
						} else if (pValue.sort == '2') {
							suju2 = pValue; // 실적
						}
						html += '<tr>';
						html += '    <td class="text-center colorSky" style="vertical-align:middle;">VA</td>';
						html += '    <td class="text-center colorSky" style="vertical-align:middle;">' + (pValue.dept_nm.replaceAll('팀','')) + '</td>';
						html += '    <td class="text-center">' + (pValue.sort == '1' ? '목표' : '실적') +'</td>';
						html += '    <td class="text-right" name="'+(pValue.sort)+'01">' + (pValue.m01).toFormat('NUMBER') + '</td>';
						html += '    <td class="text-right" name="'+(pValue.sort)+'02">' + (pValue.m02).toFormat('NUMBER') + '</td>';
						html += '    <td class="text-right" name="'+(pValue.sort)+'03">' + (pValue.m03).toFormat('NUMBER') + '</td>';
						html += '    <td class="text-right" name="'+(pValue.sort)+'04">' + (pValue.m04).toFormat('NUMBER') + '</td>';
						html += '    <td class="text-right" name="'+(pValue.sort)+'05">' + (pValue.m05).toFormat('NUMBER') + '</td>';
						html += '    <td class="text-right" name="'+(pValue.sort)+'06">' + (pValue.m06).toFormat('NUMBER') + '</td>';
						html += '    <td class="text-right" name="'+(pValue.sort)+'07">' + (pValue.m07).toFormat('NUMBER') + '</td>';
						html += '    <td class="text-right" name="'+(pValue.sort)+'08">' + (pValue.m08).toFormat('NUMBER') + '</td>';
						html += '    <td class="text-right" name="'+(pValue.sort)+'09">' + (pValue.m09).toFormat('NUMBER') + '</td>';
						html += '    <td class="text-right" name="'+(pValue.sort)+'10">' + (pValue.m10).toFormat('NUMBER') + '</td>';
						html += '    <td class="text-right" name="'+(pValue.sort)+'11">' + (pValue.m11).toFormat('NUMBER') + '</td>';
						html += '    <td class="text-right" name="'+(pValue.sort)+'12">' + (pValue.m12).toFormat('NUMBER') + '</td>';
						html += '    <td class="text-right" name="'+(pValue.sort)+'13">' + (pValue.total).toFormat('NUMBER') + '</td>';
						html += '</tr>';
						// 달성율처리
						if ((pIndex+1)%2 == 0) {
							html += '<tr>';
							html += '    <td class="text-center colorSky" style="vertical-align:middle;">VA</td>';
							html += '    <td class="text-center colorSky" style="vertical-align:middle;">' + (pValue.dept_nm.replaceAll('팀','')) + '</td>';
							html += '    <td class="text-center colorLG">달성율</td>';

                            html += '    <td class="text-right colorLG">' + ((parseInt(suju1.m01) < 0) ? 100.0 + (parseInt(suju1.m01) - parseInt(suju2.m01))*100/parseInt(suju1.m01) : ((parseInt(suju2.m01)/parseInt(suju1.m01))*100)).toFixed(0) + '%</td>';
                            html += '    <td class="text-right colorLG">' + ((parseInt(suju1.m02) < 0) ? 100.0 + (parseInt(suju1.m02) - parseInt(suju2.m02))*100/parseInt(suju1.m02) : ((parseInt(suju2.m02)/parseInt(suju1.m02))*100)).toFixed(0) + '%</td>';
                            html += '    <td class="text-right colorLG">' + ((parseInt(suju1.m03) < 0) ? 100.0 + (parseInt(suju1.m03) - parseInt(suju2.m03))*100/parseInt(suju1.m03) : ((parseInt(suju2.m03)/parseInt(suju1.m03))*100)).toFixed(0) + '%</td>';
                            html += '    <td class="text-right colorLG">' + ((parseInt(suju1.m04) < 0) ? 100.0 + (parseInt(suju1.m04) - parseInt(suju2.m04))*100/parseInt(suju1.m04) : ((parseInt(suju2.m04)/parseInt(suju1.m04))*100)).toFixed(0) + '%</td>';
                            html += '    <td class="text-right colorLG">' + ((parseInt(suju1.m05) < 0) ? 100.0 + (parseInt(suju1.m05) - parseInt(suju2.m05))*100/parseInt(suju1.m05) : ((parseInt(suju2.m05)/parseInt(suju1.m05))*100)).toFixed(0) + '%</td>';

                            html += '    <td class="text-right colorLG">' + ((parseInt(suju1.m06) < 0) ? 100.0 + (parseInt(suju1.m06) - parseInt(suju2.m06))*100/parseInt(suju1.m06) : ((parseInt(suju2.m06)/parseInt(suju1.m06))*100)).toFixed(0) + '%</td>';

                            html += '    <td class="text-right colorLG">' + ((parseInt(suju1.m07) < 0) ? 100.0 + (parseInt(suju1.m07) - parseInt(suju2.m07))*100/parseInt(suju1.m07) : ((parseInt(suju2.m07)/parseInt(suju1.m07))*100)).toFixed(0) + '%</td>';

                            html += '    <td class="text-right colorLG">' + ((parseInt(suju1.m08) < 0) ? 100.0 + (parseInt(suju1.m08) - parseInt(suju2.m08))*100/parseInt(suju1.m08) : ((parseInt(suju2.m08)/parseInt(suju1.m08))*100)).toFixed(0) + '%</td>';
                            html += '    <td class="text-right colorLG">' + ((parseInt(suju1.m09) < 0) ? 100.0 + (parseInt(suju1.m09) - parseInt(suju2.m09))*100/parseInt(suju1.m09) : ((parseInt(suju2.m09)/parseInt(suju1.m09))*100)).toFixed(0) + '%</td>';
                            html += '    <td class="text-right colorLG">' + ((parseInt(suju1.m10) < 0) ? 100.0 + (parseInt(suju1.m10) - parseInt(suju2.m10))*100/parseInt(suju1.m10) : ((parseInt(suju2.m10)/parseInt(suju1.m10))*100)).toFixed(0) + '%</td>';
                            html += '    <td class="text-right colorLG">' + ((parseInt(suju1.m11) < 0) ? 100.0 + (parseInt(suju1.m11) - parseInt(suju2.m11))*100/parseInt(suju1.m11) : ((parseInt(suju2.m11)/parseInt(suju1.m11))*100)).toFixed(0) + '%</td>';
                            html += '    <td class="text-right colorLG">' + ((parseInt(suju1.m12) < 0) ? 100.0 + (parseInt(suju1.m12) - parseInt(suju2.m12))*100/parseInt(suju1.m12) : ((parseInt(suju2.m12)/parseInt(suju1.m12))*100)).toFixed(0) + '%</td>';
                            html += '    <td class="text-right colorLG">' + ((parseInt(suju1.total) < 0) ? 100.0 + (parseInt(suju1.total) - parseInt(suju2.total))*100/parseInt(suju1.total) : ((parseInt(suju2.total)/parseInt(suju1.total))*100)).toFixed(0) + '%</td>';

//							html += '    <td class="text-right colorSky">' + ((parseInt(suju2.m02)/parseInt(suju1.m02))*100).toFixed(0) + '%</td>';
//							html += '    <td class="text-right colorSky">' + ((parseInt(suju2.m03)/parseInt(suju1.m03))*100).toFixed(0) + '%</td>';
//							html += '    <td class="text-right colorSky">' + ((parseInt(suju2.m04)/parseInt(suju1.m04))*100).toFixed(0) + '%</td>';
//							html += '    <td class="text-right colorSky">' + ((parseInt(suju2.m05)/parseInt(suju1.m05))*100).toFixed(0) + '%</td>';
//							html += '    <td class="text-right colorSky">' + ((parseInt(suju2.m06)/parseInt(suju1.m06))*100).toFixed(0) + '%</td>';
//							html += '    <td class="text-right colorSky">' + ((parseInt(suju2.m07)/parseInt(suju1.m07))*100).toFixed(0) + '%</td>';
//							html += '    <td class="text-right colorSky">' + ((parseInt(suju2.m08)/parseInt(suju1.m08))*100).toFixed(0) + '%</td>';
//							html += '    <td class="text-right colorSky">' + ((parseInt(suju2.m09)/parseInt(suju1.m09))*100).toFixed(0) + '%</td>';
//							html += '    <td class="text-right colorSky">' + ((parseInt(suju2.m10)/parseInt(suju1.m10))*100).toFixed(0) + '%</td>';
//							html += '    <td class="text-right colorSky">' + ((parseInt(suju2.m11)/parseInt(suju1.m11))*100).toFixed(0) + '%</td>';
//							html += '    <td class="text-right colorSky">' + ((parseInt(suju2.m12)/parseInt(suju1.m12))*100).toFixed(0) + '%</td>';
//							html += '    <td class="text-right colorSky">' + ((parseInt(suju2.total)/parseInt(suju1.total))*100).toFixed(0) + '%</td>';
							html += '</tr>';
						}
					});
					$('#rpt').find('#rptContractStatus2 tbody[role=body_va]').html(html);

					// 합계처리
					var suju1_sum = [], suju2_sum = [];
					html = '';
					for (var i=1; i<=2; i++) {
						html += '<tr>';
						html += '    <td class="text-center colorG" style="vertical-align:middle;" colspan="2">계</td>';
						html += '    <td class="text-center colorG">' + (i == '1' ? '목표' : '실적') +'</td>';
						for (var m=1; m<=13; m++) {
							var sum = 0;
							var tmp = $('#rpt').find('#rptContractStatus2 tbody[role=body_va] td[name='+i+('0'+m).slice(-2)+']');
							$.each(tmp, function(pIndex, pValue){
								sum += parseInt((pValue.innerText).replaceAll(',', ''));
							});
							html += '    <td class="text-right colorG">' + (''+sum).toFormat('NUMBER') + '</td>';
							if (i == 1) {
								suju1_sum.push(sum);
							} else if (i == 2) {
								suju2_sum.push(sum);
							}
						}
						html += '</tr>';
					}
					html += '<tr>';
					html += '    <td class="text-center colorG" colspan="2">계</td>';
					html += '    <td class="text-center colorG">달성율</td>';
					for (var m=1; m<=13; m++) {
						html += '    <td class="text-right colorG">' + ((suju2_sum[m-1]/suju1_sum[m-1])*100).toFixed(0) + '%</td>';
					}
					html += '</tr>';
					$('#rpt').find('#rptContractStatus2 tbody[role=body_va]').append(html);
					$('#rpt').find('#rptContractStatus2 tbody[role=body_va]').yRowspan(0);
					$('#rpt').find('#rptContractStatus2 tbody[role=body_va]').yRowspan(1);
				}
			});
			$("#popReport1").find("td").each(function(pIndex, pValue){
				let value = $(pValue).html();
                if(value == '0' || value == '0.0%' || value=='-Infinity%' || value=='Infinity%' || value=='NaN%'){

                    $(pValue).html('');
                }

			});

		}
	});
}

$(function() {
    /**************************************************************************
     * 
     */
	$('#popReport1').on('show.bs.modal', function(pEvent) {
		getCompletedYearSummary();
	});


    /**************************************************************************
     * 
     */
	$('#btnPrint1').on('click', function(pEvent) {
		var html = $('#popReport1').find('.modal-body').html();
		$('#_print').contents().find('body>div.report').html('');
		$('#_print').contents().find('body>div.report').html(html);
		parent.frames['_print'].focus();
    	parent.frames['_print'].print();
	});
});
    
$('#popReport1').on('click', '.btnSearch', function(pEvent) {
    var code = $(this).data('code');
    var now = new Date();
    now.setDate(1);
    now.setMonth(code);
    now = $.datepicker.formatDate('yy-mm-dd', now);
    getCompletedSummary(now);
    $("#s_pxcond_mt").val(now);
    $('#popReport1').modal('hide');
});
</script>

<!-- popReport6 : 현장현황 및 BISS 지적현황 - 이름/부서 -->
<div class="modal fade" data-backdrop="static" id="popReport6">
    <div class="modal-dialog modal-w1200" style="width:60%!important;">
        <div class="modal-content">
			<div class="modal-header">
				<div class="pull-right" style="margin-right:10px;">
					<button type="button" class="btn btn-primary" id="btnPrint6"><i class="fa fa-print">&nbsp;출력</i></button>
					<button type="button" class="btn btn-default" aria-hidden="true" data-dismiss="modal"><i class="fa fa-times">&nbsp;취소</i></button>
				</div>

			</div>
			<div class="modal-body report">

				<div id="rpt6">
				<!--<div class="title"><h2 class="colorLS" id="title">팀별 VA 현황</h2></div>-->
				<style>

					#rpt6 .table>tbody>tr>td, #rpt6 .table>tbody>tr>th, #rpt6 .table>tfoot>tr>td, #rpt6 .table>tfoot>tr>th, #rpt6 .table>thead>tr>td, #rpt6 .table>thead>tr>th {
						line-height: 1.0 !important;
					}
					#rpt6 .colorEG{
						background: rgb(255,204,153)!important;
						font-weight: bold;
						color: black;
					}
					#rpt6 .colorJ{
						background: #3d8b40!important;
						font-weight: bold;
						color: white;
					}
					#rpt6 #dtList1{
						font-size: 10px!important;
					}

				</style>
				<style>
				@media (min-width: 100px) and (max-width: 1024px) {

					#popReport6 div.report table th,
					#popReport6 div.report table td {
						font-size: 8px!important;
						padding: 7px 5px!important;
						line-height: 1.0!important;
					}
				}
				</style>
				<!-- 기성 현황 시작 -->
				<table id="va" class="table table-bordered w50p" style="width: 90%!important;margin: 0 auto;">
					 <colgroup>
						<col width="100">
						<col width="120">
						<col width="80">
						<col width="*">
						<col width="100">
						<col width="160">
						<col width="60">
					</colgroup>
					<tbody role="header">
						<tr>
							<th class="colorB" colspan="1"></th>
							<th class="colorB" colspan="1">건설사</th>
							<th class="colorB" colspan="1">분류</th>
							<th class="colorB" colspan="1">현장명(사전입찰)</th>
							<th class="colorB" colspan="1">금액</th>
							<th class="colorB" colspan="1">공사기간</th>
							<th class="colorB" colspan="1">공정률</th>
						</tr>
					</tbody>
					<tbody role="body">
					</tbody>
					<tbody role="foot">
					</tbody>
				</table>
				<!-- 기성 현황 끝 -->
				</div>

			</div><!--modal-body-->
        </div><!--modal-content-->
    </div><!--modal-dialog-->
</div><!--modal-->
<script>
getProjectsByDeptMember = function(s_mber_sn, s_dept_code)
{
    var params = '';
    if(s_mber_sn != ''){
		params += '&s_mber_sn='+s_mber_sn;
	}
	params += '&s_dept_code='+s_dept_code;

	$.ajax({
		url: '/api/dashboard/ajax_get_projects_by_dept_member',
		type: 'GET',
		data: params,
		dataType: 'json',
		contentType: false,
		processData: false,
		success: function(pResult) {
			console.log('getMemberProject', pResult);
			var html = '';
            var before = '';
            var count = 0;
            var amount = 0;
            var count_tot = 0;
            var amount_tot = 0;
            var pData = pResult.data;
            $.each(pData, function(pIndex, pValue){
                var rate = pValue.rate == '' ? 0.0 : parseFloat(pValue.rate);
                if(rate == 0.0 && pValue.progrs_sttus_code == 'P'){
                    pValue.progrs_sttus_code = 'K';
                    pValue.sttus_nm = '대기';
                }
                if(pValue.progrs_sttus_code == 'P'){
                    pValue.ordr = 1;
                }
                else if(pValue.progrs_sttus_code == 'K'){
                    pValue.ordr = 2;
                }
                else if(pValue.progrs_sttus_code == 'B'){
                    pValue.ordr = 3;
                }
                else{
                    pValue.ordr = 4;
                }
            });
            pData.sort((a, b) => (a.ordr > b.ordr) ? 1 : -1 )
            $.each(pResult.data, function(pIndex, pValue){
				if(before != "" && before != pValue.sttus_nm){

                    html += '<tr>';
                    html += '    <td class="text-center colorN3" colspan="3">계</td>';
                    html += '    <td class="text-center colorN3">'+count.toString().toFormat('NUMBER')+'개</td>';
                    html += '    <td class="text-right colorN3">'+amount.toString().toFormat('NUMBER')+'</td>';
                    html += '    <td class="text-center colorN3"></td>';
                    html += '    <td class="text-center colorN3"></td>';
                    html += '</tr>';

                    count_tot += count;
                    amount_tot += amount;
                    count = 0;
                    amount = 0;
                    before = pValue.sttus_nm;
                }
                var exec_sum = pValue.exec_sum == '' ? 0 : parseInt(pValue.exec_sum);
                var complete_sum = pValue.complete_sum == '' ? 0 : parseInt(pValue.complete_sum);
                var now_sum = pValue.now_sum == '' ? 0 : parseInt(pValue.now_sum);
                var rate = pValue.rate == '' ? '0.0%' : parseFloat(pValue.rate).toFixed(1)+'%';
                html += '<tr>';
                html += '    <td class="text-center">'+pValue.sttus_nm+'</td>'
                html += '    <td class="text-center">'+pValue.bcnc_nm+'</td>'
                html += '    <td class="text-center">'+pValue.prjct_ty_nm.split("(")[1].replaceAll(")", "").replaceAll("일반", "직계약")+'</td>'
                html += '    <td class="text-center">'+pValue.spt_nm+'</td>'
                html += '    <td class="text-right">'+pValue.cntrct_amount.toString().toFormat('NUMBER')+'</td>'
                html += '    <td class="text-center">'+pValue.cntrwk_period+'</td>'
                html += `    <td class="text-center ${parseFloat(pValue.rate) >= 95.0 ? "colorP" : ""}">${rate}</td>`
                html += '</tr>';
                count += 1;
                amount += pValue.cntrct_amount == '' ? 0 : parseInt(pValue.cntrct_amount);
                before = pValue.sttus_nm;
            });
            if(before != ""){
                html += '<tr>';
                html += '    <td class="text-center colorN3" colspan="3">계</td>';
                html += '    <td class="text-center colorN3">'+count.toString().toFormat('NUMBER')+'개</td>';
                html += '    <td class="text-right colorN3">'+amount.toString().toFormat('NUMBER')+'</td>';
                html += '    <td class="text-center colorN3"></td>';
                html += '    <td class="text-center colorN3"></td>';
                html += '</tr>';
            }


            count_tot += count;
            amount_tot += amount;
            $("#rpt6").find("#va tbody[role=body]").html(html);
            $('#rpt6').find('#va tbody[role=body]').yRowspan(0);
            $('#rpt6').find('#va tbody[role=body]').yRowspan(1);
            if(s_dept_code !== 'BI')
	            $('#rpt6').find('#va tbody[role=body]').yRowspan(2);
            var html = '';
            html += '<tr>';
            html += '    <td class="text-center colorSky" colspan="3">합계</td>';
            html += '    <td class="text-center colorSky">'+count_tot.toString().toFormat('NUMBER')+'개</td>';
            html += '    <td class="text-right colorSky">'+amount_tot.toString().toFormat('NUMBER')+'</td>';
            html += '    <td class="text-center colorSky"></td>';
            html += '    <td class="text-center colorSky"></td>';
            html += '</tr>';
            $("#rpt6").find("#va tbody[role=foot]").html(html);

            $('#popReport6').modal('show');
		}
	});
}

$(function() {
    /**************************************************************************
     *
     */
	$('#popReport6').on('show.bs.modal', function(pEvent) {
        //getProjectsByDeptMember();
	});


    /**************************************************************************
     *
     */
	$('#btnPrint6').on('click', function(pEvent) {
		var html = $('#popReport6').find('.modal-body').html();
		$('#_print').contents().find('body>div.report').html('');
		$('#_print').contents().find('body>div.report').html(html);
		parent.frames['_print'].focus();
    	parent.frames['_print'].print();
	});
});
</script>

<!-- popReport4 : 매입처별 매입 현황 - 연간현황 -->
<div class="modal fade" data-backdrop="static" id="popReport4">
    <div class="modal-dialog modal-w1200" style="width:88%!important;">
        <div class="modal-content">
			<div class="modal-header">
				<div class="pull-right" style="margin-right:10px;">
					<button type="button" class="btn btn-primary" id="btnPrint4"><i class="fa fa-print">&nbsp;출력</i></button>
					<button type="button" class="btn btn-default" aria-hidden="true" data-dismiss="modal"><i class="fa fa-times">&nbsp;취소</i></button>
				</div>
			</div>
			<div class="modal-body report">

				<style>
				@media (min-width: 100px) and (max-width: 1024px) {

					#popReport4 div.report table th,
					#popReport4 div.report table td {
						font-size: 8px!important;
						padding: 7px 5px!important;
						line-height: 1.0!important;
					}
				}
				</style>
				<div id="rpt4">
				<div class="title"><h2 class="colorLS" id="title4">연간 매입 현황</h2></div>

				<!-- 기성 현황 시작 -->
					<table id="rptSalesYearSummary" class="table table-bordered w100p">
						<colgroup>
							<col width="*">
							<col width="110">
							<col width="110">
							<col width="110">
							<col width="110">
							<col width="110">
							<col width="110">
							<col width="110">
							<col width="110">
							<col width="110">
							<col width="110">
							<col width="110">
							<col width="110">
							<col width="110">
						</colgroup>
						<tbody role="header">
							<tr>
								<th class="colorB">매입처</th>
								<th class="colorB"><a style="color:inherit;" class="btnSearch" data-code="0">1월</a></th>
								<th class="colorB"><a style="color:inherit;" class="btnSearch" data-code="1">2월</a></th>
								<th class="colorB"><a style="color:inherit;" class="btnSearch" data-code="2">3월</a></th>
								<th class="colorB"><a style="color:inherit;" class="btnSearch" data-code="3">4월</a></th>
								<th class="colorB"><a style="color:inherit;" class="btnSearch" data-code="4">5월</a></th>
								<th class="colorB"><a style="color:inherit;" class="btnSearch" data-code="5">6월</a></th>
								<th class="colorB"><a style="color:inherit;" class="btnSearch" data-code="6">7월</a></th>
								<th class="colorB"><a style="color:inherit;" class="btnSearch" data-code="7">8월</a></th>
								<th class="colorB"><a style="color:inherit;" class="btnSearch" data-code="8">9월</a></th>
								<th class="colorB"><a style="color:inherit;" class="btnSearch" data-code="9">10월</a></th>
								<th class="colorB"><a style="color:inherit;" class="btnSearch" data-code="10">11월</a></th>
								<th class="colorB"><a style="color:inherit;" class="btnSearch" data-code="11">12월</a></th>
								<th class="colorB">누계</th>
							</tr>
						</tbody>
						<tbody role="body">
						</tbody>
					</table>
				</div><!-- 기성 현황 끝 -->


			</div><!--modal-body-->
        </div><!--modal-content-->
    </div><!--modal-dialog-->
</div><!--modal-->
<script>
getSalesYearSummary = function(s_pxcond_mt)
{
    var params = '';
	params += '&s_pxcond_mt='+s_pxcond_mt;
	$.ajax({
		url: '/api/dashboard/ajax_get_sales_summary',
		type: 'GET',
		data: params,
		dataType: 'json',
		contentType: false,
		processData: false,
		validate: function() {
			return true;
		},
		success: function(pResult) {
			if (pResult.status) {

                var html = '';
                //console.log(sales);
				html = '';
                console.log('lafamila',pResult.list);
                pResult.list.sort(function(t, s){
                	let a = t.label, b = s.label;
                	if(a.includes("총계")) return 1;
                	if(b.includes("총계")) return -1;
                	if(a.includes("자재") && b.includes("자재")){
                		let x = a.includes("타사"), y = b.includes("타사");
                		if(x && y) return a.localeCompare(b);
                		else return (x?1:-1) - (y?1:-1)
					}
                	else{
                		let x = a.includes("자재"), y = b.includes("자재");
                		if(!x && !y){
	                		let x = a.includes("타사"), y = b.includes("타사");
							if(x && y) return a.localeCompare(b);
							else return (x?1:-1) - (y?1:-1)
						}
                		else return (x?1:-1) - (y?1:-1)
					}
				});

                $.each(pResult.list, function(pIndex, pValue){

					var bgColor = '';
                    var color = '';
					if (pValue.label == '총계') {
						bgColor = 'colorSky';
                        color = 'colorSky';
					}
                    var className = ' ';
					color = 'colorSky';

					html += '<tr class="'+className+'">';
					html += '    <td class="'+color+' '+bgColor+'">'+pValue.label+'</td>';
					html += '    <td class="text-number '+bgColor+'">'+pValue.p_month01.toString().toFormat('NUMBER')+'</td>';
					html += '    <td class="text-number '+bgColor+'">'+pValue.p_month02.toString().toFormat('NUMBER')+'</td>';
					html += '    <td class="text-number '+bgColor+'">'+pValue.p_month03.toString().toFormat('NUMBER')+'</td>';
					html += '    <td class="text-number '+bgColor+'">'+pValue.p_month04.toString().toFormat('NUMBER')+'</td>';
					html += '    <td class="text-number '+bgColor+'">'+pValue.p_month05.toString().toFormat('NUMBER')+'</td>';
					html += '    <td class="text-number '+bgColor+'">'+pValue.p_month06.toString().toFormat('NUMBER')+'</td>';
					html += '    <td class="text-number '+bgColor+'">'+pValue.p_month07.toString().toFormat('NUMBER')+'</td>';
					html += '    <td class="text-number '+bgColor+'">'+pValue.p_month08.toString().toFormat('NUMBER')+'</td>';
					html += '    <td class="text-number '+bgColor+'">'+pValue.p_month09.toString().toFormat('NUMBER')+'</td>';
					html += '    <td class="text-number '+bgColor+'">'+pValue.p_month10.toString().toFormat('NUMBER')+'</td>';
					html += '    <td class="text-number '+bgColor+'">'+pValue.p_month11.toString().toFormat('NUMBER')+'</td>';
					html += '    <td class="text-number '+bgColor+'">'+pValue.p_month12.toString().toFormat('NUMBER')+'</td>';
					html += '    <td class="text-number '+bgColor+'">'+pValue.p_month99.toString().toFormat('NUMBER')+'</td>';
					html += '</tr>';
				});
				$('#rptSalesYearSummary tbody[role=body]').html(html);

			}
		}
	});
};
$(function() {
    /**************************************************************************
     *
     */
	$('#popReport4').on('show.bs.modal', function(pEvent) {
		getSalesYearSummary($("#s_pxcond_mt_last").val());
	});


    /**************************************************************************
     *
     */
	$('#btnPrint4').on('click', function(pEvent) {
		var html = $('#popReport4').find('.modal-body').html();
		$('#_print').contents().find('body>div.report').html('');
		$('#_print').contents().find('body>div.report').html(html);
		parent.frames['_print'].focus();
    	parent.frames['_print'].print();
	});
});


$('#popReport4').on('click', '.btnSearch', function(pEvent) {
    var code = $(this).data('code');
    var now = new Date();
    now.setDate(1);
    now.setMonth(code);
    now = $.datepicker.formatDate('yy-mm-dd', now);
    getSalesSummary(now);
    $("#s_pxcond_mt_last").val(now);
    $('#popReport4').modal('hide');
});
</script>

<!-- popReport2 : 팀별 실적 현황 - 수주 -->
<div class="modal fade" data-backdrop="static" id="popReport2">
    <div class="modal-dialog modal-w1200" style="width:57%!important;">
        <div class="modal-content">
			<div class="modal-header">
				<div class="pull-right" style="margin-right:10px;">
					<button type="button" class="btn btn-primary" id="btnPrint2"><i class="fa fa-print">&nbsp;출력</i></button>
					<button type="button" class="btn btn-default" aria-hidden="true" data-dismiss="modal"><i class="fa fa-times">&nbsp;취소</i></button>
				</div>

			</div>
			<div class="modal-body report">


				<style>

					tbody td.colorN3{
						background: #e6faff!important;
					}
					#rpt2 .table>tbody>tr>td, #rpt2 .table>tbody>tr>th, #rpt2 .table>tfoot>tr>td, #rpt2 .table>tfoot>tr>th, #rpt2 .table>thead>tr>td, #rpt2 .table>thead>tr>th {
						line-height: 0.5 !important;
					}
					@media (min-width: 100px) and (max-width: 1024px) {

						#popReport2 div.report table th,
						#popReport2 div.report table td {
							font-size: 8px!important;
							padding: 7px 5px!important;
							line-height: 1.0!important;
						}
					}
				</style>

				<div id="rpt2">
				<div class="title"><h2 class="colorLS" id="title">팀별 수주 현황</h2></div>
				<!-- 기성 현황 시작 -->
				<table id="suju" class="table table-bordered w100p">
					 <colgroup>
						<col width="100">
						<col width="200">
						<col width="*">
						<col width="50">
						<col width="100">
						<col width="120">
					</colgroup>
					<tbody role="header">
						<tr>
							<th class="colorB" colspan="1">부서</th>
							<th class="colorB" colspan="1">건설사</th>
							<th class="colorB" colspan="1">현장명</th>
							<th class="colorB" colspan="1">건수</th>
							<th class="colorB" colspan="1">수주금액</th>
							<th class="colorB" colspan="1">계약일</th>
						</tr>
					</tbody>
					<tbody role="body_suju">
					</tbody>
				</table>
				</div><!-- 기성 현황 끝 -->


			</div><!--modal-body-->
        </div><!--modal-content-->
    </div><!--modal-dialog-->
</div><!--modal-->
<script>
getCompletedSuju = function(s_pxcond_mt)
{
    var params = '';
	params += '&s_pxcond_mt='+s_pxcond_mt;

	$.ajax({
		url: '/api/dashboard/ajax_get_completed_suju',
		type: 'GET',
		data: params,
		dataType: 'json',
		contentType: false,
		processData: false,
		success: function(pResult) {
			var html = '';
			var suju1, suju2; // 목표, 실적
            var before = "";
            var before_count = 0;
            var before_count2 = 0;
            var before_price_1 = 0;
            var before_price_2 = 0;

            var total_count = 0;
            var total_count2 = 0;
			var total_price_1 = 0;
            var total_price_2 = 0;
            $.each(pResult.data, function(pIndex, pValue){
                if(before != "" && before != pValue.code_nm){

                    html += '<tr>';
                    html += '    <td class="colorSky">'+before+'</td>';
                    html += '    <td class="colorN3">소계</td>';
                    html += '    <td class="colorN3"></td>';
                    html += '    <td class="colorN3">'+before_count.toString().toFormat('NUMBER')+'</td>';
                    html += '    <td class="colorN3">'+before_price_1.toString().toFormat('NUMBER')+'</td>';
                    html += '    <td class="colorN3"></td>';
                    html += '</tr>';
                    total_count += before_count;
                    total_count2 += before_count2;
                    total_price_1 += before_price_1;
                    total_price_2 += before_price_2;

                    before_count = 0;
                    before_count2 = 0;
                    before_price_1 = 0;
                    before_price_2 = 0;
                }
                html += '<tr>';
                html += '    <td class="colorSky">'+pValue.code_nm+'</td>';
                html += '    <td>'+pValue.bcnc_nm+'</td>';
                html += '    <td>'+pValue.cntrct_nm+'</td>';
                html += '    <td>'+pValue.count+'</td>';
                html += '    <td>'+pValue.price_1.toString().toFormat('NUMBER')+'</td>';
                html += '    <td>'+pValue.cntrct_de+'</td>';
                html += '</tr>';
                before = pValue.code_nm;
                if(pValue.ordr == '0')
                    before_count += parseInt(pValue.count);
                else
                    before_count2 += parseInt(pValue.count);
                before_price_1 += parseInt(pValue.price_1);
                before_price_2 += parseInt(pValue.price_2);
			});
            html += '<tr>';
            html += '    <td class="colorSky">'+before+'</td>';
            html += '    <td class="colorN3">소계</td>';
            html += '    <td class="colorN3"></td>';
            html += '    <td class="colorN3">'+before_count.toString().toFormat('NUMBER')+'</td>';
            html += '    <td class="colorN3">'+before_price_1.toString().toFormat('NUMBER')+'</td>';
            html += '    <td class="colorN3"></td>';
            html += '</tr>';
            total_count += before_count;
            total_count2 += before_count2;
            total_price_1 += before_price_1;
            total_price_2 += before_price_2;
            html += '<tr>';
            html += '    <td class="colorSky">총계</td>';
            html += '    <td class="colorSky"></td>';
            html += '    <td class="colorSky"></td>';
            html += '    <td class="colorSky">'+total_count.toString().toFormat('NUMBER')+'</td>';
            html += '    <td class="colorSky">'+total_price_1.toString().toFormat('NUMBER')+'</td>';
            html += '    <td class="colorSky"></td>';
            html += '</tr>';

            $("#rpt2").find("#suju tbody[role=body_suju]").html(html);
            $('#rpt2').find('#suju tbody[role=body_suju]').yRowspan(0);
            $('#rpt2').find('#suju tbody[role=body_suju]').yRowspan(1);

            var cells = $('#rpt2').find('#suju tbody[role=body_suju] td, #suju tbody[role=body_suju] th');
            $.each(cells, function(pIndex, pValue){
                let value = $(pValue).html();
                if(value == '0' || value == '0.0%' || value=='-Infinity%' || value=='Infinity%'){

                    $(pValue).html('');
                }
            });
		}
	});
}
$(function() {
	$('#popReport2').on('show.bs.modal', function(pEvent) {
		getCompletedSuju($("#s_pxcond_mt").val());
	});

	$('#btnPrint2').on('click', function(pEvent) {
		var html = $('#popReport2').find('.modal-body').html();
		$('#_print').contents().find('body>div.report').html('');
		$('#_print').contents().find('body>div.report').html(html);
		parent.frames['_print'].focus();
    	parent.frames['_print'].print();
	});
});
</script>

<!-- popReport3 : 팀별 실적 현황 - 매출 -->
<div class="modal fade" data-backdrop="static" id="popReport3">
    <div class="modal-dialog modal-w1200" style="width:47%!important;">
        <div class="modal-content">
			<div class="modal-header">
				<div class="pull-right" style="margin-right:10px;">
					<button type="button" class="btn btn-primary" id="btnPrint3"><i class="fa fa-print">&nbsp;출력</i></button>
					<button type="button" class="btn btn-default" aria-hidden="true" data-dismiss="modal"><i class="fa fa-times">&nbsp;취소</i></button>
				</div>
<!--
                <div class="pull-right" style="margin-right:10px;width:150px;">
					<div class="input-group">
						<input class="form-control datepicker" type="text" style="z-index:1050!important;" data-dateformat="yy-mm-dd" data-mask="9999-99-99" data-mask-placeholder="_" id="s_ddt_card" name="s_ddt_card">
						<span class="input-group-addon"><i class="fa fa-calendar"></i></span>
					</div>
				</div>
-->

			</div>
			<div class="modal-body report">


<div id="rpt3">
<div class="title"><h2 class="colorLS" id="title">팀별 매출 현황</h2></div>
<style>

    #rpt3 .table>tbody>tr>td, #rpt3 .table>tbody>tr>th, #rpt3 .table>tfoot>tr>td, #rpt3 .table>tfoot>tr>th, #rpt3 .table>thead>tr>td, #rpt3 .table>thead>tr>th {
        line-height: 0.5 !important;
    }

</style>
<style>
@media (min-width: 100px) and (max-width: 1024px) {

    #popReport3 div.report table th,
    #popReport3 div.report table td {
        font-size: 8px!important;
        padding: 7px 5px!important;
        line-height: 1.0!important;
    }
}
</style>
<!-- 기성 현황 시작 -->
<table id="sales" class="table table-bordered w100p">
     <colgroup>
        <col width="100">
        <col width="200">
        <col width="*">
        <col width="150">
        <col width="100">
    </colgroup>
    <tbody role="header">
        <tr>
            <th class="colorB" colspan="1">부서</th>
            <th class="colorB" colspan="1">건설사</th>
            <th class="colorB" colspan="1">현장명</th>
            <th class="colorB" colspan="1">금액</th>
            <th class="colorB" colspan="1">월/일</th>
        </tr>
    </tbody>
    <tbody role="body_sales">
    </tbody>
</table>
</div><!-- 기성 현황 끝 -->


			</div><!--modal-body-->
        </div><!--modal-content-->
    </div><!--modal-dialog-->
</div><!--modal-->
<script>
getCompletedSales = function(s_pxcond_mt)
{

    var params = '';
	params += '&s_pxcond_mt='+s_pxcond_mt;

    $.ajax({
		url: '/api/dashboard/ajax_get_completed_sales',
		type: 'GET',
		data: params,
		dataType: 'json',
		contentType: false,
		processData: false,
		success: function(pResult) {
            console.log(pResult);
			var html = '';
			var suju1, suju2; // 목표, 실적
            var before = "";
            var before_price_1 = 0;
			var total_price_1 = 0;
			$.each(pResult.data, function(pIndex, pValue){
                if(before != "" && before != pValue.dept_nm){

                    html += '<tr>';
                    html += '    <td class="colorSky">'+before+'</td>';
                    html += '    <td class="colorN3">소계</td>';
                    html += '    <td class="colorN3"></td>';
                    html += '    <td class="colorN3">'+before_price_1.toString().toFormat('NUMBER')+'</td>';
                    html += '    <td class="colorN3"></td>';
                    html += '</tr>';
                    total_price_1 += before_price_1;

                    before_price_1 = 0;
                }
                html += '<tr>';
                html += '    <td class="colorSky">'+pValue.dept_nm+'</td>';
                html += '    <td>'+pValue.bcnc_nm+'</td>';
                html += '    <td>'+pValue.spt_nm+'</td>';
                html += '    <td>'+pValue.amount.toString().toFormat('NUMBER')+'</td>';
                html += '    <td>'+pValue.pblicte_de+'</td>';
                html += '</tr>';
                before = pValue.dept_nm;
                before_price_1 += parseInt(pValue.amount);

		  });
            html += '<tr>';
            html += '    <td class="colorSky">'+before+'</td>';
            html += '    <td class="colorN3">소계</td>';
            html += '    <td class="colorN3"></td>';
            html += '    <td class="colorN3">'+before_price_1.toString().toFormat('NUMBER')+'</td>';
            html += '    <td class="colorN3"></td>';
            html += '</tr>';
            total_price_1 += before_price_1;


            html += '<tr>';
            html += '    <td class="colorSky">총계</td>';
            html += '    <td class="colorSky"></td>';
            html += '    <td class="colorSky"></td>';
            html += '    <td class="colorSky">'+total_price_1.toString().toFormat('NUMBER')+'</td>';
            html += '    <td class="colorSky"></td>';
            html += '</tr>';
            $("#rpt3").find("#sales tbody[role=body_sales]").html(html);
            $('#rpt3').find('#sales tbody[role=body_sales]').yRowspan(0);
            $('#rpt3').find('#sales tbody[role=body_sales]').yRowspan(1);
            var cells = $('#rpt3').find('#sales tbody[role=body_sales] td, #sales tbody[role=body_sales] th');
            $.each(cells, function(pIndex, pValue){
                let value = $(pValue).html();
                if(value == '0' || value == '0.0%' || value=='-Infinity%' || value=='Infinity%'){

                    $(pValue).html('');
                }
            });

        }
	});
}
$(function() {
	$('#popReport3').on('show.bs.modal', function(pEvent) {
		getCompletedSales($("#s_pxcond_mt").val());
	});

	$('#btnPrint3').on('click', function(pEvent) {
		var html = $('#popReport3').find('.modal-body').html();
		$('#_print').contents().find('body>div.report').html('');
		$('#_print').contents().find('body>div.report').html(html);
		parent.frames['_print'].focus();
    	parent.frames['_print'].print();
	});
});

</script>
<!-- popReport2 : 수주 클릭하면 나오는 팀별 수주 현황 -->
<!-- popReport7 : 업무일지 -->
<!-- popReport10 : popReport6 과 병합 -->

{% endblock %}